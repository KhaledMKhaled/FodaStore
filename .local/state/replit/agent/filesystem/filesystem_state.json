{"file_contents":{"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","path":null,"size_bytes":2695,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1883,"size_tokens":null},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport type { Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { setupAuth, isAuthenticated, requireRole } from \"./auth\";\nimport { logAuditEvent } from \"./audit\";\nimport { getPaymentsWithShipments } from \"./payments\";\nimport { createShipmentWithItems, updateShipmentWithItems } from \"./shipmentService\";\nimport type { User } from \"@shared/schema\";\nimport {\n  insertSupplierSchema,\n  insertExchangeRateSchema,\n  insertShipmentPaymentSchema,\n} from \"@shared/schema\";\nimport bcrypt from \"bcryptjs\";\n\nexport async function registerRoutes(httpServer: Server, app: Express): Promise<void> {\n  // Setup authentication\n  await setupAuth(app);\n\n  // Auth routes\n  app.get(\"/api/auth/user\", async (req, res) => {\n    if (req.isAuthenticated() && req.user) {\n      const user = await storage.getUser(req.user.id);\n      if (user) {\n        const { password, ...userWithoutPassword } = user;\n        return res.json(userWithoutPassword);\n      }\n    }\n    res.status(401).json({ message: \"Unauthorized\" });\n  });\n\n  // Dashboard\n  app.get(\"/api/dashboard/stats\", isAuthenticated, async (req, res) => {\n    try {\n      const stats = await storage.getDashboardStats();\n      res.json(stats);\n    } catch (error) {\n      res.status(500).json({ message: \"Error fetching dashboard stats\" });\n    }\n  });\n\n  // Suppliers\n  app.get(\"/api/suppliers\", isAuthenticated, async (req, res) => {\n    try {\n      const suppliers = await storage.getAllSuppliers();\n      res.json(suppliers);\n    } catch (error) {\n      res.status(500).json({ message: \"Error fetching suppliers\" });\n    }\n  });\n\n  app.get(\"/api/suppliers/:id\", isAuthenticated, async (req, res) => {\n    try {\n      const supplier = await storage.getSupplier(parseInt(req.params.id));\n      if (!supplier) {\n        return res.status(404).json({ message: \"Supplier not found\" });\n      }\n      res.json(supplier);\n    } catch (error) {\n      res.status(500).json({ message: \"Error fetching supplier\" });\n    }\n  });\n\n  app.post(\"/api/suppliers\", requireRole([\"مدير\", \"محاسب\"]), async (req, res) => {\n    try {\n      const data = insertSupplierSchema.parse(req.body);\n      const supplier = await storage.createSupplier(data);\n      res.json(supplier);\n    } catch (error) {\n      res.status(400).json({ message: \"Invalid data\" });\n    }\n  });\n\n  app.patch(\"/api/suppliers/:id\", requireRole([\"مدير\", \"محاسب\"]), async (req, res) => {\n    try {\n      const supplier = await storage.updateSupplier(parseInt(req.params.id), req.body);\n      if (!supplier) {\n        return res.status(404).json({ message: \"Supplier not found\" });\n      }\n      res.json(supplier);\n    } catch (error) {\n      res.status(500).json({ message: \"Error updating supplier\" });\n    }\n  });\n\n  app.delete(\"/api/suppliers/:id\", requireRole([\"مدير\", \"محاسب\"]), async (req, res) => {\n    try {\n      await storage.deleteSupplier(parseInt(req.params.id));\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ message: \"Error deleting supplier\" });\n    }\n  });\n\n  // Shipments\n  app.get(\"/api/shipments\", isAuthenticated, async (req, res) => {\n    try {\n      const shipments = await storage.getAllShipments();\n      res.json(shipments);\n    } catch (error) {\n      res.status(500).json({ message: \"Error fetching shipments\" });\n    }\n  });\n\n  app.get(\"/api/shipments/:id\", isAuthenticated, async (req, res) => {\n    try {\n      const shipment = await storage.getShipment(parseInt(req.params.id));\n      if (!shipment) {\n        return res.status(404).json({ message: \"Shipment not found\" });\n      }\n      res.json(shipment);\n    } catch (error) {\n      res.status(500).json({ message: \"Error fetching shipment\" });\n    }\n  });\n\n  app.post(\"/api/shipments\", requireRole([\"مدير\", \"محاسب\"]), async (req, res) => {\n    try {\n      const userId = (req.user as any)?.id;\n      const shipment = await createShipmentWithItems(req.body, userId);\n      \n      logAuditEvent({\n        userId,\n        entityType: \"SHIPMENT\",\n        entityId: shipment.id,\n        actionType: \"CREATE\",\n        details: { status: shipment.status },\n      });\n      \n      res.json(shipment);\n    } catch (error) {\n      console.error(\"Error creating shipment:\", error);\n      res.status(400).json({ message: (error as Error)?.message || \"تعذر إنشاء الشحنة\" });\n    }\n  });\n\n  app.patch(\"/api/shipments/:id\", requireRole([\"مدير\", \"محاسب\"]), async (req, res) => {\n    try {\n      const shipmentId = parseInt(req.params.id);\n      const userId = (req.user as any)?.id;\n      \n      const existingShipment = await storage.getShipment(shipmentId);\n      const previousStatus = existingShipment?.status;\n      \n      const updatedShipment = await updateShipmentWithItems(shipmentId, req.body);\n      \n      logAuditEvent({\n        userId,\n        entityType: \"SHIPMENT\",\n        entityId: shipmentId,\n        actionType: \"UPDATE\",\n        details: { step: req.body.step, status: updatedShipment?.status },\n      });\n      \n      if (updatedShipment && updatedShipment.status !== previousStatus) {\n        logAuditEvent({\n          userId,\n          entityType: \"SHIPMENT\",\n          entityId: shipmentId,\n          actionType: \"STATUS_CHANGE\",\n          details: { from: previousStatus, to: updatedShipment.status },\n        });\n      }\n      \n      res.json(updatedShipment);\n    } catch (error) {\n      console.error(\"Error updating shipment:\", error);\n      const message = (error as Error)?.message || \"حدث خطأ أثناء حفظ بيانات الشحنة\";\n      const status = message === \"الشحنة غير موجودة\" ? 404 : 400;\n      res.status(status).json({ message });\n    }\n  });\n\n  app.delete(\"/api/shipments/:id\", requireRole([\"مدير\", \"محاسب\"]), async (req, res) => {\n    try {\n      const shipmentId = parseInt(req.params.id);\n      const userId = (req.user as any)?.id;\n      \n      await storage.deleteShipment(shipmentId);\n      \n      logAuditEvent({\n        userId,\n        entityType: \"SHIPMENT\",\n        entityId: shipmentId,\n        actionType: \"DELETE\",\n      });\n      \n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ message: \"Error deleting shipment\" });\n    }\n  });\n\n  // Shipment Items\n  app.get(\"/api/shipments/:id/items\", isAuthenticated, async (req, res) => {\n    try {\n      const items = await storage.getShipmentItems(parseInt(req.params.id));\n      res.json(items);\n    } catch (error) {\n      res.status(500).json({ message: \"Error fetching items\" });\n    }\n  });\n\n  // Shipment Shipping Details\n  app.get(\"/api/shipments/:id/shipping\", isAuthenticated, async (req, res) => {\n    try {\n      const details = await storage.getShippingDetails(parseInt(req.params.id));\n      res.json(details || null);\n    } catch (error) {\n      res.status(500).json({ message: \"Error fetching shipping details\" });\n    }\n  });\n\n  // Exchange Rates\n  app.get(\"/api/exchange-rates\", isAuthenticated, async (req, res) => {\n    try {\n      const rates = await storage.getAllExchangeRates();\n      res.json(rates);\n    } catch (error) {\n      res.status(500).json({ message: \"Error fetching exchange rates\" });\n    }\n  });\n\n  app.post(\"/api/exchange-rates\", requireRole([\"مدير\", \"محاسب\"]), async (req, res) => {\n    try {\n      const data = insertExchangeRateSchema.parse(req.body);\n      const userId = (req.user as any)?.id;\n      const rate = await storage.createExchangeRate(data);\n      \n      logAuditEvent({\n        userId,\n        entityType: \"EXCHANGE_RATE\",\n        entityId: rate.id,\n        actionType: \"CREATE\",\n        details: { from: rate.fromCurrency, to: rate.toCurrency },\n      });\n      \n      res.json(rate);\n    } catch (error) {\n      res.status(400).json({ message: \"Invalid data\" });\n    }\n  });\n\n  // Manual/automatic refresh - simulate external update\n  app.post(\"/api/exchange-rates/refresh\", requireRole([\"مدير\", \"محاسب\"]), async (req, res) => {\n    try {\n      const today = new Date();\n      const todayStr = today.toISOString().split(\"T\")[0];\n      const latestRmb = await storage.getLatestRate(\"RMB\", \"EGP\");\n      const latestUsd = await storage.getLatestRate(\"USD\", \"RMB\");\n      const userId = (req.user as any)?.id;\n\n      const refreshed = await Promise.all([\n        storage.createExchangeRate({\n          rateDate: todayStr,\n          fromCurrency: \"RMB\",\n          toCurrency: \"EGP\",\n          rateValue: latestRmb?.rateValue || \"7.0000\",\n          source: \"تحديث تلقائي\",\n        }),\n        storage.createExchangeRate({\n          rateDate: todayStr,\n          fromCurrency: \"USD\",\n          toCurrency: \"RMB\",\n          rateValue: latestUsd?.rateValue || \"7.2000\",\n          source: \"تحديث تلقائي\",\n        }),\n      ]);\n\n      refreshed.forEach((rate) => {\n        logAuditEvent({\n          userId,\n          entityType: \"EXCHANGE_RATE\",\n          entityId: rate.id,\n          actionType: \"CREATE\",\n          details: { from: rate.fromCurrency, to: rate.toCurrency },\n        });\n      });\n\n      res.json({\n        message: \"تم تحديث الأسعار\",\n        lastUpdated: today,\n        rates: refreshed,\n      });\n    } catch (error) {\n      console.error(\"Error refreshing exchange rates\", error);\n      res.status(500).json({ message: \"تعذر تحديث أسعار الصرف\" });\n    }\n  });\n\n  // Payments\n  app.get(\"/api/payments\", isAuthenticated, async (req, res) => {\n    try {\n      const paymentsWithShipments = await getPaymentsWithShipments(storage);\n      res.json(paymentsWithShipments);\n    } catch (error) {\n      res.status(500).json({ message: \"Error fetching payments\" });\n    }\n  });\n\n  app.get(\"/api/payments/stats\", isAuthenticated, async (req, res) => {\n    try {\n      const stats = await storage.getPaymentStats();\n      res.json(stats);\n    } catch (error) {\n      res.status(500).json({ message: \"Error fetching payment stats\" });\n    }\n  });\n\n  app.post(\"/api/payments\", requireRole([\"مدير\", \"محاسب\"]), async (req, res) => {\n    try {\n      // Convert paymentDate string to Date object and validate\n      let paymentDate: Date | undefined;\n      if (req.body.paymentDate) {\n        paymentDate = new Date(req.body.paymentDate);\n        if (Number.isNaN(paymentDate.getTime())) {\n          return res.status(400).json({ message: \"تاريخ الدفع غير صالح\" });\n        }\n      }\n      const bodyWithDate = {\n        ...req.body,\n        paymentDate,\n      };\n      const data = insertShipmentPaymentSchema.parse(bodyWithDate);\n      const userId = (req.user as any)?.id;\n      const payment = await storage.createPayment({\n        ...data,\n        createdByUserId: userId,\n      });\n\n      logAuditEvent({\n        userId,\n        entityType: \"PAYMENT\",\n        entityId: payment.id,\n        actionType: \"CREATE\",\n        details: { shipmentId: payment.shipmentId },\n      });\n      \n      res.json(payment);\n    } catch (error) {\n      console.error(\"Error creating payment:\", error);\n      res.status(400).json({ message: \"Invalid data\" });\n    }\n  });\n\n  // Inventory\n  app.get(\"/api/inventory\", isAuthenticated, async (req, res) => {\n    try {\n      const movements = await storage.getAllInventoryMovements();\n      // Include shipment and item info\n      const movementsWithDetails = await Promise.all(\n        movements.map(async (movement) => {\n          const shipment = movement.shipmentId\n            ? await storage.getShipment(movement.shipmentId)\n            : null;\n          const shipmentItems = movement.shipmentId\n            ? await storage.getShipmentItems(movement.shipmentId)\n            : [];\n          const shipmentItem = shipmentItems.find(\n            (item) => item.id === movement.shipmentItemId\n          );\n          return { ...movement, shipment, shipmentItem };\n        })\n      );\n      res.json(movementsWithDetails);\n    } catch (error) {\n      res.status(500).json({ message: \"Error fetching inventory\" });\n    }\n  });\n\n  app.get(\"/api/inventory/stats\", isAuthenticated, async (req, res) => {\n    try {\n      const stats = await storage.getInventoryStats();\n      res.json(stats);\n    } catch (error) {\n      res.status(500).json({ message: \"Error fetching inventory stats\" });\n    }\n  });\n\n  // Users\n  app.get(\"/api/users\", isAuthenticated, async (req, res) => {\n    try {\n      const allUsers = await storage.getAllUsers();\n      const usersWithoutPasswords = allUsers.map(({ password, ...user }) => user);\n      res.json(usersWithoutPasswords);\n    } catch (error) {\n      res.status(500).json({ message: \"Error fetching users\" });\n    }\n  });\n\n  // Create new user (admin only)\n  app.post(\"/api/users\", requireRole([\"مدير\"]), async (req, res) => {\n    try {\n      const { username, password, firstName, lastName, role } = req.body;\n      const actorId = (req.user as any)?.id;\n      \n      if (!username || !password) {\n        return res.status(400).json({ message: \"اسم المستخدم وكلمة المرور مطلوبان\" });\n      }\n\n      const existingUser = await storage.getUserByUsername(username);\n      if (existingUser) {\n        return res.status(400).json({ message: \"اسم المستخدم موجود بالفعل\" });\n      }\n\n      const hashedPassword = await bcrypt.hash(password, 10);\n      const user = await storage.createUser({\n        username,\n        password: hashedPassword,\n        firstName: firstName || null,\n        lastName: lastName || null,\n        role: role || \"مشاهد\",\n      });\n\n      const { password: _, ...userWithoutPassword } = user;\n      \n      logAuditEvent({\n        userId: actorId,\n        entityType: \"USER\",\n        entityId: user.id,\n        actionType: \"CREATE\",\n        details: { role: user.role },\n      });\n      \n      res.json(userWithoutPassword);\n    } catch (error) {\n      console.error(\"Error creating user:\", error);\n      res.status(500).json({ message: \"Error creating user\" });\n    }\n  });\n\n  // Update user (admin only, or self for password)\n  app.patch(\"/api/users/:id\", requireRole([\"مدير\", \"محاسب\"]), async (req, res) => {\n    try {\n      const { id } = req.params;\n      const { password, firstName, lastName, role } = req.body;\n      const currentUser = req.user!;\n      const actorId = (req.user as any)?.id;\n\n      // Only admin can update other users or roles\n      if (currentUser.id !== id && currentUser.role !== \"مدير\") {\n        return res.status(403).json({ message: \"لا تملك صلاحية لتعديل مستخدمين آخرين\" });\n      }\n\n      // Non-admins can only update their own password\n      if (currentUser.id === id && currentUser.role !== \"مدير\" && role) {\n        return res.status(403).json({ message: \"غير مصرح بتغيير الدور\" });\n      }\n\n      const updateData: any = {};\n      if (password) {\n        updateData.password = await bcrypt.hash(password, 10);\n      }\n      if (firstName !== undefined) updateData.firstName = firstName;\n      if (lastName !== undefined) updateData.lastName = lastName;\n      if (role !== undefined && currentUser.role === \"مدير\") updateData.role = role;\n\n      const user = await storage.updateUser(id, updateData);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      const { password: _, ...userWithoutPassword } = user;\n      \n      logAuditEvent({\n        userId: actorId,\n        entityType: \"USER\",\n        entityId: user.id,\n        actionType: \"UPDATE\",\n        details: { updatedFields: Object.keys(updateData) },\n      });\n      \n      res.json(userWithoutPassword);\n    } catch (error) {\n      res.status(500).json({ message: \"Error updating user\" });\n    }\n  });\n\n  app.patch(\"/api/users/:id/role\", requireRole([\"مدير\"]), async (req, res) => {\n    try {\n      const { role } = req.body;\n      const user = await storage.updateUserRole(req.params.id, role);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      const { password: _, ...userWithoutPassword } = user;\n      \n      logAuditEvent({\n        userId: (req.user as any)?.id,\n        entityType: \"USER\",\n        entityId: user.id,\n        actionType: \"UPDATE\",\n        details: { role: user.role },\n      });\n      \n      res.json(userWithoutPassword);\n    } catch (error) {\n      res.status(500).json({ message: \"Error updating user role\" });\n    }\n  });\n\n  // Delete user (admin only)\n  app.delete(\"/api/users/:id\", requireRole([\"مدير\"]), async (req, res) => {\n    try {\n      const { id } = req.params;\n      const currentUser = req.user!;\n      const actorId = (req.user as any)?.id;\n\n      // Prevent deleting yourself\n      if (currentUser.id === id) {\n        return res.status(400).json({ message: \"لا يمكن حذف حسابك الخاص\" });\n      }\n\n      // Prevent deleting root user\n      const targetUser = await storage.getUser(id);\n      if (targetUser?.username === \"root\") {\n        return res.status(400).json({ message: \"لا يمكن حذف حساب الجذر\" });\n      }\n\n      await storage.deleteUser(id);\n      \n      logAuditEvent({\n        userId: actorId,\n        entityType: \"USER\",\n        entityId: id,\n        actionType: \"DELETE\",\n      });\n      \n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ message: \"Error deleting user\" });\n    }\n  });\n\n  // Change own password\n  app.post(\"/api/auth/change-password\", isAuthenticated, async (req, res) => {\n    try {\n      const { currentPassword, newPassword } = req.body;\n      const userId = req.user!.id;\n\n      if (!currentPassword || !newPassword) {\n        return res.status(400).json({ message: \"كلمة المرور الحالية والجديدة مطلوبتان\" });\n      }\n\n      const user = await storage.getUser(userId);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      const isValid = await bcrypt.compare(currentPassword, user.password);\n      if (!isValid) {\n        return res.status(401).json({ message: \"كلمة المرور الحالية غير صحيحة\" });\n      }\n\n      const hashedPassword = await bcrypt.hash(newPassword, 10);\n      await storage.updateUser(userId, { password: hashedPassword });\n\n      logAuditEvent({\n        userId,\n        entityType: \"USER\",\n        entityId: userId,\n        actionType: \"UPDATE\",\n        details: { action: \"CHANGE_PASSWORD\" },\n      });\n\n      res.json({ success: true, message: \"تم تغيير كلمة المرور بنجاح\" });\n    } catch (error) {\n      res.status(500).json({ message: \"Error changing password\" });\n    }\n  });\n}\n","path":null,"size_bytes":18637,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1383,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"server/__tests__/auth.test.ts":{"content":"import assert from \"node:assert\";\nimport test from \"node:test\";\nimport type { Request, Response } from \"express\";\n\nprocess.env.DATABASE_URL ||= \"postgres://example.com:5432/test\";\n\nconst { requireRole } = await import(\"../auth\");\n\ntype MiddlewareResult = {\n  status: number;\n  body?: unknown;\n  nextCalled: boolean;\n};\n\nfunction runMiddleware(role: string): MiddlewareResult {\n  const middleware = requireRole([\"مدير\", \"محاسب\"]);\n\n  const req = {\n    isAuthenticated: () => true,\n    user: {\n      id: \"user-1\",\n      username: \"tester\",\n      firstName: \"Test\",\n      lastName: \"User\",\n      role,\n    },\n  } as unknown as Request;\n\n  const res = {\n    statusCode: 200,\n    body: undefined as unknown,\n    status(code: number) {\n      this.statusCode = code;\n      return this;\n    },\n    json(payload: unknown) {\n      this.body = payload;\n      return this;\n    },\n  } as unknown as Response & { statusCode: number; body?: unknown };\n\n  let nextCalled = false;\n\n  middleware(req, res, () => {\n    nextCalled = true;\n  });\n\n  return { status: (res as any).statusCode, body: (res as any).body, nextCalled };\n}\n\ntest(\"viewer role receives 403 with Arabic message\", () => {\n  const result = runMiddleware(\"مشاهد\");\n\n  assert.strictEqual(result.status, 403);\n  assert.deepStrictEqual(result.body, { message: \"ليست لديك صلاحية للقيام بهذا الإجراء\" });\n  assert.strictEqual(result.nextCalled, false);\n});\n\ntest(\"inventory manager role receives 403 with Arabic message\", () => {\n  const result = runMiddleware(\"مسؤول مخزون\");\n\n  assert.strictEqual(result.status, 403);\n  assert.deepStrictEqual(result.body, { message: \"ليست لديك صلاحية للقيام بهذا الإجراء\" });\n  assert.strictEqual(result.nextCalled, false);\n});\n\ntest(\"manager role proceeds to next middleware\", () => {\n  const result = runMiddleware(\"مدير\");\n\n  assert.strictEqual(result.status, 200);\n  assert.strictEqual(result.body, undefined);\n  assert.strictEqual(result.nextCalled, true);\n});\n","path":null,"size_bytes":2036,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":2359,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":710,"size_tokens":null},"client/src/pages/landing.tsx":{"content":"import { useState } from \"react\";\nimport { Ship, Package, CreditCard, BarChart3, Shield, Globe, Loader2 } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\nexport default function Landing() {\n  const [username, setUsername] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const loginMutation = useMutation({\n    mutationFn: async (data: { username: string; password: string }) => {\n      const res = await apiRequest(\"POST\", \"/api/login\", data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n      window.location.href = \"/\";\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"خطأ في تسجيل الدخول\",\n        description: error.message || \"اسم المستخدم أو كلمة المرور غير صحيحة\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!username || !password) {\n      toast({\n        title: \"خطأ\",\n        description: \"يرجى إدخال اسم المستخدم وكلمة المرور\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    loginMutation.mutate({ username, password });\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Hero Section */}\n      <div className=\"relative overflow-hidden\">\n        <div className=\"absolute inset-0 bg-gradient-to-bl from-primary/10 via-background to-background\" />\n        <div className=\"relative max-w-7xl mx-auto px-6 py-16\">\n          <div className=\"flex flex-col lg:flex-row items-center justify-between gap-12\">\n            {/* Left side - Branding */}\n            <div className=\"flex flex-col items-center lg:items-start text-center lg:text-right space-y-6 flex-1\">\n              <div className=\"flex items-center gap-4\">\n                <div className=\"w-16 h-16 rounded-lg bg-primary flex items-center justify-center shadow-lg\">\n                  <Ship className=\"w-10 h-10 text-primary-foreground\" />\n                </div>\n                <h1 className=\"text-4xl md:text-5xl font-bold\">Repit.AI</h1>\n              </div>\n              \n              <h2 className=\"text-2xl md:text-3xl font-semibold text-foreground max-w-xl leading-relaxed\">\n                نظام متكامل لإدارة الشحنات والتكاليف والمدفوعات\n              </h2>\n              \n              <p className=\"text-lg text-muted-foreground max-w-lg leading-relaxed\">\n                تتبع شحناتك من لحظة الشراء حتى الاستلام، مع حساب دقيق للتكاليف \n                بالجنيه المصري والرممبي الصيني\n              </p>\n            </div>\n\n            {/* Right side - Login Form */}\n            <Card className=\"w-full max-w-md\">\n              <CardHeader>\n                <CardTitle className=\"text-center\">تسجيل الدخول</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <form onSubmit={handleSubmit} className=\"space-y-4\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"username\">اسم المستخدم</Label>\n                    <Input\n                      id=\"username\"\n                      type=\"text\"\n                      value={username}\n                      onChange={(e) => setUsername(e.target.value)}\n                      placeholder=\"أدخل اسم المستخدم\"\n                      dir=\"ltr\"\n                      disabled={loginMutation.isPending}\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"password\">كلمة المرور</Label>\n                    <Input\n                      id=\"password\"\n                      type=\"password\"\n                      value={password}\n                      onChange={(e) => setPassword(e.target.value)}\n                      placeholder=\"أدخل كلمة المرور\"\n                      dir=\"ltr\"\n                      disabled={loginMutation.isPending}\n                    />\n                  </div>\n                  <Button\n                    type=\"submit\"\n                    className=\"w-full\"\n                    disabled={loginMutation.isPending}\n                    data-testid=\"button-login\"\n                  >\n                    {loginMutation.isPending ? (\n                      <>\n                        <Loader2 className=\"ml-2 h-4 w-4 animate-spin\" />\n                        جاري تسجيل الدخول...\n                      </>\n                    ) : (\n                      \"تسجيل الدخول\"\n                    )}\n                  </Button>\n                </form>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </div>\n\n      {/* Features Section */}\n      <div className=\"max-w-7xl mx-auto px-6 py-16\">\n        <h3 className=\"text-2xl font-semibold text-center mb-12\">المميزات الرئيسية</h3>\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          <FeatureCard\n            icon={Ship}\n            title=\"إدارة الشحنات\"\n            description=\"تتبع جميع شحناتك من مرحلة الشراء والشحن حتى الجمارك والتخريج والاستلام\"\n          />\n          <FeatureCard\n            icon={BarChart3}\n            title=\"حساب التكاليف\"\n            description=\"حساب دقيق لتكلفة الشراء والعمولة والشحن والجمارك والتخريج بالعملتين\"\n          />\n          <FeatureCard\n            icon={CreditCard}\n            title=\"متابعة السداد\"\n            description=\"تسجيل المدفوعات ومتابعة الأرصدة مع دعم الدفع الزائد\"\n          />\n          <FeatureCard\n            icon={Package}\n            title=\"المخزون\"\n            description=\"ربط الشحنات بالمخزون تلقائياً عند الاستلام مع حساب تكلفة الوحدة\"\n          />\n          <FeatureCard\n            icon={Globe}\n            title=\"أسعار الصرف\"\n            description=\"إدارة أسعار التحويل بين الرممبي والجنيه والدولار مع حفظ تاريخي\"\n          />\n          <FeatureCard\n            icon={Shield}\n            title=\"الصلاحيات\"\n            description=\"نظام صلاحيات متكامل مع أدوار متعددة: مدير، محاسب، مسؤول مخزون، ومشاهد\"\n          />\n        </div>\n      </div>\n\n      {/* Currencies Section */}\n      <div className=\"bg-card border-y border-border\">\n        <div className=\"max-w-7xl mx-auto px-6 py-16\">\n          <h3 className=\"text-2xl font-semibold text-center mb-8\">العملات المدعومة</h3>\n          <div className=\"flex flex-wrap justify-center gap-8\">\n            <div className=\"flex items-center gap-3 bg-background rounded-lg px-6 py-4 border\">\n              <span className=\"text-3xl font-bold text-primary\">¥</span>\n              <div>\n                <p className=\"font-semibold\">رممبي صيني</p>\n                <p className=\"text-sm text-muted-foreground\">RMB / CNY</p>\n              </div>\n            </div>\n            <div className=\"flex items-center gap-3 bg-background rounded-lg px-6 py-4 border\">\n              <span className=\"text-3xl font-bold text-primary\">ج.م</span>\n              <div>\n                <p className=\"font-semibold\">جنيه مصري</p>\n                <p className=\"text-sm text-muted-foreground\">EGP</p>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Footer */}\n      <footer className=\"max-w-7xl mx-auto px-6 py-12 text-center\">\n        <p className=\"text-muted-foreground\">\n          © {new Date().getFullYear()} Repit.AI - نظام إدارة الشحنات والتكاليف\n        </p>\n      </footer>\n    </div>\n  );\n}\n\nfunction FeatureCard({\n  icon: Icon,\n  title,\n  description,\n}: {\n  icon: typeof Ship;\n  title: string;\n  description: string;\n}) {\n  return (\n    <Card className=\"hover-elevate transition-all duration-200\">\n      <CardContent className=\"p-6\">\n        <div className=\"flex flex-col gap-4\">\n          <div className=\"w-12 h-12 rounded-md bg-primary/10 flex items-center justify-center\">\n            <Icon className=\"w-6 h-6 text-primary\" />\n          </div>\n          <h4 className=\"text-lg font-semibold\">{title}</h4>\n          <p className=\"text-muted-foreground leading-relaxed\">{description}</p>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":9127,"size_tokens":null},"server/services/shipments.ts":{"content":"import { db } from \"../db\";\nimport {\n  insertShipmentItemSchema,\n  insertShipmentSchema,\n  shipmentItems,\n  shipmentShippingDetails,\n  shipments,\n  exchangeRates,\n} from \"@shared/schema\";\nimport { and, desc, eq } from \"drizzle-orm\";\n\nclass ShipmentServiceError extends Error {\n  status: number;\n\n  constructor(message: string, status = 400) {\n    super(message);\n    this.status = status;\n  }\n}\n\nfunction parseNumber(value: string | number | null | undefined): number {\n  if (value === null || value === undefined) return 0;\n  const parsed = typeof value === \"number\" ? value : parseFloat(value);\n  return Number.isFinite(parsed) ? parsed : 0;\n}\n\nasync function getLatestRmbToEgpRate(tx: any): Promise<number> {\n  const [rate] = await tx\n    .select()\n    .from(exchangeRates)\n    .where(and(eq(exchangeRates.fromCurrency, \"RMB\"), eq(exchangeRates.toCurrency, \"EGP\")))\n    .orderBy(desc(exchangeRates.rateDate))\n    .limit(1);\n\n  return rate ? parseNumber(rate.rateValue) : 7.15;\n}\n\nexport const shipmentService = {\n  async createShipment(payload: any, userId?: string) {\n    const { items = [], ...shipmentData } = payload || {};\n\n    if (!Array.isArray(items)) {\n      throw new ShipmentServiceError(\"قائمة البنود غير صالحة\");\n    }\n\n    let parsedShipment;\n    try {\n      parsedShipment = insertShipmentSchema.parse({\n        ...shipmentData,\n        createdByUserId: userId ?? shipmentData.createdByUserId,\n      });\n    } catch (error) {\n      throw new ShipmentServiceError(\"البيانات الأساسية للشحنة غير صالحة\");\n    }\n\n    return db.transaction(async (tx) => {\n      const [shipment] = await tx.insert(shipments).values(parsedShipment).returning();\n\n      const validatedItems = items.map((item) => {\n        try {\n          return insertShipmentItemSchema.parse({ ...item, shipmentId: shipment.id });\n        } catch (error) {\n          throw new ShipmentServiceError(\"بيانات البنود غير صالحة\");\n        }\n      });\n\n      if (validatedItems.length > 0) {\n        await tx.insert(shipmentItems).values(validatedItems);\n      }\n\n      const allItems = await tx\n        .select()\n        .from(shipmentItems)\n        .where(eq(shipmentItems.shipmentId, shipment.id));\n\n      const totalPurchaseCostRmb = allItems.reduce(\n        (sum, item) => sum + parseNumber(item.totalPurchaseCostRmb),\n        0\n      );\n\n      const totalCustomsCostEgp = allItems.reduce((sum, item) => {\n        return sum + (item.cartonsCtn || 0) * parseNumber(item.customsCostPerCartonEgp);\n      }, 0);\n\n      const totalTakhreegCostEgp = allItems.reduce((sum, item) => {\n        return sum + (item.cartonsCtn || 0) * parseNumber(item.takhreegCostPerCartonEgp);\n      }, 0);\n\n      const rmbToEgp = await getLatestRmbToEgpRate(tx);\n      const purchaseCostEgp = totalPurchaseCostRmb * rmbToEgp;\n      const finalTotalCostEgp = purchaseCostEgp + totalCustomsCostEgp + totalTakhreegCostEgp;\n\n      await tx\n        .update(shipments)\n        .set({\n          purchaseCostRmb: totalPurchaseCostRmb.toFixed(2),\n          purchaseCostEgp: purchaseCostEgp.toFixed(2),\n          customsCostEgp: totalCustomsCostEgp.toFixed(2),\n          takhreegCostEgp: totalTakhreegCostEgp.toFixed(2),\n          finalTotalCostEgp: finalTotalCostEgp.toFixed(2),\n          balanceEgp: finalTotalCostEgp.toFixed(2),\n          updatedAt: new Date(),\n        })\n        .where(eq(shipments.id, shipment.id));\n\n      const [updatedShipment] = await tx.select().from(shipments).where(eq(shipments.id, shipment.id));\n      return updatedShipment;\n    });\n  },\n\n  async updateShipment(shipmentId: number, payload: any) {\n    const { step, shipmentData, items, shippingData } = payload || {};\n\n    return db.transaction(async (tx) => {\n      const [existingShipment] = await tx\n        .select()\n        .from(shipments)\n        .where(eq(shipments.id, shipmentId));\n\n      if (!existingShipment) {\n        throw new ShipmentServiceError(\"الشحنة غير موجودة\", 404);\n      }\n\n      if (shipmentData) {\n        try {\n          const { id: _, ...rest } = shipmentData;\n          const parsedShipmentData = insertShipmentSchema.partial().parse(rest);\n          await tx\n            .update(shipments)\n            .set({ ...parsedShipmentData, updatedAt: new Date() })\n            .where(eq(shipments.id, shipmentId));\n        } catch (error) {\n          throw new ShipmentServiceError(\"بيانات الشحنة غير صالحة\");\n        }\n      }\n\n      if (items !== undefined) {\n        if (!Array.isArray(items)) {\n          throw new ShipmentServiceError(\"قائمة البنود غير صالحة\");\n        }\n\n        const validatedItems = items.map((item) => {\n          try {\n            return insertShipmentItemSchema.parse({ ...item, shipmentId });\n          } catch (error) {\n            throw new ShipmentServiceError(\"بيانات البنود غير صالحة\");\n          }\n        });\n\n        await tx.delete(shipmentItems).where(eq(shipmentItems.shipmentId, shipmentId));\n        if (validatedItems.length > 0) {\n          await tx.insert(shipmentItems).values(validatedItems);\n        }\n\n        const allItems = await tx\n          .select()\n          .from(shipmentItems)\n          .where(eq(shipmentItems.shipmentId, shipmentId));\n\n        const totalPurchaseCostRmb = allItems.reduce(\n          (sum, item) => sum + parseNumber(item.totalPurchaseCostRmb),\n          0\n        );\n\n        const totalCustomsCostEgp = allItems.reduce((sum, item) => {\n          return sum + (item.cartonsCtn || 0) * parseNumber(item.customsCostPerCartonEgp);\n        }, 0);\n\n        const totalTakhreegCostEgp = allItems.reduce((sum, item) => {\n          return sum + (item.cartonsCtn || 0) * parseNumber(item.takhreegCostPerCartonEgp);\n        }, 0);\n\n        await tx\n          .update(shipments)\n          .set({\n            purchaseCostRmb: totalPurchaseCostRmb.toFixed(2),\n            customsCostEgp: totalCustomsCostEgp.toFixed(2),\n            takhreegCostEgp: totalTakhreegCostEgp.toFixed(2),\n            updatedAt: new Date(),\n          })\n          .where(eq(shipments.id, shipmentId));\n      }\n\n      if (shippingData) {\n        const rmbToEgp = parseNumber(shippingData.rmbToEgpRate || 1);\n        const usdToRmb = parseNumber(shippingData.usdToRmbRate || 1);\n\n        const [shipmentForShipping] = await tx\n          .select()\n          .from(shipments)\n          .where(eq(shipments.id, shipmentId));\n\n        const totalPurchaseCostRmb = parseNumber(shipmentForShipping?.purchaseCostRmb);\n\n        const commissionRmb =\n          (totalPurchaseCostRmb * parseNumber(shippingData.commissionRatePercent)) / 100;\n        const commissionEgp = commissionRmb * rmbToEgp;\n\n        const shippingCostUsd =\n          parseNumber(shippingData.shippingAreaSqm) *\n          parseNumber(shippingData.shippingCostPerSqmUsdOriginal);\n        const shippingCostRmb = shippingCostUsd * usdToRmb;\n        const shippingCostEgp = shippingCostRmb * rmbToEgp;\n\n        const shippingPayload = {\n          shipmentId,\n          totalPurchaseCostRmb: totalPurchaseCostRmb.toFixed(2),\n          commissionRatePercent: shippingData.commissionRatePercent,\n          commissionValueRmb: commissionRmb.toFixed(2),\n          commissionValueEgp: commissionEgp.toFixed(2),\n          shippingAreaSqm: shippingData.shippingAreaSqm,\n          shippingCostPerSqmUsdOriginal: shippingData.shippingCostPerSqmUsdOriginal,\n          totalShippingCostUsdOriginal: shippingCostUsd.toFixed(2),\n          totalShippingCostRmb: shippingCostRmb.toFixed(2),\n          totalShippingCostEgp: shippingCostEgp.toFixed(2),\n          shippingDate: shippingData.shippingDate || null,\n          rmbToEgpRateAtShipping: shippingData.rmbToEgpRate,\n          usdToRmbRateAtShipping: shippingData.usdToRmbRate,\n        };\n\n        await tx\n          .insert(shipmentShippingDetails)\n          .values(shippingPayload)\n          .onConflictDoUpdate({\n            target: shipmentShippingDetails.shipmentId,\n            set: { ...shippingPayload, updatedAt: new Date() },\n          });\n\n        const purchaseCostEgp = totalPurchaseCostRmb * rmbToEgp;\n\n        await tx\n          .update(shipments)\n          .set({\n            purchaseCostEgp: purchaseCostEgp.toFixed(2),\n            commissionCostRmb: commissionRmb.toFixed(2),\n            commissionCostEgp: commissionEgp.toFixed(2),\n            shippingCostRmb: shippingCostRmb.toFixed(2),\n            shippingCostEgp: shippingCostEgp.toFixed(2),\n            updatedAt: new Date(),\n          })\n          .where(eq(shipments.id, shipmentId));\n      }\n\n      const [shipment] = await tx.select().from(shipments).where(eq(shipments.id, shipmentId));\n      if (!shipment) {\n        throw new ShipmentServiceError(\"تعذر تحديث الشحنة\");\n      }\n\n      const purchaseCostEgp = parseNumber(shipment.purchaseCostEgp);\n      const commissionCostEgp = parseNumber(shipment.commissionCostEgp);\n      const shippingCostEgp = parseNumber(shipment.shippingCostEgp);\n      const customsCostEgp = parseNumber(shipment.customsCostEgp);\n      const takhreegCostEgp = parseNumber(shipment.takhreegCostEgp);\n\n      const finalTotalCostEgp =\n        purchaseCostEgp + commissionCostEgp + shippingCostEgp + customsCostEgp + takhreegCostEgp;\n\n      const totalPaidEgp = parseNumber(shipment.totalPaidEgp);\n      const balanceEgp = Math.max(0, finalTotalCostEgp - totalPaidEgp);\n\n      let newStatus = shipment.status;\n      if (step === 2 && shippingData) {\n        newStatus = \"جاهزة للاستلام\";\n      } else if (step === 4) {\n        newStatus = \"مستلمة بنجاح\";\n      }\n\n      await tx\n        .update(shipments)\n        .set({\n          finalTotalCostEgp: finalTotalCostEgp.toFixed(2),\n          balanceEgp: balanceEgp.toFixed(2),\n          status: newStatus,\n          updatedAt: new Date(),\n        })\n        .where(eq(shipments.id, shipmentId));\n\n      const [updatedShipment] = await tx\n        .select()\n        .from(shipments)\n        .where(eq(shipments.id, shipmentId));\n      return updatedShipment;\n    });\n  },\n};\n\nexport { ShipmentServiceError };\n","path":null,"size_bytes":10128,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2154,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5128,"size_tokens":null},"server/vite.ts":{"content":"import { type Express } from \"express\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport async function setupVite(server: Server, app: Express) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server, path: \"/vite-hmr\" },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n","path":null,"size_bytes":1534,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1202,"size_tokens":null},"design_guidelines.md":{"content":"# Design Guidelines: Repit.AI Shipment Management System\n\n## Design Approach: Enterprise Data System\n\n**Selected Framework**: Material Design + Carbon Design System principles adapted for Arabic RTL\n**Justification**: Data-intensive business application requiring clean information hierarchy, robust form patterns, and professional credibility. Material's structured approach combined with Carbon's enterprise focus provides optimal foundation for complex financial workflows.\n\n**Core Principles**:\n- Information clarity over visual flair\n- Predictable, consistent patterns across all modules\n- Efficient data entry and review workflows\n- Professional credibility for financial operations\n\n---\n\n## RTL (Right-to-Left) Implementation\n\n**Critical RTL Requirements**:\n- All layouts mirror horizontally: navigation on right, content flows right-to-left\n- Form labels positioned to the right of inputs\n- Icons and chevrons flip direction (back arrow points right →)\n- Tables read right-to-left with primary columns on right\n- Number formatting: keep Arabic-Indic numerals with RTL directionality\n- Breadcrumbs flow right-to-left with appropriate separators (← not →)\n\n---\n\n## Typography System\n\n**Font Family**: \n- Primary: 'Cairo' or 'Tajawal' from Google Fonts (excellent Arabic readability)\n- Fallback: system Arabic fonts\n\n**Type Scale**:\n- Page Titles: text-3xl (30px) font-semibold\n- Section Headers: text-xl (20px) font-semibold  \n- Card/Module Titles: text-lg (18px) font-medium\n- Body Text: text-base (16px) font-normal\n- Labels/Captions: text-sm (14px) font-medium\n- Helper Text: text-xs (12px) font-normal\n\n**Special Considerations**:\n- Increase line-height by 0.1-0.2 for Arabic text (leading-relaxed)\n- Use font-semibold for emphasis rather than bold to maintain readability\n\n---\n\n## Layout & Spacing System\n\n**Spacing Primitives** (Tailwind units):\n- Use: 2, 4, 6, 8, 12, 16 for consistency\n- Component padding: p-4 to p-6\n- Section spacing: py-8 to py-12\n- Card gaps: gap-4 to gap-6\n- Form field spacing: space-y-4\n\n**Grid Structure**:\n- Dashboard: 12-column responsive grid (grid-cols-12)\n- Forms: 2-column on desktop (md:grid-cols-2), single column mobile\n- Data tables: Full-width with horizontal scroll on mobile\n- Cards: 2-3 column grids (md:grid-cols-2 lg:grid-cols-3)\n\n**Container Widths**:\n- Full application: max-w-7xl mx-auto\n- Forms/Detail views: max-w-4xl\n- Narrow content: max-w-2xl\n\n---\n\n## Application Structure\n\n**Main Layout**:\n- Right-side navigation drawer (280px width) with collapsible sections\n- Top app bar: 64px height with breadcrumbs, user menu, notifications\n- Main content area: p-6 with max-w-7xl container\n\n**Navigation Patterns**:\n- Primary nav: Vertical menu on right with icons + labels + tooltips\n- Secondary nav: Horizontal tabs within modules\n- Breadcrumbs: Always visible showing hierarchy\n- Action buttons: Top-right of content sections (primary actions sticky)\n\n---\n\n## Component Library\n\n**Forms**:\n- Input fields: h-10 with border, rounded-md, clear focus states\n- Labels: Above inputs (mb-2) in RTL context\n- Required indicators: Red asterisk after label (on left side in RTL)\n- Validation: Inline error messages below fields (text-sm)\n- Multi-step forms: Progress stepper at top showing 4 steps\n\n**Data Display**:\n- Tables: Striped rows, hover states, sticky headers, right-aligned primary columns\n- Cards: Rounded-lg with shadow-sm, p-4 to p-6 internal padding\n- Stats cards: Large number display with supporting label and trend indicator\n- Summary panels: Background treatment with border, organized key-value pairs\n\n**Action Components**:\n- Primary buttons: h-10 px-6 rounded-md font-medium\n- Secondary buttons: Outlined variant, same sizing\n- Icon buttons: w-10 h-10 rounded-full for compact actions\n- Dropdown menus: Right-aligned in RTL, consistent with navigation\n\n**Data Entry**:\n- Add item rows: Repeatable form sections with delete action\n- Inline editing: Click-to-edit pattern for table cells\n- Autocomplete: Dropdown suggestions for suppliers, products\n- Date pickers: Arabic calendar support with RTL layout\n\n**Feedback**:\n- Toast notifications: Top-left (RTL adjusted) with auto-dismiss\n- Modal dialogs: Centered, max-w-lg, clear hierarchy\n- Loading states: Skeleton screens for data-heavy sections\n- Empty states: Centered icon + message + action button\n\n---\n\n## Module-Specific Patterns\n\n**Dashboard/Overview**:\n- Top: 4-stat summary cards (shipments count, total costs, payments, balance)\n- Middle: Recent shipments table with quick actions\n- Bottom: Split view - payment summary + pending actions\n\n**Shipment Detail (4-Step Process)**:\n- Horizontal progress stepper showing: الاستيراد → بيانات الشحن → الجمارك والتخريج → ملخص الشحنة\n- Each step: Full-width form with section groupings\n- Right sidebar: Sticky summary showing running totals\n- Bottom: Action bar with \"حفظ\" (Save) and navigation buttons\n\n**Items Entry Table**:\n- Spreadsheet-like interface with inline editing\n- Calculated fields auto-update (COU, totals)\n- Row actions: Duplicate, Delete on right edge\n- Add row button: Prominent at table bottom\n\n**Payments Module**:\n- Split layout: Left (RTL = right) shows shipment list with balances, Right shows payment form\n- Payment history: Timeline view with payment method icons\n- Balance indicators: Clear visual treatment for overpaid/underpaid states\n\n---\n\n## Visual Hierarchy\n\n**Emphasis Patterns**:\n- Financial totals: Larger text (text-2xl), semibold, distinct spacing\n- Status badges: Rounded-full px-3 py-1 with meaningful treatments per status\n- Critical actions: Visually distinct, positioned consistently top-right\n- Secondary info: Reduced opacity (opacity-70) or smaller text\n\n**Information Density**:\n- Balance white space with data density\n- Group related fields with background panels\n- Use dividers sparingly (border-t opacity-10)\n- Collapsible sections for optional/advanced fields\n\n---\n\n## Accessibility & Usability\n\n- Consistent tab order (RTL-aware)\n- Clear focus indicators on all interactive elements  \n- Proper ARIA labels in Arabic\n- Keyboard shortcuts for common actions (documented in tooltips)\n- Minimum touch target: 44x44px for mobile\n- High contrast text (minimum WCAG AA)\n\n---\n\n## Professional Polish\n\n- Subtle shadows: shadow-sm for cards, shadow-md for elevated elements\n- Consistent border radius: rounded-md (6px) for most elements\n- Hover states: Slight opacity change or subtle background shift\n- Transitions: duration-200 for interactive elements\n- Loading spinners: Centered with contextual message\n\nThis design system prioritizes **efficient workflows, data clarity, and professional credibility** over decorative elements, perfectly suited for a business-critical financial management application.","path":null,"size_bytes":6780,"size_tokens":null},"server/shipmentService.ts":{"content":"import { and, desc, eq } from \"drizzle-orm\";\nimport { ZodError } from \"zod\";\nimport {\n  exchangeRates,\n  insertShipmentItemSchema,\n  insertShipmentSchema,\n  shipmentItems,\n  shipments,\n  shipmentShippingDetails,\n  type InsertShipmentItem,\n  type Shipment,\n  type ShipmentItem,\n} from \"@shared/schema\";\nimport { db } from \"./db\";\n\ntype CreateShipmentPayload = {\n  items?: unknown[];\n  [key: string]: unknown;\n};\n\ntype UpdateShipmentPayload = {\n  step?: number;\n  shipmentData?: unknown;\n  items?: unknown[];\n  shippingData?: any;\n};\n\nfunction calculateItemTotals(items: ShipmentItem[]) {\n  const purchaseCostRmb = items.reduce(\n    (sum, item) => sum + parseFloat(item.totalPurchaseCostRmb || \"0\"),\n    0\n  );\n\n  const customsCostEgp = items.reduce((sum, item) => {\n    const ctn = item.cartonsCtn || 0;\n    const customsPerCarton = parseFloat(item.customsCostPerCartonEgp || \"0\");\n    return sum + ctn * customsPerCarton;\n  }, 0);\n\n  const takhreegCostEgp = items.reduce((sum, item) => {\n    const ctn = item.cartonsCtn || 0;\n    const takhreegPerCarton = parseFloat(item.takhreegCostPerCartonEgp || \"0\");\n    return sum + ctn * takhreegPerCarton;\n  }, 0);\n\n  return {\n    purchaseCostRmb,\n    customsCostEgp,\n    takhreegCostEgp,\n  };\n}\n\nexport async function createShipmentWithItems(\n  payload: CreateShipmentPayload,\n  userId?: string\n): Promise<Shipment> {\n  const { items = [], ...shipmentData } = payload || {};\n\n  try {\n    const validatedShipment = insertShipmentSchema.parse({\n      ...shipmentData,\n      createdByUserId: userId,\n    });\n\n    const parsedItems = (items as unknown[]).map((item) =>\n      insertShipmentItemSchema.omit({ shipmentId: true }).parse(item)\n    );\n\n    const shipment = await db.transaction(async (tx) => {\n      const [createdShipment] = await tx\n        .insert(shipments)\n        .values(validatedShipment)\n        .returning();\n\n      const insertedItems: ShipmentItem[] = [];\n      for (const item of parsedItems) {\n        const [insertedItem] = await tx\n          .insert(shipmentItems)\n          .values({ ...item, shipmentId: createdShipment.id })\n          .returning();\n        insertedItems.push(insertedItem);\n      }\n\n      const totals = calculateItemTotals(insertedItems);\n\n      const [latestRmbRate] = await tx\n        .select()\n        .from(exchangeRates)\n        .where(\n          and(eq(exchangeRates.fromCurrency, \"RMB\"), eq(exchangeRates.toCurrency, \"EGP\"))\n        )\n        .orderBy(desc(exchangeRates.rateDate))\n        .limit(1);\n\n      const rmbToEgp = latestRmbRate ? parseFloat(latestRmbRate.rateValue) : 7.15;\n      const purchaseCostEgp = totals.purchaseCostRmb * rmbToEgp;\n      const finalTotalCostEgp = purchaseCostEgp + totals.customsCostEgp + totals.takhreegCostEgp;\n\n      const [updatedShipment] = await tx\n        .update(shipments)\n        .set({\n          purchaseCostRmb: totals.purchaseCostRmb.toFixed(2),\n          purchaseCostEgp: purchaseCostEgp.toFixed(2),\n          customsCostEgp: totals.customsCostEgp.toFixed(2),\n          takhreegCostEgp: totals.takhreegCostEgp.toFixed(2),\n          finalTotalCostEgp: finalTotalCostEgp.toFixed(2),\n          balanceEgp: finalTotalCostEgp.toFixed(2),\n          updatedAt: new Date(),\n        })\n        .where(eq(shipments.id, createdShipment.id))\n        .returning();\n\n      return updatedShipment;\n    });\n\n    return shipment;\n  } catch (error) {\n    if (error instanceof ZodError) {\n      throw new Error(\"بيانات الشحنة أو البنود غير صالحة\");\n    }\n    throw new Error(\"تعذر إنشاء الشحنة، يرجى المحاولة مرة أخرى\");\n  }\n}\n\nexport async function updateShipmentWithItems(\n  shipmentId: number,\n  payload: UpdateShipmentPayload\n): Promise<Shipment> {\n  const { step, shipmentData, items, shippingData } = payload || {};\n\n  try {\n    const validatedShipmentData = shipmentData\n      ? insertShipmentSchema.partial().parse(shipmentData)\n      : undefined;\n\n    const parsedItems = items && Array.isArray(items)\n      ? (items as unknown[]).map((item) =>\n          insertShipmentItemSchema.omit({ shipmentId: true }).parse(item)\n        )\n      : undefined;\n\n    const shipment = await db.transaction(async (tx) => {\n      const [existingShipment] = await tx\n        .select()\n        .from(shipments)\n        .where(eq(shipments.id, shipmentId));\n\n      if (!existingShipment) {\n        throw new Error(\"الشحنة غير موجودة\");\n      }\n\n      let currentShipment = existingShipment;\n\n      if (validatedShipmentData) {\n        const [updated] = await tx\n          .update(shipments)\n          .set({ ...validatedShipmentData, updatedAt: new Date() })\n          .where(eq(shipments.id, shipmentId))\n          .returning();\n        if (updated) {\n          currentShipment = updated;\n        }\n      }\n\n      if (parsedItems) {\n        await tx.delete(shipmentItems).where(eq(shipmentItems.shipmentId, shipmentId));\n\n        const insertedItems: ShipmentItem[] = [];\n        for (const item of parsedItems as InsertShipmentItem[]) {\n          const [insertedItem] = await tx\n            .insert(shipmentItems)\n            .values({ ...item, shipmentId })\n            .returning();\n          insertedItems.push(insertedItem);\n        }\n\n        const totals = calculateItemTotals(insertedItems);\n\n        const [updatedAfterItems] = await tx\n          .update(shipments)\n          .set({\n            purchaseCostRmb: totals.purchaseCostRmb.toFixed(2),\n            customsCostEgp: totals.customsCostEgp.toFixed(2),\n            takhreegCostEgp: totals.takhreegCostEgp.toFixed(2),\n            updatedAt: new Date(),\n          })\n          .where(eq(shipments.id, shipmentId))\n          .returning();\n\n        if (updatedAfterItems) {\n          currentShipment = updatedAfterItems;\n        } else {\n          currentShipment = {\n            ...currentShipment,\n            purchaseCostRmb: totals.purchaseCostRmb.toFixed(2),\n            customsCostEgp: totals.customsCostEgp.toFixed(2),\n            takhreegCostEgp: totals.takhreegCostEgp.toFixed(2),\n          } as Shipment;\n        }\n      }\n\n      if (shippingData) {\n        const rmbToEgp = parseFloat(shippingData.rmbToEgpRate || \"1\");\n        const usdToRmb = parseFloat(shippingData.usdToRmbRate || \"1\");\n\n        const totalPurchaseCostRmb = parseFloat(currentShipment.purchaseCostRmb || \"0\");\n        const commissionRmb =\n          (totalPurchaseCostRmb * parseFloat(shippingData.commissionRatePercent || \"0\")) /\n          100;\n        const commissionEgp = commissionRmb * rmbToEgp;\n\n        const shippingCostUsd =\n          parseFloat(shippingData.shippingAreaSqm || \"0\") *\n          parseFloat(shippingData.shippingCostPerSqmUsdOriginal || \"0\");\n        const shippingCostRmb = shippingCostUsd * usdToRmb;\n        const shippingCostEgp = shippingCostRmb * rmbToEgp;\n\n        await tx\n          .insert(shipmentShippingDetails)\n          .values({\n            shipmentId,\n            totalPurchaseCostRmb: totalPurchaseCostRmb.toFixed(2),\n            commissionRatePercent: shippingData.commissionRatePercent,\n            commissionValueRmb: commissionRmb.toFixed(2),\n            commissionValueEgp: commissionEgp.toFixed(2),\n            shippingAreaSqm: shippingData.shippingAreaSqm,\n            shippingCostPerSqmUsdOriginal: shippingData.shippingCostPerSqmUsdOriginal,\n            totalShippingCostUsdOriginal: shippingCostUsd.toFixed(2),\n            totalShippingCostRmb: shippingCostRmb.toFixed(2),\n            totalShippingCostEgp: shippingCostEgp.toFixed(2),\n            shippingDate: shippingData.shippingDate,\n            rmbToEgpRateAtShipping: shippingData.rmbToEgpRate,\n            usdToRmbRateAtShipping: shippingData.usdToRmbRate,\n            sourceOfRates: shippingData.sourceOfRates,\n          })\n          .onConflictDoUpdate({\n            target: shipmentShippingDetails.shipmentId,\n            set: {\n              totalPurchaseCostRmb: totalPurchaseCostRmb.toFixed(2),\n              commissionRatePercent: shippingData.commissionRatePercent,\n              commissionValueRmb: commissionRmb.toFixed(2),\n              commissionValueEgp: commissionEgp.toFixed(2),\n              shippingAreaSqm: shippingData.shippingAreaSqm,\n              shippingCostPerSqmUsdOriginal: shippingData.shippingCostPerSqmUsdOriginal,\n              totalShippingCostUsdOriginal: shippingCostUsd.toFixed(2),\n              totalShippingCostRmb: shippingCostRmb.toFixed(2),\n              totalShippingCostEgp: shippingCostEgp.toFixed(2),\n              shippingDate: shippingData.shippingDate,\n              rmbToEgpRateAtShipping: shippingData.rmbToEgpRate,\n              usdToRmbRateAtShipping: shippingData.usdToRmbRate,\n              sourceOfRates: shippingData.sourceOfRates,\n              updatedAt: new Date(),\n            },\n          })\n          .returning();\n\n        const [updatedAfterShipping] = await tx\n          .update(shipments)\n          .set({\n            purchaseCostEgp: (totalPurchaseCostRmb * rmbToEgp).toFixed(2),\n            commissionCostRmb: commissionRmb.toFixed(2),\n            commissionCostEgp: commissionEgp.toFixed(2),\n            shippingCostRmb: shippingCostRmb.toFixed(2),\n            shippingCostEgp: shippingCostEgp.toFixed(2),\n            updatedAt: new Date(),\n          })\n          .where(eq(shipments.id, shipmentId))\n          .returning();\n\n        if (updatedAfterShipping) {\n          currentShipment = updatedAfterShipping;\n        }\n      }\n\n      const [latestShipment] = await tx\n        .select()\n        .from(shipments)\n        .where(eq(shipments.id, shipmentId));\n\n      const shipmentForTotals = latestShipment || currentShipment;\n\n      const purchaseCostEgp = parseFloat(shipmentForTotals.purchaseCostEgp || \"0\");\n      const commissionCostEgp = parseFloat(shipmentForTotals.commissionCostEgp || \"0\");\n      const shippingCostEgp = parseFloat(shipmentForTotals.shippingCostEgp || \"0\");\n      const customsCostEgp = parseFloat(shipmentForTotals.customsCostEgp || \"0\");\n      const takhreegCostEgp = parseFloat(shipmentForTotals.takhreegCostEgp || \"0\");\n\n      const finalTotalCostEgp =\n        purchaseCostEgp + commissionCostEgp + shippingCostEgp + customsCostEgp + takhreegCostEgp;\n\n      const totalPaidEgp = parseFloat(shipmentForTotals.totalPaidEgp || \"0\");\n      const balanceEgp = Math.max(0, finalTotalCostEgp - totalPaidEgp);\n\n      let newStatus = shipmentForTotals.status;\n      if (step === 2 && shippingData) {\n        newStatus = \"جاهزة للاستلام\";\n      } else if (step === 4) {\n        newStatus = \"مستلمة بنجاح\";\n      }\n\n      const [finalShipment] = await tx\n        .update(shipments)\n        .set({\n          finalTotalCostEgp: finalTotalCostEgp.toFixed(2),\n          balanceEgp: balanceEgp.toFixed(2),\n          status: newStatus,\n          updatedAt: new Date(),\n        })\n        .where(eq(shipments.id, shipmentId))\n        .returning();\n\n      return finalShipment || shipmentForTotals;\n    });\n\n    return shipment;\n  } catch (error) {\n    if (error instanceof ZodError) {\n      throw new Error(\"بيانات الشحنة أو البنود غير صالحة\");\n    }\n    throw new Error((error as Error)?.message || \"تعذر تحديث الشحنة\");\n  }\n}\n","path":null,"size_bytes":11219,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":261,"size_tokens":null},"server/static.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(__dirname, \"public\");\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":547,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3848,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1139,"size_tokens":null},"client/src/pages/inventory.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport {\n  Package,\n  Search,\n  Ship,\n  Calendar,\n  DollarSign,\n  TrendingUp,\n  Filter,\n} from \"lucide-react\";\nimport { useState } from \"react\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport type { InventoryMovement, ShipmentItem, Shipment } from \"@shared/schema\";\n\ninterface InventoryStats {\n  totalPieces: number;\n  totalCostEgp: string;\n  totalItems: number;\n  avgUnitCostEgp: string;\n}\n\nexport default function Inventory() {\n  const [search, setSearch] = useState(\"\");\n  const [dateFrom, setDateFrom] = useState(\"\");\n  const [dateTo, setDateTo] = useState(\"\");\n  const [shipmentCodeFilter, setShipmentCodeFilter] = useState(\"\");\n\n  const { data: stats, isLoading: loadingStats } = useQuery<InventoryStats>({\n    queryKey: [\"/api/inventory/stats\"],\n  });\n\n  const { data: movements, isLoading: loadingMovements } = useQuery<\n    (InventoryMovement & { shipmentItem?: ShipmentItem; shipment?: Shipment })[]\n  >({\n    queryKey: [\"/api/inventory\"],\n  });\n\n  const formatCurrency = (value: string | number | null) => {\n    const num = typeof value === \"string\" ? parseFloat(value) : value;\n    return new Intl.NumberFormat(\"ar-EG\", {\n      minimumFractionDigits: 2,\n      maximumFractionDigits: 2,\n    }).format(num || 0);\n  };\n\n  const formatDate = (date: string | Date | null) => {\n    if (!date) return \"-\";\n    return new Date(date).toLocaleDateString(\"ar-EG\");\n  };\n\n  const filteredMovements = movements?.filter((m) => {\n    const matchesSearch =\n      !search ||\n      m.shipmentItem?.productName?.toLowerCase().includes(search.toLowerCase()) ||\n      m.shipment?.shipmentCode?.toLowerCase().includes(search.toLowerCase());\n\n    const matchesShipmentCode =\n      !shipmentCodeFilter ||\n      m.shipment?.shipmentCode?.toLowerCase().includes(shipmentCodeFilter.toLowerCase());\n\n    // Date range filter\n    let matchesDateRange = true;\n    if (dateFrom || dateTo) {\n      const movementDate = m.movementDate ? new Date(m.movementDate) : null;\n      if (movementDate) {\n        if (dateFrom) {\n          const fromDate = new Date(dateFrom);\n          if (movementDate < fromDate) matchesDateRange = false;\n        }\n        if (dateTo) {\n          const toDate = new Date(dateTo);\n          toDate.setHours(23, 59, 59, 999);\n          if (movementDate > toDate) matchesDateRange = false;\n        }\n      }\n    }\n\n    return matchesSearch && matchesShipmentCode && matchesDateRange;\n  });\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      {/* Header */}\n      <div>\n        <h1 className=\"text-3xl font-semibold\">المخزون</h1>\n        <p className=\"text-muted-foreground mt-1\">\n          متابعة الأصناف المستلمة وتكلفتها في المخزون\n        </p>\n      </div>\n\n      {/* Stats Cards */}\n      {loadingStats ? (\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4\">\n          {[1, 2, 3, 4].map((i) => (\n            <Skeleton key={i} className=\"h-28\" />\n          ))}\n        </div>\n      ) : (\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4\">\n          <StatCard\n            title=\"إجمالي الأصناف\"\n            value={stats?.totalItems?.toString() || \"0\"}\n            icon={Package}\n          />\n          <StatCard\n            title=\"إجمالي القطع\"\n            value={new Intl.NumberFormat(\"ar-EG\").format(stats?.totalPieces || 0)}\n            icon={Ship}\n          />\n          <StatCard\n            title=\"إجمالي التكلفة\"\n            value={`${formatCurrency(stats?.totalCostEgp || 0)} ج.م`}\n            icon={DollarSign}\n          />\n          <StatCard\n            title=\"متوسط تكلفة الوحدة\"\n            value={`${formatCurrency(stats?.avgUnitCostEgp || 0)} ج.م`}\n            icon={TrendingUp}\n          />\n        </div>\n      )}\n\n      {/* Filters */}\n      <Card>\n        <CardContent className=\"p-4\">\n          <div className=\"flex flex-wrap items-center gap-4\">\n            <div className=\"relative flex-1 min-w-[200px]\">\n              <Search className=\"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\n              <Input\n                placeholder=\"بحث بالمنتج...\"\n                value={search}\n                onChange={(e) => setSearch(e.target.value)}\n                className=\"pr-10\"\n                data-testid=\"input-search-inventory\"\n              />\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Ship className=\"w-4 h-4 text-muted-foreground\" />\n              <Input\n                placeholder=\"رقم الشحنة...\"\n                value={shipmentCodeFilter}\n                onChange={(e) => setShipmentCodeFilter(e.target.value)}\n                className=\"w-[150px]\"\n                data-testid=\"input-shipment-code-filter\"\n              />\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Calendar className=\"w-4 h-4 text-muted-foreground\" />\n              <div className=\"flex items-center gap-2\">\n                <Label className=\"text-sm text-muted-foreground whitespace-nowrap\">من:</Label>\n                <Input\n                  type=\"date\"\n                  value={dateFrom}\n                  onChange={(e) => setDateFrom(e.target.value)}\n                  className=\"w-[140px]\"\n                  data-testid=\"input-date-from\"\n                />\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Label className=\"text-sm text-muted-foreground whitespace-nowrap\">إلى:</Label>\n                <Input\n                  type=\"date\"\n                  value={dateTo}\n                  onChange={(e) => setDateTo(e.target.value)}\n                  className=\"w-[140px]\"\n                  data-testid=\"input-date-to\"\n                />\n              </div>\n              {(dateFrom || dateTo || shipmentCodeFilter) && (\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => {\n                    setDateFrom(\"\");\n                    setDateTo(\"\");\n                    setShipmentCodeFilter(\"\");\n                  }}\n                >\n                  مسح الفلاتر\n                </Button>\n              )}\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Inventory Table */}\n      <Card>\n        <CardHeader className=\"pb-4\">\n          <CardTitle className=\"text-lg flex items-center gap-2\">\n            <Package className=\"w-5 h-5\" />\n            حركات المخزون\n            {filteredMovements && (\n              <Badge variant=\"secondary\" className=\"mr-2\">\n                {filteredMovements.length}\n              </Badge>\n            )}\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          {loadingMovements ? (\n            <TableSkeleton />\n          ) : filteredMovements && filteredMovements.length > 0 ? (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead className=\"text-right\">التاريخ</TableHead>\n                    <TableHead className=\"text-right\">الشحنة</TableHead>\n                    <TableHead className=\"text-right\">المنتج</TableHead>\n                    <TableHead className=\"text-right\">عدد القطع</TableHead>\n                    <TableHead className=\"text-right\">تكلفة الوحدة (RMB)</TableHead>\n                    <TableHead className=\"text-right\">تكلفة الوحدة (ج.م)</TableHead>\n                    <TableHead className=\"text-right\">إجمالي التكلفة (ج.م)</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredMovements.map((movement) => (\n                    <TableRow\n                      key={movement.id}\n                      data-testid={`row-inventory-${movement.id}`}\n                    >\n                      <TableCell>\n                        <div className=\"flex items-center gap-2\">\n                          <Calendar className=\"w-4 h-4 text-muted-foreground\" />\n                          {formatDate(movement.movementDate)}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <Badge variant=\"outline\">\n                          {movement.shipment?.shipmentCode || \"-\"}\n                        </Badge>\n                      </TableCell>\n                      <TableCell className=\"font-medium\">\n                        {movement.shipmentItem?.productName || \"-\"}\n                      </TableCell>\n                      <TableCell>\n                        {new Intl.NumberFormat(\"ar-EG\").format(\n                          movement.totalPiecesIn || 0\n                        )}\n                      </TableCell>\n                      <TableCell>\n                        {movement.unitCostRmb\n                          ? `¥ ${formatCurrency(movement.unitCostRmb)}`\n                          : \"-\"}\n                      </TableCell>\n                      <TableCell>\n                        {formatCurrency(movement.unitCostEgp)} ج.م\n                      </TableCell>\n                      <TableCell className=\"font-bold\">\n                        {formatCurrency(movement.totalCostEgp)} ج.م\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </div>\n          ) : (\n            <EmptyState />\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\nfunction StatCard({\n  title,\n  value,\n  icon: Icon,\n}: {\n  title: string;\n  value: string;\n  icon: typeof Package;\n}) {\n  return (\n    <Card>\n      <CardContent className=\"p-6\">\n        <div className=\"flex items-start justify-between gap-4\">\n          <div className=\"flex flex-col gap-2\">\n            <p className=\"text-sm text-muted-foreground\">{title}</p>\n            <p className=\"text-2xl font-bold\">{value}</p>\n          </div>\n          <div className=\"w-12 h-12 rounded-md bg-primary/10 flex items-center justify-center\">\n            <Icon className=\"w-6 h-6 text-primary\" />\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n\nfunction EmptyState() {\n  return (\n    <div className=\"flex flex-col items-center justify-center py-16 text-center\">\n      <div className=\"w-20 h-20 rounded-full bg-muted flex items-center justify-center mb-6\">\n        <Package className=\"w-10 h-10 text-muted-foreground\" />\n      </div>\n      <h3 className=\"text-xl font-medium mb-2\">لا توجد حركات مخزون</h3>\n      <p className=\"text-muted-foreground\">\n        ستظهر الأصناف هنا بعد استلام الشحنات\n      </p>\n    </div>\n  );\n}\n\nfunction TableSkeleton() {\n  return (\n    <div className=\"space-y-4\">\n      {[1, 2, 3, 4, 5].map((i) => (\n        <Skeleton key={i} className=\"h-12 w-full\" />\n      ))}\n    </div>\n  );\n}\n","path":null,"size_bytes":11447,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5741,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","path":null,"size_bytes":1904,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":689,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4885,"size_tokens":null},"client/src/pages/shipments.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Link } from \"wouter\";\nimport {\n  Ship,\n  Plus,\n  Search,\n  Filter,\n  Eye,\n  Edit,\n  Trash2,\n  ChevronDown,\n  Calendar,\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport type { Shipment } from \"@shared/schema\";\n\nexport default function Shipments() {\n  const [search, setSearch] = useState(\"\");\n  const [statusFilter, setStatusFilter] = useState<string>(\"all\");\n  const [dateFrom, setDateFrom] = useState(\"\");\n  const [dateTo, setDateTo] = useState(\"\");\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  const [shipmentToDelete, setShipmentToDelete] = useState<Shipment | null>(null);\n  const { toast } = useToast();\n\n  const { data: shipments, isLoading } = useQuery<Shipment[]>({\n    queryKey: [\"/api/shipments\"],\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: number) => {\n      return apiRequest(\"DELETE\", `/api/shipments/${id}`);\n    },\n    onSuccess: () => {\n      toast({ title: \"تم حذف الشحنة بنجاح\" });\n      queryClient.invalidateQueries({ queryKey: [\"/api/shipments\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/dashboard/stats\"] });\n      setDeleteDialogOpen(false);\n      setShipmentToDelete(null);\n    },\n    onError: () => {\n      toast({ title: \"حدث خطأ أثناء حذف الشحنة\", variant: \"destructive\" });\n    },\n  });\n\n  const handleDeleteClick = (shipment: Shipment) => {\n    setShipmentToDelete(shipment);\n    setDeleteDialogOpen(true);\n  };\n\n  const confirmDelete = () => {\n    if (shipmentToDelete) {\n      deleteMutation.mutate(shipmentToDelete.id);\n    }\n  };\n\n  const formatCurrency = (value: string | number | null) => {\n    const num = typeof value === \"string\" ? parseFloat(value) : value;\n    return new Intl.NumberFormat(\"ar-EG\", {\n      minimumFractionDigits: 2,\n      maximumFractionDigits: 2,\n    }).format(num || 0);\n  };\n\n  const formatDate = (date: string | Date | null) => {\n    if (!date) return \"-\";\n    return new Date(date).toLocaleDateString(\"ar-EG\");\n  };\n\n  const filteredShipments = shipments?.filter((shipment) => {\n    const matchesSearch =\n      !search ||\n      shipment.shipmentName.toLowerCase().includes(search.toLowerCase()) ||\n      shipment.shipmentCode.toLowerCase().includes(search.toLowerCase());\n    const matchesStatus =\n      statusFilter === \"all\" || shipment.status === statusFilter;\n    \n    // Date range filter\n    let matchesDateRange = true;\n    if (dateFrom || dateTo) {\n      const purchaseDate = shipment.purchaseDate ? new Date(shipment.purchaseDate) : null;\n      if (purchaseDate) {\n        if (dateFrom) {\n          const fromDate = new Date(dateFrom);\n          if (purchaseDate < fromDate) matchesDateRange = false;\n        }\n        if (dateTo) {\n          const toDate = new Date(dateTo);\n          toDate.setHours(23, 59, 59, 999);\n          if (purchaseDate > toDate) matchesDateRange = false;\n        }\n      }\n    }\n    \n    return matchesSearch && matchesStatus && matchesDateRange;\n  });\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-wrap items-center justify-between gap-4\">\n        <div>\n          <h1 className=\"text-3xl font-semibold\">الشحنات</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            إدارة جميع الشحنات من لحظة الشراء حتى الاستلام\n          </p>\n        </div>\n        <Button asChild data-testid=\"button-add-shipment\">\n          <Link href=\"/shipments/new\">\n            <Plus className=\"w-4 h-4 ml-2\" />\n            إضافة شحنة جديدة\n          </Link>\n        </Button>\n      </div>\n\n      {/* Filters */}\n      <Card>\n        <CardContent className=\"p-4\">\n          <div className=\"flex flex-wrap items-center gap-4\">\n            <div className=\"relative flex-1 min-w-[200px]\">\n              <Search className=\"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\n              <Input\n                placeholder=\"بحث برقم أو اسم الشحنة...\"\n                value={search}\n                onChange={(e) => setSearch(e.target.value)}\n                className=\"pr-10\"\n                data-testid=\"input-search-shipments\"\n              />\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Filter className=\"w-4 h-4 text-muted-foreground\" />\n              <Select value={statusFilter} onValueChange={setStatusFilter}>\n                <SelectTrigger className=\"w-[180px]\" data-testid=\"select-status-filter\">\n                  <SelectValue placeholder=\"حالة الشحنة\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">جميع الحالات</SelectItem>\n                  <SelectItem value=\"جديدة\">جديدة</SelectItem>\n                  <SelectItem value=\"في انتظار الشحن\">في انتظار الشحن</SelectItem>\n                  <SelectItem value=\"جاهزة للاستلام\">جاهزة للاستلام</SelectItem>\n                  <SelectItem value=\"مستلمة بنجاح\">مستلمة بنجاح</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Calendar className=\"w-4 h-4 text-muted-foreground\" />\n              <div className=\"flex items-center gap-2\">\n                <Label className=\"text-sm text-muted-foreground whitespace-nowrap\">من:</Label>\n                <Input\n                  type=\"date\"\n                  value={dateFrom}\n                  onChange={(e) => setDateFrom(e.target.value)}\n                  className=\"w-[140px]\"\n                  data-testid=\"input-date-from\"\n                />\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Label className=\"text-sm text-muted-foreground whitespace-nowrap\">إلى:</Label>\n                <Input\n                  type=\"date\"\n                  value={dateTo}\n                  onChange={(e) => setDateTo(e.target.value)}\n                  className=\"w-[140px]\"\n                  data-testid=\"input-date-to\"\n                />\n              </div>\n              {(dateFrom || dateTo) && (\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => {\n                    setDateFrom(\"\");\n                    setDateTo(\"\");\n                  }}\n                >\n                  مسح التاريخ\n                </Button>\n              )}\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Shipments Table */}\n      <Card>\n        <CardHeader className=\"pb-4\">\n          <CardTitle className=\"text-lg font-semibold flex items-center gap-2\">\n            <Ship className=\"w-5 h-5\" />\n            قائمة الشحنات\n            {filteredShipments && (\n              <Badge variant=\"secondary\" className=\"mr-2\">\n                {filteredShipments.length}\n              </Badge>\n            )}\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <TableSkeleton />\n          ) : filteredShipments && filteredShipments.length > 0 ? (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead className=\"text-right\">رقم الشحنة</TableHead>\n                    <TableHead className=\"text-right\">اسم الشحنة</TableHead>\n                    <TableHead className=\"text-right\">تاريخ الشراء</TableHead>\n                    <TableHead className=\"text-right\">الحالة</TableHead>\n                    <TableHead className=\"text-right\">التكلفة (ج.م)</TableHead>\n                    <TableHead className=\"text-right\">المدفوع (ج.م)</TableHead>\n                    <TableHead className=\"text-right\">الرصيد</TableHead>\n                    <TableHead className=\"text-right\">إجراءات</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredShipments.map((shipment) => (\n                    <TableRow\n                      key={shipment.id}\n                      className=\"hover-elevate\"\n                      data-testid={`row-shipment-${shipment.id}`}\n                    >\n                      <TableCell className=\"font-medium\">\n                        {shipment.shipmentCode}\n                      </TableCell>\n                      <TableCell>{shipment.shipmentName}</TableCell>\n                      <TableCell>{formatDate(shipment.purchaseDate)}</TableCell>\n                      <TableCell>\n                        <StatusBadge status={shipment.status} />\n                      </TableCell>\n                      <TableCell>\n                        {formatCurrency(shipment.finalTotalCostEgp)}\n                      </TableCell>\n                      <TableCell>\n                        {formatCurrency(shipment.totalPaidEgp)}\n                      </TableCell>\n                      <TableCell>\n                        <BalanceBadge\n                          cost={shipment.finalTotalCostEgp}\n                          paid={shipment.totalPaidEgp}\n                        />\n                      </TableCell>\n                      <TableCell>\n                        <DropdownMenu>\n                          <DropdownMenuTrigger asChild>\n                            <Button variant=\"ghost\" size=\"sm\">\n                              إجراءات\n                              <ChevronDown className=\"w-4 h-4 mr-1\" />\n                            </Button>\n                          </DropdownMenuTrigger>\n                          <DropdownMenuContent align=\"end\">\n                            <DropdownMenuItem asChild>\n                              <Link href={`/shipments/${shipment.id}`}>\n                                <Eye className=\"w-4 h-4 ml-2\" />\n                                عرض\n                              </Link>\n                            </DropdownMenuItem>\n                            <DropdownMenuItem asChild>\n                              <Link href={`/shipments/${shipment.id}/edit`}>\n                                <Edit className=\"w-4 h-4 ml-2\" />\n                                تعديل\n                              </Link>\n                            </DropdownMenuItem>\n                            <DropdownMenuItem\n                              className=\"text-destructive\"\n                              onClick={() => handleDeleteClick(shipment)}\n                            >\n                              <Trash2 className=\"w-4 h-4 ml-2\" />\n                              حذف\n                            </DropdownMenuItem>\n                          </DropdownMenuContent>\n                        </DropdownMenu>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </div>\n          ) : (\n            <EmptyState />\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Delete Confirmation Dialog */}\n      <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>تأكيد حذف الشحنة</AlertDialogTitle>\n            <AlertDialogDescription>\n              هل أنت متأكد من حذف الشحنة \"{shipmentToDelete?.shipmentName}\"؟\n              <br />\n              هذا الإجراء لا يمكن التراجع عنه.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter className=\"gap-2\">\n            <AlertDialogCancel>إلغاء</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={confirmDelete}\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n            >\n              {deleteMutation.isPending ? \"جاري الحذف...\" : \"حذف\"}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n\nfunction StatusBadge({ status }: { status: string }) {\n  const colors: Record<string, string> = {\n    جديدة: \"\",\n    \"في انتظار الشحن\":\n      \"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-400 border-amber-200 dark:border-amber-800\",\n    \"جاهزة للاستلام\":\n      \"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400 border-blue-200 dark:border-blue-800\",\n    \"مستلمة بنجاح\":\n      \"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400 border-green-200 dark:border-green-800\",\n  };\n\n  return (\n    <Badge variant=\"outline\" className={colors[status] || \"\"}>\n      {status}\n    </Badge>\n  );\n}\n\nfunction BalanceBadge({\n  cost,\n  paid,\n}: {\n  cost: string | number | null;\n  paid: string | number | null;\n}) {\n  const costValue = typeof cost === \"string\" ? parseFloat(cost) : cost || 0;\n  const paidValue = typeof paid === \"string\" ? parseFloat(paid) : paid || 0;\n  const remaining = Math.max(0, costValue - paidValue);\n  const overpaid = Math.max(0, paidValue - costValue);\n\n  const formatCurrency = (num: number) =>\n    new Intl.NumberFormat(\"ar-EG\", {\n      minimumFractionDigits: 2,\n      maximumFractionDigits: 2,\n    }).format(num);\n\n  if (remaining === 0 && overpaid === 0) {\n    return (\n      <Badge\n        variant=\"outline\"\n        className=\"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400\"\n      >\n        مسددة\n      </Badge>\n    );\n  }\n\n  if (overpaid > 0) {\n    return (\n      <Badge\n        variant=\"outline\"\n        className=\"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400\"\n      >\n        مبلغ زيادة: {formatCurrency(overpaid)} ج.م\n      </Badge>\n    );\n  }\n\n  return (\n    <Badge\n      variant=\"outline\"\n      className=\"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400\"\n    >\n      متبقي: {formatCurrency(remaining)} ج.م\n    </Badge>\n  );\n}\n\nfunction EmptyState() {\n  return (\n    <div className=\"flex flex-col items-center justify-center py-16 text-center\">\n      <div className=\"w-20 h-20 rounded-full bg-muted flex items-center justify-center mb-6\">\n        <Ship className=\"w-10 h-10 text-muted-foreground\" />\n      </div>\n      <h3 className=\"text-xl font-medium mb-2\">لا توجد شحنات</h3>\n      <p className=\"text-muted-foreground mb-6\">\n        ابدأ بإضافة شحنتك الأولى لتتبع التكاليف والمدفوعات\n      </p>\n      <Button asChild>\n        <Link href=\"/shipments/new\">\n          <Plus className=\"w-4 h-4 ml-2\" />\n          إضافة شحنة جديدة\n        </Link>\n      </Button>\n    </div>\n  );\n}\n\nfunction TableSkeleton() {\n  return (\n    <div className=\"space-y-4\">\n      {[1, 2, 3, 4, 5].map((i) => (\n        <Skeleton key={i} className=\"h-16 w-full\" />\n      ))}\n    </div>\n  );\n}\n","path":null,"size_bytes":16097,"size_tokens":null},"script/build.ts":{"content":"import { build as esbuild } from \"esbuild\";\nimport { build as viteBuild } from \"vite\";\nimport { rm, readFile } from \"fs/promises\";\n\n// server deps to bundle to reduce openat(2) syscalls\n// which helps cold start times\nconst allowlist = [\n  \"@google/generative-ai\",\n  \"axios\",\n  \"connect-pg-simple\",\n  \"cors\",\n  \"date-fns\",\n  \"drizzle-orm\",\n  \"drizzle-zod\",\n  \"express\",\n  \"express-rate-limit\",\n  \"express-session\",\n  \"jsonwebtoken\",\n  \"memorystore\",\n  \"multer\",\n  \"nanoid\",\n  \"nodemailer\",\n  \"openai\",\n  \"passport\",\n  \"passport-local\",\n  \"pg\",\n  \"stripe\",\n  \"uuid\",\n  \"ws\",\n  \"xlsx\",\n  \"zod\",\n  \"zod-validation-error\",\n];\n\nasync function buildAll() {\n  await rm(\"dist\", { recursive: true, force: true });\n\n  console.log(\"building client...\");\n  await viteBuild();\n\n  console.log(\"building server...\");\n  const pkg = JSON.parse(await readFile(\"package.json\", \"utf-8\"));\n  const allDeps = [\n    ...Object.keys(pkg.dependencies || {}),\n    ...Object.keys(pkg.devDependencies || {}),\n  ];\n  const externals = allDeps.filter((dep) => !allowlist.includes(dep));\n\n  await esbuild({\n    entryPoints: [\"server/index.ts\"],\n    platform: \"node\",\n    bundle: true,\n    format: \"cjs\",\n    outfile: \"dist/index.cjs\",\n    define: {\n      \"process.env.NODE_ENV\": '\"production\"',\n    },\n    minify: true,\n    external: externals,\n    logLevel: \"info\",\n  });\n}\n\nbuildAll().catch((err) => {\n  console.error(err);\n  process.exit(1);\n});\n","path":null,"size_bytes":1417,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2765,"size_tokens":null},"client/src/pages/exchange-rates.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport {\n  DollarSign,\n  Plus,\n  Search,\n  TrendingUp,\n  Calendar,\n  RefreshCw,\n  Clock3,\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport type { ExchangeRate, InsertExchangeRate } from \"@shared/schema\";\n\nconst CURRENCIES = [\n  { code: \"RMB\", name: \"رممبي صيني\", symbol: \"¥\" },\n  { code: \"EGP\", name: \"جنيه مصري\", symbol: \"ج.م\" },\n  { code: \"USD\", name: \"دولار أمريكي\", symbol: \"$\" },\n];\n\nexport default function ExchangeRates() {\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [fromCurrency, setFromCurrency] = useState(\"RMB\");\n  const [toCurrency, setToCurrency] = useState(\"EGP\");\n  const { toast } = useToast();\n\n  const { data: rates, isLoading } = useQuery<ExchangeRate[]>({\n    queryKey: [\"/api/exchange-rates\"],\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: InsertExchangeRate) => {\n      return apiRequest(\"POST\", \"/api/exchange-rates\", data);\n    },\n    onSuccess: () => {\n      toast({ title: \"تم إضافة سعر الصرف بنجاح\" });\n      queryClient.invalidateQueries({ queryKey: [\"/api/exchange-rates\"] });\n      setIsDialogOpen(false);\n    },\n    onError: () => {\n      toast({ title: \"حدث خطأ\", variant: \"destructive\" });\n    },\n  });\n\n  const manualRefresh = useMutation({\n    mutationFn: async () => {\n      await apiRequest(\"POST\", \"/api/exchange-rates/refresh\", {});\n    },\n    onSuccess: () => {\n      toast({ title: \"تم تحديث أسعار الصرف يدويًا\" });\n      queryClient.invalidateQueries({ queryKey: [\"/api/exchange-rates\"] });\n    },\n    onError: () => {\n      toast({ title: \"تعذر تحديث الأسعار\", variant: \"destructive\" });\n    },\n  });\n\n  useEffect(() => {\n    const interval = setInterval(() => {\n      manualRefresh.mutate();\n    }, 60 * 60 * 1000); // تحديث كل ساعة\n    return () => clearInterval(interval);\n  }, []);\n\n  const handleSubmit = (e: React.FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n    const formData = new FormData(e.currentTarget);\n    const data: InsertExchangeRate = {\n      rateDate: formData.get(\"rateDate\") as string,\n      fromCurrency: formData.get(\"fromCurrency\") as string,\n      toCurrency: formData.get(\"toCurrency\") as string,\n      rateValue: formData.get(\"rateValue\") as string,\n      source: (formData.get(\"source\") as string) || \"إدخال يدوي\",\n    };\n    createMutation.mutate(data);\n  };\n\n  const formatDate = (date: string | Date) => {\n    return new Date(date).toLocaleDateString(\"ar-EG\");\n  };\n\n  const lastUpdated = rates?.reduce<Date | null>((latest, rate) => {\n    const created = rate.createdAt ? new Date(rate.createdAt) : null;\n    if (!created) return latest;\n    if (!latest || created.getTime() > latest.getTime()) return created;\n    return latest;\n  }, null);\n\n  // Get latest rates for quick view\n  const latestRmbToEgp = rates?.find(\n    (r) => r.fromCurrency === \"RMB\" && r.toCurrency === \"EGP\"\n  );\n  const latestUsdToRmb = rates?.find(\n    (r) => r.fromCurrency === \"USD\" && r.toCurrency === \"RMB\"\n  );\n  const latestUsdToEgp = rates?.find(\n    (r) => r.fromCurrency === \"USD\" && r.toCurrency === \"EGP\"\n  );\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-wrap items-center justify-between gap-4\">\n        <div>\n          <h1 className=\"text-3xl font-semibold\">أسعار الصرف</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            إدارة أسعار تحويل العملات بين الرممبي والجنيه وباقي العملات\n          </p>\n          {lastUpdated && (\n            <div className=\"mt-2 inline-flex items-center gap-2 text-sm text-muted-foreground\">\n              <Clock3 className=\"w-4 h-4\" />\n              <span>\n                آخر تحديث: {new Date(lastUpdated).toLocaleString(\"ar-EG\")}\n              </span>\n            </div>\n          )}\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <Button\n            variant=\"outline\"\n            onClick={() => manualRefresh.mutate()}\n            data-testid=\"button-refresh-rates\"\n          >\n            <RefreshCw className=\"w-4 h-4 ml-2\" />\n            تحديث الأسعار\n          </Button>\n          <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n            <DialogTrigger asChild>\n              <Button data-testid=\"button-add-rate\">\n                <Plus className=\"w-4 h-4 ml-2\" />\n                إضافة سعر جديد\n              </Button>\n            </DialogTrigger>\n          <DialogContent className=\"max-w-md\">\n            <DialogHeader>\n              <DialogTitle>إضافة سعر صرف</DialogTitle>\n            </DialogHeader>\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"rateDate\">التاريخ *</Label>\n                <Input\n                  id=\"rateDate\"\n                  name=\"rateDate\"\n                  type=\"date\"\n                  defaultValue={new Date().toISOString().split(\"T\")[0]}\n                  required\n                  data-testid=\"input-rate-date\"\n                />\n              </div>\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"fromCurrency\">من العملة *</Label>\n                  <Select\n                    name=\"fromCurrency\"\n                    value={fromCurrency}\n                    onValueChange={setFromCurrency}\n                  >\n                    <SelectTrigger data-testid=\"select-from-currency\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {CURRENCIES.map((c) => (\n                        <SelectItem key={c.code} value={c.code}>\n                          {c.symbol} {c.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"toCurrency\">إلى العملة *</Label>\n                  <Select\n                    name=\"toCurrency\"\n                    value={toCurrency}\n                    onValueChange={setToCurrency}\n                  >\n                    <SelectTrigger data-testid=\"select-to-currency\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {CURRENCIES.map((c) => (\n                        <SelectItem key={c.code} value={c.code}>\n                          {c.symbol} {c.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"rateValue\">سعر الصرف *</Label>\n                <Input\n                  id=\"rateValue\"\n                  name=\"rateValue\"\n                  type=\"number\"\n                  step=\"0.000001\"\n                  required\n                  placeholder=\"7.0000\"\n                  data-testid=\"input-rate-value\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"source\">المصدر</Label>\n                <Input\n                  id=\"source\"\n                  name=\"source\"\n                  placeholder=\"إدخال يدوي\"\n                  data-testid=\"input-rate-source\"\n                />\n              </div>\n              <div className=\"flex gap-2 pt-4\">\n                <Button\n                  type=\"submit\"\n                  className=\"flex-1\"\n                  disabled={createMutation.isPending}\n                  data-testid=\"button-save-rate\"\n                >\n                  {createMutation.isPending ? \"جاري الحفظ...\" : \"حفظ\"}\n                </Button>\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setIsDialogOpen(false)}\n                >\n                  إلغاء\n                </Button>\n              </div>\n            </form>\n          </DialogContent>\n        </Dialog>\n        </div>\n      </div>\n\n      {/* Quick View Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <RateCard\n          title=\"RMB → EGP\"\n          fromSymbol=\"¥\"\n          toSymbol=\"ج.م\"\n          rate={latestRmbToEgp}\n        />\n        <RateCard\n          title=\"USD → RMB\"\n          fromSymbol=\"$\"\n          toSymbol=\"¥\"\n          rate={latestUsdToRmb}\n        />\n        <RateCard\n          title=\"USD → EGP\"\n          fromSymbol=\"$\"\n          toSymbol=\"ج.م\"\n          rate={latestUsdToEgp}\n        />\n      </div>\n\n      {/* Rates Table */}\n      <Card>\n        <CardHeader className=\"pb-4 flex flex-row items-center justify-between gap-4\">\n          <CardTitle className=\"text-lg flex items-center gap-2\">\n            <TrendingUp className=\"w-5 h-5\" />\n            سجل أسعار الصرف\n            {rates && (\n              <Badge variant=\"secondary\" className=\"mr-2\">\n                {rates.length}\n              </Badge>\n            )}\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <TableSkeleton />\n          ) : rates && rates.length > 0 ? (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead className=\"text-right\">التاريخ</TableHead>\n                    <TableHead className=\"text-right\">من</TableHead>\n                    <TableHead className=\"text-right\">إلى</TableHead>\n                    <TableHead className=\"text-right\">السعر</TableHead>\n                    <TableHead className=\"text-right\">المصدر</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {rates.map((rate) => (\n                    <TableRow key={rate.id} data-testid={`row-rate-${rate.id}`}>\n                      <TableCell>\n                        <div className=\"flex items-center gap-2\">\n                          <Calendar className=\"w-4 h-4 text-muted-foreground\" />\n                          {formatDate(rate.rateDate)}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <Badge variant=\"outline\">{rate.fromCurrency}</Badge>\n                      </TableCell>\n                      <TableCell>\n                        <Badge variant=\"outline\">{rate.toCurrency}</Badge>\n                      </TableCell>\n                      <TableCell className=\"font-mono font-bold\">\n                        {parseFloat(rate.rateValue).toFixed(4)}\n                      </TableCell>\n                      <TableCell className=\"text-muted-foreground\">\n                        {rate.source || \"إدخال يدوي\"}\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </div>\n          ) : (\n            <EmptyState />\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\nfunction RateCard({\n  title,\n  fromSymbol,\n  toSymbol,\n  rate,\n}: {\n  title: string;\n  fromSymbol: string;\n  toSymbol: string;\n  rate?: ExchangeRate;\n}) {\n  const getTimeAgo = (dateStr: string | Date) => {\n    const date = new Date(dateStr);\n    const now = new Date();\n    const diffInDays = Math.floor((now.getTime() - date.getTime()) / (1000 * 60 * 60 * 24));\n    \n    if (diffInDays === 0) return \"اليوم\";\n    if (diffInDays === 1) return \"أمس\";\n    if (diffInDays < 7) return `منذ ${diffInDays} أيام`;\n    if (diffInDays < 30) return `منذ ${Math.floor(diffInDays / 7)} أسابيع`;\n    return new Date(dateStr).toLocaleDateString(\"ar-EG\");\n  };\n\n  return (\n    <Card>\n      <CardContent className=\"p-6\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <span className=\"text-sm text-muted-foreground\">{title}</span>\n          <div className=\"w-10 h-10 rounded-md bg-primary/10 flex items-center justify-center\">\n            <DollarSign className=\"w-5 h-5 text-primary\" />\n          </div>\n        </div>\n        {rate ? (\n          <>\n            <div className=\"flex items-baseline gap-2\">\n              <span className=\"text-3xl font-bold\">\n                {parseFloat(rate.rateValue).toFixed(2)}\n              </span>\n              <span className=\"text-muted-foreground\">{toSymbol}</span>\n            </div>\n            <p className=\"text-sm text-muted-foreground mt-2\">\n              1 {fromSymbol} = {parseFloat(rate.rateValue).toFixed(4)} {toSymbol}\n            </p>\n            <div className=\"flex items-center gap-1 mt-2\">\n              <Calendar className=\"w-3 h-3 text-muted-foreground\" />\n              <p className=\"text-xs text-muted-foreground\">\n                آخر تحديث: {getTimeAgo(rate.rateDate)}\n              </p>\n            </div>\n            {rate.createdAt && (\n              <p className=\"text-xs text-muted-foreground opacity-60\">\n                تم الإدخال: {new Date(rate.createdAt).toLocaleString(\"ar-EG\")}\n              </p>\n            )}\n          </>\n        ) : (\n          <p className=\"text-muted-foreground\">لا يوجد سعر مسجل</p>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n\nfunction EmptyState() {\n  return (\n    <div className=\"flex flex-col items-center justify-center py-16 text-center\">\n      <div className=\"w-20 h-20 rounded-full bg-muted flex items-center justify-center mb-6\">\n        <TrendingUp className=\"w-10 h-10 text-muted-foreground\" />\n      </div>\n      <h3 className=\"text-xl font-medium mb-2\">لا توجد أسعار صرف</h3>\n      <p className=\"text-muted-foreground mb-6\">\n        ابدأ بإضافة أسعار الصرف المستخدمة في الشحنات\n      </p>\n    </div>\n  );\n}\n\nfunction TableSkeleton() {\n  return (\n    <div className=\"space-y-4\">\n      {[1, 2, 3, 4, 5].map((i) => (\n        <Skeleton key={i} className=\"h-12 w-full\" />\n      ))}\n    </div>\n  );\n}\n","path":null,"size_bytes":15113,"size_tokens":null},"replit.md":{"content":"# Repit.AI - نظام إدارة الشحنات والتكاليف والمدفوعات\n\n## Overview\nA comprehensive multi-user Arabic RTL web application for shipment costing, inventory, and payments settlement. The system manages shipments through a 4-step workflow (Import → Shipping → Customs & Takhreej → Summary) with dual-currency support (RMB/EGP), multiple payment methods including overpayment tracking, supplier management, exchange rate management, and role-based access control.\n\n## Architecture\n\n### Stack\n- **Frontend**: React + TypeScript + Vite + Wouter (routing)\n- **Backend**: Express.js + Node.js\n- **Database**: PostgreSQL (Neon-backed, via Drizzle ORM)\n- **Authentication**: Replit Auth (OpenID Connect)\n- **UI Components**: shadcn/ui + Tailwind CSS\n- **State Management**: TanStack Query\n\n### Key Files Structure\n```\nclient/src/\n├── App.tsx              # Main app with routing and sidebar layout\n├── components/\n│   ├── app-sidebar.tsx  # Navigation sidebar (RTL)\n│   ├── theme-toggle.tsx # Light/dark mode toggle\n│   └── ui/             # shadcn/ui components\n├── hooks/\n│   ├── useAuth.ts      # Authentication hook\n│   ├── useTheme.ts     # Theme management hook\n│   └── use-toast.ts    # Toast notifications\n├── pages/\n│   ├── landing.tsx     # Public landing page\n│   ├── dashboard.tsx   # Main dashboard with stats\n│   ├── shipments.tsx   # Shipments list\n│   ├── shipment-wizard.tsx # 4-step shipment creation/edit\n│   ├── suppliers.tsx   # Supplier management\n│   ├── exchange-rates.tsx # Currency exchange rates\n│   ├── payments.tsx    # Payment tracking\n│   ├── inventory.tsx   # Inventory movements\n│   └── users.tsx       # User management (admin)\n└── lib/\n    ├── queryClient.ts  # React Query configuration\n    └── authUtils.ts    # Auth utility functions\n\nserver/\n├── index.ts            # Express server entry\n├── routes.ts           # API route handlers\n├── storage.ts          # Database operations (IStorage interface)\n├── auth.ts             # Replit Auth setup\n└── db.ts               # Drizzle database connection\n\nshared/\n└── schema.ts           # Database schema and types (Drizzle + Zod)\n```\n\n## Database Schema\n\n### Core Tables\n- **users**: User accounts with roles (مدير, محاسب, مسؤول مخزون, مشاهد)\n- **sessions**: Session storage for Replit Auth\n- **suppliers**: Supplier information\n- **products**: Product catalog\n- **shipments**: Main shipment records with cost breakdown\n- **shipment_items**: Individual items within a shipment\n- **shipment_shipping_details**: Shipping costs and exchange rates\n- **shipment_customs_details**: Customs and clearance costs\n- **exchange_rates**: Currency conversion rates history\n- **shipment_payments**: Payment records\n- **inventory_movements**: Inventory tracking\n- **audit_logs**: Change history\n\n## User Roles & Permissions\n1. **مدير (Admin)**: Full access to all features\n2. **محاسب (Accountant)**: Shipments, costs, and payments\n3. **مسؤول مخزون (Inventory Manager)**: View shipments and inventory\n4. **مشاهد (Viewer)**: Read-only access\n\n## Currency System\n- **RMB (¥)**: Purchase currency (China)\n- **EGP (ج.م)**: Final accounting currency (Egypt)\n- **USD ($)**: Reference for shipping costs\n\n## Shipment Workflow\n1. **الاستيراد (Import)**: Enter shipment details and items\n2. **بيانات الشحن (Shipping)**: Commission and shipping costs\n3. **الجمارك والتخريج (Customs)**: Customs and clearance fees\n4. **ملخص الشحنة (Summary)**: Final review and totals\n\n## Development\n\n### Running the Project\n```bash\nnpm run dev        # Start development server\nnpm run db:push    # Push database schema changes\n```\n\n### Key Design Decisions\n- All UI is in Arabic with RTL layout\n- Cairo and Tajawal fonts for Arabic text\n- Dual-currency display throughout the application\n- Real-time cost calculations in the shipment wizard\n- Overpayment tracking with negative balance display\n\n## Recent Changes\n- **December 2025**: Fixed shipment display issue - costs now calculate at every step, not just step 4\n  - POST /api/shipments now uses latest RMB→EGP exchange rate for preliminary purchase cost calculation\n  - PATCH /api/shipments/:id now always recalculates finalTotalCostEgp on any update\n  - Shipments created without completing all wizard steps now show accurate interim totals\n- Initial implementation of complete shipment management system\n- RTL Arabic UI with proper fonts and layout\n- 4-step shipment wizard with cost calculations\n- Payment tracking with multiple methods\n- Supplier and exchange rate management\n- Inventory movement tracking\n- Role-based access control\n\n## Test Data\nDemo data has been created in the database:\n- **Suppliers**: 3 test suppliers (suppliers with IDs 1-3)\n- **Exchange Rates**: 6 rates (RMB→EGP and USD→RMB for Dec 8-10, 2025)\n- **Shipments**: 3 test shipments with different payment scenarios:\n  - SHP-001: Partially paid (21,762.50 EGP balance)\n  - SHP-002: Fully paid (0.00 EGP balance)\n  - SHP-003: Overpaid (-3,942.50 EGP balance)\n- **Payments**: 5 test payments across the shipments\n\n## Root User Access\n- Username: `root`\n- Password: `123123123`\n- Role: مدير (Admin)\n","path":null,"size_bytes":5403,"size_tokens":null},"server/__tests__/audit.test.ts":{"content":"import assert from \"node:assert/strict\";\nimport test from \"node:test\";\nimport { logAuditEvent, type AuditEvent } from \"../audit\";\n\ntype CapturedAudit = AuditEvent & { id?: number };\n\nclass MockStorage {\n  public logs: CapturedAudit[] = [];\n\n  async createAuditLog(data: AuditEvent) {\n    const entry = { ...data, id: this.logs.length + 1 };\n    this.logs.push(entry);\n    return entry as any;\n  }\n}\n\ntest(\"logAuditEvent records audit entries\", async () => {\n  const storage = new MockStorage();\n  const event: AuditEvent = {\n    userId: \"user-1\",\n    entityType: \"SHIPMENT\",\n    entityId: \"123\",\n    actionType: \"CREATE\",\n    details: { status: \"جديدة\" },\n  };\n\n  await logAuditEvent(event, storage as any);\n\n  assert.equal(storage.logs.length, 1);\n  assert.deepEqual(storage.logs[0], {\n    ...event,\n    id: 1,\n  });\n});\n\ntest(\"logAuditEvent swallows storage errors\", async () => {\n  const storage = {\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    async createAuditLog(_data: AuditEvent) {\n      throw new Error(\"DB unavailable\");\n    },\n  };\n\n  await assert.doesNotReject(async () => {\n    await logAuditEvent(\n      {\n        entityType: \"SHIPMENT\",\n        entityId: \"999\",\n        actionType: \"DELETE\",\n      },\n      storage as any,\n    );\n  });\n});\n","path":null,"size_bytes":1285,"size_tokens":null},"client/src/components/theme-toggle.tsx":{"content":"import { Moon, Sun } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useTheme } from \"@/hooks/useTheme\";\n\nexport function ThemeToggle() {\n  const { theme, setTheme } = useTheme();\n\n  return (\n    <Button\n      variant=\"ghost\"\n      size=\"icon\"\n      onClick={() => setTheme(theme === \"light\" ? \"dark\" : \"light\")}\n      data-testid=\"button-theme-toggle\"\n    >\n      <Sun className=\"h-5 w-5 rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0\" />\n      <Moon className=\"absolute h-5 w-5 rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100\" />\n      <span className=\"sr-only\">تبديل الوضع</span>\n    </Button>\n  );\n}\n","path":null,"size_bytes":675,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4420,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"client/src/pages/users.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport {\n  Shield,\n  Users,\n  Edit,\n  Trash2,\n  Plus,\n  Key,\n  Calendar,\n  Loader2,\n  UserPlus,\n} from \"lucide-react\";\nimport { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Label } from \"@/components/ui/label\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useAuth } from \"@/hooks/useAuth\";\n\ninterface UserType {\n  id: string;\n  username: string;\n  firstName: string | null;\n  lastName: string | null;\n  role: string;\n  createdAt: Date | string | null;\n  updatedAt: Date | string | null;\n}\n\nconst ROLES = [\n  { value: \"مدير\", label: \"مدير\", description: \"صلاحيات كاملة\" },\n  { value: \"محاسب\", label: \"محاسب\", description: \"الشحنات والتكاليف والمدفوعات\" },\n  { value: \"مسؤول مخزون\", label: \"مسؤول مخزون\", description: \"عرض الشحنات والمخزون\" },\n  { value: \"مشاهد\", label: \"مشاهد\", description: \"عرض فقط\" },\n];\n\nexport default function UsersPage() {\n  const { user: currentUser } = useAuth();\n  const [isEditDialogOpen, setIsEditDialogOpen] = useState(false);\n  const [isCreateDialogOpen, setIsCreateDialogOpen] = useState(false);\n  const [isPasswordDialogOpen, setIsPasswordDialogOpen] = useState(false);\n  const [isDeleteDialogOpen, setIsDeleteDialogOpen] = useState(false);\n  const [editingUser, setEditingUser] = useState<UserType | null>(null);\n  const [selectedRole, setSelectedRole] = useState(\"\");\n  const [newPassword, setNewPassword] = useState(\"\");\n  const [newUser, setNewUser] = useState({\n    username: \"\",\n    password: \"\",\n    firstName: \"\",\n    lastName: \"\",\n    role: \"مشاهد\",\n  });\n  const { toast } = useToast();\n\n  const { data: users, isLoading } = useQuery<UserType[]>({\n    queryKey: [\"/api/users\"],\n  });\n\n  const updateRoleMutation = useMutation({\n    mutationFn: async ({ userId, role }: { userId: string; role: string }) => {\n      return apiRequest(\"PATCH\", `/api/users/${userId}/role`, { role });\n    },\n    onSuccess: () => {\n      toast({ title: \"تم تحديث الصلاحية بنجاح\" });\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\"] });\n      setIsEditDialogOpen(false);\n      setEditingUser(null);\n    },\n    onError: () => {\n      toast({ title: \"حدث خطأ\", variant: \"destructive\" });\n    },\n  });\n\n  const createUserMutation = useMutation({\n    mutationFn: async (data: typeof newUser) => {\n      const res = await apiRequest(\"POST\", \"/api/users\", data);\n      return res.json();\n    },\n    onSuccess: () => {\n      toast({ title: \"تم إضافة المستخدم بنجاح\" });\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\"] });\n      setIsCreateDialogOpen(false);\n      setNewUser({ username: \"\", password: \"\", firstName: \"\", lastName: \"\", role: \"مشاهد\" });\n    },\n    onError: (error: any) => {\n      toast({ title: error.message || \"حدث خطأ\", variant: \"destructive\" });\n    },\n  });\n\n  const changePasswordMutation = useMutation({\n    mutationFn: async ({ userId, password }: { userId: string; password: string }) => {\n      return apiRequest(\"PATCH\", `/api/users/${userId}`, { password });\n    },\n    onSuccess: () => {\n      toast({ title: \"تم تغيير كلمة المرور بنجاح\" });\n      setIsPasswordDialogOpen(false);\n      setEditingUser(null);\n      setNewPassword(\"\");\n    },\n    onError: () => {\n      toast({ title: \"حدث خطأ\", variant: \"destructive\" });\n    },\n  });\n\n  const deleteUserMutation = useMutation({\n    mutationFn: async (userId: string) => {\n      return apiRequest(\"DELETE\", `/api/users/${userId}`);\n    },\n    onSuccess: () => {\n      toast({ title: \"تم حذف المستخدم بنجاح\" });\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\"] });\n      setIsDeleteDialogOpen(false);\n      setEditingUser(null);\n    },\n    onError: (error: any) => {\n      toast({ title: error.message || \"حدث خطأ\", variant: \"destructive\" });\n    },\n  });\n\n  const openEditDialog = (user: UserType) => {\n    setEditingUser(user);\n    setSelectedRole(user.role || \"مشاهد\");\n    setIsEditDialogOpen(true);\n  };\n\n  const openPasswordDialog = (user: UserType) => {\n    setEditingUser(user);\n    setNewPassword(\"\");\n    setIsPasswordDialogOpen(true);\n  };\n\n  const openDeleteDialog = (user: UserType) => {\n    setEditingUser(user);\n    setIsDeleteDialogOpen(true);\n  };\n\n  const handleSaveRole = () => {\n    if (editingUser) {\n      updateRoleMutation.mutate({ userId: editingUser.id, role: selectedRole });\n    }\n  };\n\n  const handleCreateUser = () => {\n    if (!newUser.username || !newUser.password) {\n      toast({ title: \"يرجى إدخال اسم المستخدم وكلمة المرور\", variant: \"destructive\" });\n      return;\n    }\n    createUserMutation.mutate(newUser);\n  };\n\n  const handleChangePassword = () => {\n    if (!newPassword || newPassword.length < 6) {\n      toast({ title: \"كلمة المرور يجب أن تكون 6 أحرف على الأقل\", variant: \"destructive\" });\n      return;\n    }\n    if (editingUser) {\n      changePasswordMutation.mutate({ userId: editingUser.id, password: newPassword });\n    }\n  };\n\n  const formatDate = (date: Date | string | null) => {\n    if (!date) return \"-\";\n    return new Date(date).toLocaleDateString(\"ar-EG\");\n  };\n\n  const getRoleBadgeColor = (role: string | null) => {\n    switch (role) {\n      case \"مدير\":\n        return \"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400\";\n      case \"محاسب\":\n        return \"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400\";\n      case \"مسؤول مخزون\":\n        return \"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400\";\n      default:\n        return \"\";\n    }\n  };\n\n  const isAdmin = currentUser?.role === \"مدير\";\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      {/* Header */}\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h1 className=\"text-3xl font-semibold\">المستخدمون والصلاحيات</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            إدارة حسابات المستخدمين والصلاحيات\n          </p>\n        </div>\n        {isAdmin && (\n          <Button onClick={() => setIsCreateDialogOpen(true)}>\n            <UserPlus className=\"w-4 h-4 ml-2\" />\n            إضافة مستخدم\n          </Button>\n        )}\n      </div>\n\n      {/* Roles Overview */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        {ROLES.map((role) => (\n          <Card key={role.value}>\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"w-10 h-10 rounded-md bg-primary/10 flex items-center justify-center\">\n                  <Shield className=\"w-5 h-5 text-primary\" />\n                </div>\n                <div>\n                  <p className=\"font-medium\">{role.label}</p>\n                  <p className=\"text-xs text-muted-foreground\">{role.description}</p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n\n      {/* Users List */}\n      <Card>\n        <CardHeader className=\"pb-4\">\n          <CardTitle className=\"text-lg flex items-center gap-2\">\n            <Users className=\"w-5 h-5\" />\n            قائمة المستخدمين\n            {users && (\n              <Badge variant=\"secondary\" className=\"mr-2\">\n                {users.length}\n              </Badge>\n            )}\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"space-y-4\">\n              {[1, 2, 3].map((i) => (\n                <Skeleton key={i} className=\"h-20 w-full\" />\n              ))}\n            </div>\n          ) : users && users.length > 0 ? (\n            <div className=\"space-y-4\">\n              {users.map((user) => (\n                <div\n                  key={user.id}\n                  className=\"flex items-center justify-between gap-4 p-4 rounded-md border bg-card hover-elevate\"\n                  data-testid={`user-row-${user.id}`}\n                >\n                  <div className=\"flex items-center gap-4\">\n                    <Avatar className=\"w-12 h-12\">\n                      <AvatarFallback className=\"bg-primary/10 text-primary font-medium\">\n                        {user.firstName?.[0] || user.username?.[0]?.toUpperCase() || \"م\"}\n                      </AvatarFallback>\n                    </Avatar>\n                    <div>\n                      <p className=\"font-medium\">\n                        {user.firstName && user.lastName\n                          ? `${user.firstName} ${user.lastName}`\n                          : user.username}\n                      </p>\n                      <div className=\"flex flex-wrap items-center gap-4 text-sm text-muted-foreground mt-1\">\n                        <div className=\"flex items-center gap-1\">\n                          @{user.username}\n                        </div>\n                        <div className=\"flex items-center gap-1\">\n                          <Calendar className=\"w-3 h-3\" />\n                          انضم: {formatDate(user.createdAt)}\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-3\">\n                    <Badge\n                      variant=\"outline\"\n                      className={getRoleBadgeColor(user.role)}\n                    >\n                      {user.role || \"مشاهد\"}\n                    </Badge>\n                    {isAdmin && user.username !== \"root\" && user.id !== currentUser?.id && (\n                      <>\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => openEditDialog(user)}\n                          data-testid={`button-edit-user-${user.id}`}\n                        >\n                          <Edit className=\"w-4 h-4 ml-1\" />\n                          تعديل الدور\n                        </Button>\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => openPasswordDialog(user)}\n                        >\n                          <Key className=\"w-4 h-4 ml-1\" />\n                          كلمة المرور\n                        </Button>\n                        <Button\n                          variant=\"destructive\"\n                          size=\"sm\"\n                          onClick={() => openDeleteDialog(user)}\n                        >\n                          <Trash2 className=\"w-4 h-4\" />\n                        </Button>\n                      </>\n                    )}\n                    {isAdmin && user.username === \"root\" && (\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={() => openPasswordDialog(user)}\n                      >\n                        <Key className=\"w-4 h-4 ml-1\" />\n                        كلمة المرور\n                      </Button>\n                    )}\n                    {user.id === currentUser?.id && (\n                      <Badge variant=\"secondary\">أنت</Badge>\n                    )}\n                  </div>\n                </div>\n              ))}\n            </div>\n          ) : (\n            <EmptyState />\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Create User Dialog */}\n      <Dialog open={isCreateDialogOpen} onOpenChange={setIsCreateDialogOpen}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>إضافة مستخدم جديد</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label>اسم المستخدم</Label>\n              <Input\n                value={newUser.username}\n                onChange={(e) => setNewUser({ ...newUser, username: e.target.value })}\n                placeholder=\"أدخل اسم المستخدم\"\n                dir=\"ltr\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>كلمة المرور</Label>\n              <Input\n                type=\"password\"\n                value={newUser.password}\n                onChange={(e) => setNewUser({ ...newUser, password: e.target.value })}\n                placeholder=\"أدخل كلمة المرور\"\n                dir=\"ltr\"\n              />\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label>الاسم الأول</Label>\n                <Input\n                  value={newUser.firstName}\n                  onChange={(e) => setNewUser({ ...newUser, firstName: e.target.value })}\n                  placeholder=\"اختياري\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label>الاسم الأخير</Label>\n                <Input\n                  value={newUser.lastName}\n                  onChange={(e) => setNewUser({ ...newUser, lastName: e.target.value })}\n                  placeholder=\"اختياري\"\n                />\n              </div>\n            </div>\n            <div className=\"space-y-2\">\n              <Label>الصلاحية</Label>\n              <Select value={newUser.role} onValueChange={(v) => setNewUser({ ...newUser, role: v })}>\n                <SelectTrigger>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  {ROLES.map((role) => (\n                    <SelectItem key={role.value} value={role.value}>\n                      {role.label}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"flex gap-2 pt-4\">\n              <Button\n                onClick={handleCreateUser}\n                className=\"flex-1\"\n                disabled={createUserMutation.isPending}\n              >\n                {createUserMutation.isPending ? (\n                  <>\n                    <Loader2 className=\"w-4 h-4 animate-spin ml-2\" />\n                    جاري الإضافة...\n                  </>\n                ) : (\n                  <>\n                    <Plus className=\"w-4 h-4 ml-2\" />\n                    إضافة\n                  </>\n                )}\n              </Button>\n              <Button variant=\"outline\" onClick={() => setIsCreateDialogOpen(false)}>\n                إلغاء\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Edit Role Dialog */}\n      <Dialog open={isEditDialogOpen} onOpenChange={setIsEditDialogOpen}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>تعديل صلاحية المستخدم</DialogTitle>\n          </DialogHeader>\n          {editingUser && (\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center gap-4 p-4 rounded-md bg-muted/50\">\n                <Avatar>\n                  <AvatarFallback>\n                    {editingUser.firstName?.[0] || editingUser.username?.[0]?.toUpperCase() || \"م\"}\n                  </AvatarFallback>\n                </Avatar>\n                <div>\n                  <p className=\"font-medium\">\n                    {editingUser.firstName && editingUser.lastName\n                      ? `${editingUser.firstName} ${editingUser.lastName}`\n                      : editingUser.username}\n                  </p>\n                  <p className=\"text-sm text-muted-foreground\">@{editingUser.username}</p>\n                </div>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label>الصلاحية</Label>\n                <Select value={selectedRole} onValueChange={setSelectedRole}>\n                  <SelectTrigger data-testid=\"select-role\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {ROLES.map((role) => (\n                      <SelectItem key={role.value} value={role.value}>\n                        <div>\n                          <p>{role.label}</p>\n                          <p className=\"text-xs text-muted-foreground\">{role.description}</p>\n                        </div>\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"flex gap-2 pt-4\">\n                <Button\n                  onClick={handleSaveRole}\n                  className=\"flex-1\"\n                  disabled={updateRoleMutation.isPending}\n                  data-testid=\"button-save-role\"\n                >\n                  {updateRoleMutation.isPending ? \"جاري الحفظ...\" : \"حفظ\"}\n                </Button>\n                <Button variant=\"outline\" onClick={() => setIsEditDialogOpen(false)}>\n                  إلغاء\n                </Button>\n              </div>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n\n      {/* Change Password Dialog */}\n      <Dialog open={isPasswordDialogOpen} onOpenChange={setIsPasswordDialogOpen}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>تغيير كلمة المرور</DialogTitle>\n          </DialogHeader>\n          {editingUser && (\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center gap-4 p-4 rounded-md bg-muted/50\">\n                <Avatar>\n                  <AvatarFallback>\n                    {editingUser.firstName?.[0] || editingUser.username?.[0]?.toUpperCase() || \"م\"}\n                  </AvatarFallback>\n                </Avatar>\n                <div>\n                  <p className=\"font-medium\">\n                    {editingUser.firstName && editingUser.lastName\n                      ? `${editingUser.firstName} ${editingUser.lastName}`\n                      : editingUser.username}\n                  </p>\n                  <p className=\"text-sm text-muted-foreground\">@{editingUser.username}</p>\n                </div>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label>كلمة المرور الجديدة</Label>\n                <Input\n                  type=\"password\"\n                  value={newPassword}\n                  onChange={(e) => setNewPassword(e.target.value)}\n                  placeholder=\"أدخل كلمة المرور الجديدة\"\n                  dir=\"ltr\"\n                />\n              </div>\n\n              <div className=\"flex gap-2 pt-4\">\n                <Button\n                  onClick={handleChangePassword}\n                  className=\"flex-1\"\n                  disabled={changePasswordMutation.isPending}\n                >\n                  {changePasswordMutation.isPending ? \"جاري الحفظ...\" : \"حفظ\"}\n                </Button>\n                <Button variant=\"outline\" onClick={() => setIsPasswordDialogOpen(false)}>\n                  إلغاء\n                </Button>\n              </div>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n\n      {/* Delete User Dialog */}\n      <AlertDialog open={isDeleteDialogOpen} onOpenChange={setIsDeleteDialogOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>حذف المستخدم</AlertDialogTitle>\n            <AlertDialogDescription>\n              هل أنت متأكد من حذف المستخدم \"{editingUser?.username}\"؟ لا يمكن التراجع عن هذا الإجراء.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>إلغاء</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={() => editingUser && deleteUserMutation.mutate(editingUser.id)}\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n            >\n              {deleteUserMutation.isPending ? \"جاري الحذف...\" : \"حذف\"}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n\nfunction EmptyState() {\n  return (\n    <div className=\"flex flex-col items-center justify-center py-16 text-center\">\n      <div className=\"w-20 h-20 rounded-full bg-muted flex items-center justify-center mb-6\">\n        <Users className=\"w-10 h-10 text-muted-foreground\" />\n      </div>\n      <h3 className=\"text-xl font-medium mb-2\">لا يوجد مستخدمون</h3>\n      <p className=\"text-muted-foreground\">\n        سيظهر المستخدمون هنا بعد إضافتهم\n      </p>\n    </div>\n  );\n}\n","path":null,"size_bytes":21841,"size_tokens":null},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { serveStatic } from \"./static\";\nimport { createServer } from \"http\";\n\nconst app = express();\nconst httpServer = createServer(app);\n\ndeclare module \"http\" {\n  interface IncomingMessage {\n    rawBody: unknown;\n  }\n}\n\napp.use(\n  express.json({\n    verify: (req, _res, buf) => {\n      req.rawBody = buf;\n    },\n  }),\n);\n\napp.use(express.urlencoded({ extended: false }));\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  await registerRoutes(httpServer, app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (process.env.NODE_ENV === \"production\") {\n    serveStatic(app);\n  } else {\n    const { setupVite } = await import(\"./vite\");\n    await setupVite(httpServer, app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || \"5000\", 10);\n  httpServer.listen(\n    {\n      port,\n      host: \"0.0.0.0\",\n      reusePort: true,\n    },\n    () => {\n      log(`serving on port ${port}`);\n    },\n  );\n})();\n","path":null,"size_bytes":2560,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1592,"size_tokens":null},"shared/schema.ts":{"content":"import { sql } from 'drizzle-orm';\nimport { relations } from 'drizzle-orm';\nimport {\n  index,\n  jsonb,\n  pgTable,\n  timestamp,\n  varchar,\n  text,\n  integer,\n  decimal,\n  boolean,\n  date,\n} from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Session storage table for Replit Auth\nexport const sessions = pgTable(\n  \"sessions\",\n  {\n    sid: varchar(\"sid\").primaryKey(),\n    sess: jsonb(\"sess\").notNull(),\n    expire: timestamp(\"expire\").notNull(),\n  },\n  (table) => [index(\"IDX_session_expire\").on(table.expire)],\n);\n\n// Users table with username/password auth\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  username: varchar(\"username\", { length: 50 }).unique().notNull(),\n  password: varchar(\"password\", { length: 255 }).notNull(),\n  firstName: varchar(\"first_name\"),\n  lastName: varchar(\"last_name\"),\n  role: varchar(\"role\").default(\"مشاهد\").notNull(), // مدير, محاسب, مسؤول مخزون, مشاهد\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Suppliers table (الموردون)\nexport const suppliers = pgTable(\"suppliers\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  name: varchar(\"name\", { length: 255 }).notNull(),\n  description: text(\"description\"),\n  country: varchar(\"country\", { length: 100 }).default(\"الصين\"),\n  phone: varchar(\"phone\", { length: 50 }),\n  email: varchar(\"email\", { length: 255 }),\n  address: text(\"address\"),\n  isActive: boolean(\"is_active\").default(true).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Products table (الأصناف)\nexport const products = pgTable(\"products\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  name: varchar(\"name\", { length: 255 }).notNull(),\n  type: varchar(\"type\", { length: 100 }), // Category like أحذية, حلويات, ملابس\n  defaultImageUrl: varchar(\"default_image_url\"),\n  defaultSupplierId: integer(\"default_supplier_id\").references(() => suppliers.id),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Shipments table (الشحنات)\nexport const shipments = pgTable(\"shipments\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  shipmentCode: varchar(\"shipment_code\", { length: 50 }).unique().notNull(),\n  shipmentName: varchar(\"shipment_name\", { length: 255 }).notNull(),\n  purchaseDate: date(\"purchase_date\").notNull(),\n  status: varchar(\"status\", { length: 50 }).default(\"جديدة\").notNull(), // جديدة, في انتظار الشحن, جاهزة للاستلام, مستلمة بنجاح\n  invoiceCustomsDate: date(\"invoice_customs_date\"),\n  createdByUserId: varchar(\"created_by_user_id\").references(() => users.id),\n  // Cost breakdown fields\n  purchaseCostRmb: decimal(\"purchase_cost_rmb\", { precision: 15, scale: 2 }).default(\"0\"),\n  purchaseCostEgp: decimal(\"purchase_cost_egp\", { precision: 15, scale: 2 }).default(\"0\"),\n  commissionCostRmb: decimal(\"commission_cost_rmb\", { precision: 15, scale: 2 }).default(\"0\"),\n  commissionCostEgp: decimal(\"commission_cost_egp\", { precision: 15, scale: 2 }).default(\"0\"),\n  shippingCostRmb: decimal(\"shipping_cost_rmb\", { precision: 15, scale: 2 }).default(\"0\"),\n  shippingCostEgp: decimal(\"shipping_cost_egp\", { precision: 15, scale: 2 }).default(\"0\"),\n  customsCostEgp: decimal(\"customs_cost_egp\", { precision: 15, scale: 2 }).default(\"0\"),\n  takhreegCostEgp: decimal(\"takhreeg_cost_egp\", { precision: 15, scale: 2 }).default(\"0\"),\n  finalTotalCostEgp: decimal(\"final_total_cost_egp\", { precision: 15, scale: 2 }).default(\"0\"),\n  totalPaidEgp: decimal(\"total_paid_egp\", { precision: 15, scale: 2 }).default(\"0\"),\n  balanceEgp: decimal(\"balance_egp\", { precision: 15, scale: 2 }).default(\"0\"),\n  lastPaymentDate: timestamp(\"last_payment_date\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Shipment Items table (بنود الشحنة)\nexport const shipmentItems = pgTable(\"shipment_items\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  shipmentId: integer(\"shipment_id\").references(() => shipments.id).notNull(),\n  supplierId: integer(\"supplier_id\").references(() => suppliers.id),\n  productId: integer(\"product_id\").references(() => products.id),\n  productType: varchar(\"product_type\", { length: 100 }),\n  productName: varchar(\"product_name\", { length: 255 }).notNull(),\n  description: text(\"description\"),\n  countryOfOrigin: varchar(\"country_of_origin\", { length: 100 }).default(\"الصين\"),\n  imageUrl: varchar(\"image_url\"),\n  cartonsCtn: integer(\"cartons_ctn\").default(0).notNull(),\n  piecesPerCartonPcs: integer(\"pieces_per_carton_pcs\").default(0).notNull(),\n  totalPiecesCou: integer(\"total_pieces_cou\").default(0).notNull(),\n  purchasePricePerPiecePriRmb: decimal(\"purchase_price_per_piece_pri_rmb\", { precision: 10, scale: 4 }).default(\"0\"),\n  totalPurchaseCostRmb: decimal(\"total_purchase_cost_rmb\", { precision: 15, scale: 2 }).default(\"0\"),\n  customsCostPerCartonEgp: decimal(\"customs_cost_per_carton_egp\", { precision: 10, scale: 2 }),\n  totalCustomsCostEgp: decimal(\"total_customs_cost_egp\", { precision: 15, scale: 2 }),\n  takhreegCostPerCartonEgp: decimal(\"takhreeg_cost_per_carton_egp\", { precision: 10, scale: 2 }),\n  totalTakhreegCostEgp: decimal(\"total_takhreeg_cost_egp\", { precision: 15, scale: 2 }),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Shipping Details table (بيانات الشحن)\nexport const shipmentShippingDetails = pgTable(\"shipment_shipping_details\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  shipmentId: integer(\"shipment_id\").references(() => shipments.id).unique().notNull(),\n  totalPurchaseCostRmb: decimal(\"total_purchase_cost_rmb\", { precision: 15, scale: 2 }).default(\"0\"),\n  commissionRatePercent: decimal(\"commission_rate_percent\", { precision: 5, scale: 2 }).default(\"0\"),\n  commissionValueRmb: decimal(\"commission_value_rmb\", { precision: 15, scale: 2 }).default(\"0\"),\n  commissionValueEgp: decimal(\"commission_value_egp\", { precision: 15, scale: 2 }).default(\"0\"),\n  shippingAreaSqm: decimal(\"shipping_area_sqm\", { precision: 10, scale: 2 }).default(\"0\"),\n  shippingCostPerSqmUsdOriginal: decimal(\"shipping_cost_per_sqm_usd_original\", { precision: 10, scale: 2 }),\n  totalShippingCostUsdOriginal: decimal(\"total_shipping_cost_usd_original\", { precision: 15, scale: 2 }),\n  totalShippingCostRmb: decimal(\"total_shipping_cost_rmb\", { precision: 15, scale: 2 }).default(\"0\"),\n  totalShippingCostEgp: decimal(\"total_shipping_cost_egp\", { precision: 15, scale: 2 }).default(\"0\"),\n  shippingDate: date(\"shipping_date\"),\n  rmbToEgpRateAtShipping: decimal(\"rmb_to_egp_rate_at_shipping\", { precision: 10, scale: 4 }),\n  usdToRmbRateAtShipping: decimal(\"usd_to_rmb_rate_at_shipping\", { precision: 10, scale: 4 }),\n  sourceOfRates: varchar(\"source_of_rates\", { length: 100 }),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Customs Details table (الجمارك والتخريج)\nexport const shipmentCustomsDetails = pgTable(\"shipment_customs_details\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  shipmentId: integer(\"shipment_id\").references(() => shipments.id).unique().notNull(),\n  totalCustomsCostEgp: decimal(\"total_customs_cost_egp\", { precision: 15, scale: 2 }).default(\"0\"),\n  totalTakhreegCostEgp: decimal(\"total_takhreeg_cost_egp\", { precision: 15, scale: 2 }).default(\"0\"),\n  customsInvoiceDate: date(\"customs_invoice_date\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Exchange Rates table (أسعار الصرف)\nexport const exchangeRates = pgTable(\"exchange_rates\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  rateDate: date(\"rate_date\").notNull(),\n  fromCurrency: varchar(\"from_currency\", { length: 10 }).notNull(),\n  toCurrency: varchar(\"to_currency\", { length: 10 }).notNull(),\n  rateValue: decimal(\"rate_value\", { precision: 15, scale: 6 }).notNull(),\n  source: varchar(\"source\", { length: 100 }),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Shipment Payments table (سداد الشحنات)\nexport const shipmentPayments = pgTable(\"shipment_payments\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  shipmentId: integer(\"shipment_id\").references(() => shipments.id).notNull(),\n  paymentDate: timestamp(\"payment_date\").notNull(),\n  paymentCurrency: varchar(\"payment_currency\", { length: 10 }).notNull(), // RMB or EGP\n  amountOriginal: decimal(\"amount_original\", { precision: 15, scale: 2 }).notNull(),\n  exchangeRateToEgp: decimal(\"exchange_rate_to_egp\", { precision: 10, scale: 4 }),\n  amountEgp: decimal(\"amount_egp\", { precision: 15, scale: 2 }).notNull(),\n  paymentMethod: varchar(\"payment_method\", { length: 50 }).notNull(), // نقدي, فودافون كاش, إنستاباي, تحويل بنكي, أخرى\n  cashReceiverName: varchar(\"cash_receiver_name\", { length: 255 }),\n  referenceNumber: varchar(\"reference_number\", { length: 100 }),\n  note: text(\"note\"),\n  attachmentUrl: varchar(\"attachment_url\"),\n  createdByUserId: varchar(\"created_by_user_id\").references(() => users.id),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Inventory Movements table (حركات المخزون)\nexport const inventoryMovements = pgTable(\"inventory_movements\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  shipmentId: integer(\"shipment_id\").references(() => shipments.id),\n  shipmentItemId: integer(\"shipment_item_id\").references(() => shipmentItems.id),\n  productId: integer(\"product_id\").references(() => products.id),\n  totalPiecesIn: integer(\"total_pieces_in\").default(0),\n  unitCostRmb: decimal(\"unit_cost_rmb\", { precision: 10, scale: 4 }),\n  unitCostEgp: decimal(\"unit_cost_egp\", { precision: 10, scale: 4 }).notNull(),\n  totalCostEgp: decimal(\"total_cost_egp\", { precision: 15, scale: 2 }).notNull(),\n  movementDate: date(\"movement_date\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Audit Logs table (سجل التغييرات)\nexport const auditLogs = pgTable(\"audit_logs\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  userId: varchar(\"user_id\").references(() => users.id),\n  entityType: varchar(\"entity_type\", { length: 50 }).notNull(),\n  entityId: varchar(\"entity_id\", { length: 255 }).notNull(),\n  actionType: varchar(\"action_type\", { length: 50 }).notNull(), // CREATE, UPDATE, DELETE, STATUS_CHANGE\n  timestamp: timestamp(\"timestamp\").defaultNow().notNull(),\n  details: jsonb(\"details\"),\n});\n\n// Relations\nexport const usersRelations = relations(users, ({ many }) => ({\n  shipments: many(shipments),\n  payments: many(shipmentPayments),\n  auditLogs: many(auditLogs),\n}));\n\nexport const suppliersRelations = relations(suppliers, ({ many }) => ({\n  products: many(products),\n  shipmentItems: many(shipmentItems),\n}));\n\nexport const productsRelations = relations(products, ({ one, many }) => ({\n  defaultSupplier: one(suppliers, {\n    fields: [products.defaultSupplierId],\n    references: [suppliers.id],\n  }),\n  shipmentItems: many(shipmentItems),\n  inventoryMovements: many(inventoryMovements),\n}));\n\nexport const shipmentsRelations = relations(shipments, ({ one, many }) => ({\n  createdBy: one(users, {\n    fields: [shipments.createdByUserId],\n    references: [users.id],\n  }),\n  items: many(shipmentItems),\n  shippingDetails: one(shipmentShippingDetails),\n  customsDetails: one(shipmentCustomsDetails),\n  payments: many(shipmentPayments),\n  inventoryMovements: many(inventoryMovements),\n}));\n\nexport const shipmentItemsRelations = relations(shipmentItems, ({ one }) => ({\n  shipment: one(shipments, {\n    fields: [shipmentItems.shipmentId],\n    references: [shipments.id],\n  }),\n  supplier: one(suppliers, {\n    fields: [shipmentItems.supplierId],\n    references: [suppliers.id],\n  }),\n  product: one(products, {\n    fields: [shipmentItems.productId],\n    references: [products.id],\n  }),\n}));\n\nexport const shipmentShippingDetailsRelations = relations(shipmentShippingDetails, ({ one }) => ({\n  shipment: one(shipments, {\n    fields: [shipmentShippingDetails.shipmentId],\n    references: [shipments.id],\n  }),\n}));\n\nexport const shipmentCustomsDetailsRelations = relations(shipmentCustomsDetails, ({ one }) => ({\n  shipment: one(shipments, {\n    fields: [shipmentCustomsDetails.shipmentId],\n    references: [shipments.id],\n  }),\n}));\n\nexport const shipmentPaymentsRelations = relations(shipmentPayments, ({ one }) => ({\n  shipment: one(shipments, {\n    fields: [shipmentPayments.shipmentId],\n    references: [shipments.id],\n  }),\n  createdBy: one(users, {\n    fields: [shipmentPayments.createdByUserId],\n    references: [users.id],\n  }),\n}));\n\nexport const inventoryMovementsRelations = relations(inventoryMovements, ({ one }) => ({\n  shipment: one(shipments, {\n    fields: [inventoryMovements.shipmentId],\n    references: [shipments.id],\n  }),\n  shipmentItem: one(shipmentItems, {\n    fields: [inventoryMovements.shipmentItemId],\n    references: [shipmentItems.id],\n  }),\n  product: one(products, {\n    fields: [inventoryMovements.productId],\n    references: [products.id],\n  }),\n}));\n\nexport const auditLogsRelations = relations(auditLogs, ({ one }) => ({\n  user: one(users, {\n    fields: [auditLogs.userId],\n    references: [users.id],\n  }),\n}));\n\n// Insert Schemas\nexport const insertUserSchema = createInsertSchema(users).omit({ createdAt: true, updatedAt: true });\nexport const insertSupplierSchema = createInsertSchema(suppliers).omit({ createdAt: true, updatedAt: true });\nexport const insertProductSchema = createInsertSchema(products).omit({ createdAt: true, updatedAt: true });\nexport const insertShipmentSchema = createInsertSchema(shipments).omit({ createdAt: true, updatedAt: true });\nexport const insertShipmentItemSchema = createInsertSchema(shipmentItems).omit({ createdAt: true, updatedAt: true });\nexport const insertShipmentShippingDetailsSchema = createInsertSchema(shipmentShippingDetails).omit({ createdAt: true, updatedAt: true });\nexport const insertShipmentCustomsDetailsSchema = createInsertSchema(shipmentCustomsDetails).omit({ createdAt: true, updatedAt: true });\nexport const insertExchangeRateSchema = createInsertSchema(exchangeRates).omit({ createdAt: true });\nexport const insertShipmentPaymentSchema = createInsertSchema(shipmentPayments).omit({ createdAt: true, updatedAt: true });\nexport const insertInventoryMovementSchema = createInsertSchema(inventoryMovements).omit({ createdAt: true });\nexport const insertAuditLogSchema = createInsertSchema(auditLogs);\n\n// Types\nexport type UpsertUser = typeof users.$inferInsert;\nexport type User = typeof users.$inferSelect;\nexport type InsertSupplier = z.infer<typeof insertSupplierSchema>;\nexport type Supplier = typeof suppliers.$inferSelect;\nexport type InsertProduct = z.infer<typeof insertProductSchema>;\nexport type Product = typeof products.$inferSelect;\nexport type InsertShipment = z.infer<typeof insertShipmentSchema>;\nexport type Shipment = typeof shipments.$inferSelect;\nexport type InsertShipmentItem = z.infer<typeof insertShipmentItemSchema>;\nexport type ShipmentItem = typeof shipmentItems.$inferSelect;\nexport type InsertShipmentShippingDetails = z.infer<typeof insertShipmentShippingDetailsSchema>;\nexport type ShipmentShippingDetails = typeof shipmentShippingDetails.$inferSelect;\nexport type InsertShipmentCustomsDetails = z.infer<typeof insertShipmentCustomsDetailsSchema>;\nexport type ShipmentCustomsDetails = typeof shipmentCustomsDetails.$inferSelect;\nexport type InsertExchangeRate = z.infer<typeof insertExchangeRateSchema>;\nexport type ExchangeRate = typeof exchangeRates.$inferSelect;\nexport type InsertShipmentPayment = z.infer<typeof insertShipmentPaymentSchema>;\nexport type ShipmentPayment = typeof shipmentPayments.$inferSelect;\nexport type InsertInventoryMovement = z.infer<typeof insertInventoryMovementSchema>;\nexport type InventoryMovement = typeof inventoryMovements.$inferSelect;\nexport type InsertAuditLog = z.infer<typeof insertAuditLogSchema>;\nexport type AuditLog = typeof auditLogs.$inferSelect;\n","path":null,"size_bytes":16437,"size_tokens":null},"server/payments.ts":{"content":"import type { Shipment, ShipmentPayment } from \"@shared/schema\";\nimport type { IStorage } from \"./storage\";\n\nexport type PaymentWithShipment = ShipmentPayment & { shipment?: Shipment };\n\ntype PaymentsStorage = Pick<IStorage, \"getAllPayments\" | \"getShipmentsByIds\">;\n\nexport async function getPaymentsWithShipments(\n  paymentsStorage: PaymentsStorage,\n): Promise<PaymentWithShipment[]> {\n  const payments = await paymentsStorage.getAllPayments();\n\n  if (payments.length === 0) return [];\n\n  const shipmentIds = Array.from(new Set(payments.map((payment) => payment.shipmentId)));\n  const shipments = await paymentsStorage.getShipmentsByIds(shipmentIds);\n  const shipmentMap = new Map(shipments.map((shipment) => [shipment.id, shipment]));\n\n  return payments.map((payment) => ({\n    ...payment,\n    shipment: shipmentMap.get(payment.shipmentId),\n  }));\n}\n","path":null,"size_bytes":852,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4281,"size_tokens":null},"server/audit.ts":{"content":"import { storage } from \"./storage\";\nimport type { InsertAuditLog } from \"@shared/schema\";\n\nexport type AuditActionType = \"CREATE\" | \"UPDATE\" | \"DELETE\" | \"STATUS_CHANGE\";\nexport type AuditEntityType = \"SHIPMENT\" | \"PAYMENT\" | \"EXCHANGE_RATE\" | \"USER\";\n\ninterface AuditEvent {\n  userId?: string | null;\n  entityType: AuditEntityType;\n  entityId: string | number;\n  actionType: AuditActionType;\n  details?: unknown;\n}\n\nfunction serializeDetails(details: unknown) {\n  if (details === undefined) return null;\n  try {\n    return JSON.parse(JSON.stringify(details));\n  } catch (error) {\n    console.error(\"Failed to serialize audit log details\", error);\n    return { error: \"Unable to serialize details\" };\n  }\n}\n\nexport function logAuditEvent(event: AuditEvent): void {\n  const payload: InsertAuditLog = {\n    userId: event.userId || null,\n    entityType: event.entityType,\n    entityId: String(event.entityId),\n    actionType: event.actionType,\n    details: serializeDetails(event.details),\n  };\n\n  void storage.createAuditLog(payload).catch((error) => {\n    console.error(\"Failed to write audit log\", { error, payload });\n  });\n}\n","path":null,"size_bytes":1128,"size_tokens":null},"client/src/pages/shipment-wizard.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useLocation, useParams } from \"wouter\";\nimport {\n  Ship,\n  Package,\n  Truck,\n  FileCheck,\n  ClipboardCheck,\n  Plus,\n  Trash2,\n  Save,\n  ArrowLeft,\n  ArrowRight,\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport type {\n  Shipment,\n  ShipmentItem,\n  ShipmentShippingDetails,\n  Supplier,\n} from \"@shared/schema\";\n\nconst STEPS = [\n  { id: 1, title: \"الاستيراد\", icon: Package, description: \"بيانات الأصناف\" },\n  { id: 2, title: \"بيانات الشحن\", icon: Truck, description: \"العمولة والشحن\" },\n  { id: 3, title: \"الجمارك والتخريج\", icon: FileCheck, description: \"تكاليف التخليص\" },\n  { id: 4, title: \"ملخص الشحنة\", icon: ClipboardCheck, description: \"مراجعة نهائية\" },\n];\n\nexport default function ShipmentWizard() {\n  const { id } = useParams<{ id: string }>();\n  const [, navigate] = useLocation();\n  const { toast } = useToast();\n  const [currentStep, setCurrentStep] = useState(1);\n  const isNew = !id || id === \"new\";\n\n  // Form state\n  const [shipmentData, setShipmentData] = useState({\n    shipmentCode: \"\",\n    shipmentName: \"\",\n    purchaseDate: new Date().toISOString().split(\"T\")[0],\n    status: \"جديدة\",\n  });\n\n  const [items, setItems] = useState<Partial<ShipmentItem>[]>([\n    createEmptyItem(),\n  ]);\n\n  const [shippingData, setShippingData] = useState({\n    commissionRatePercent: \"0\",\n    shippingAreaSqm: \"0\",\n    shippingCostPerSqmUsdOriginal: \"0\",\n    shippingDate: new Date().toISOString().split(\"T\")[0],\n    rmbToEgpRate: \"7.0\",\n    usdToRmbRate: \"7.2\",\n  });\n\n  // Fetch existing shipment data\n  const { data: existingShipment, isLoading: loadingShipment } = useQuery<Shipment>({\n    queryKey: [\"/api/shipments\", id],\n    enabled: !isNew,\n  });\n\n  const { data: existingItems } = useQuery<ShipmentItem[]>({\n    queryKey: [\"/api/shipments\", id, \"items\"],\n    enabled: !isNew,\n  });\n\n  const { data: existingShipping } = useQuery<ShipmentShippingDetails>({\n    queryKey: [\"/api/shipments\", id, \"shipping\"],\n    enabled: !isNew,\n  });\n\n  const { data: suppliers } = useQuery<Supplier[]>({\n    queryKey: [\"/api/suppliers\"],\n  });\n\n  // Load existing data\n  useEffect(() => {\n    if (existingShipment) {\n      setShipmentData({\n        shipmentCode: existingShipment.shipmentCode,\n        shipmentName: existingShipment.shipmentName,\n        purchaseDate: existingShipment.purchaseDate?.toString() || \"\",\n        status: existingShipment.status,\n      });\n    }\n  }, [existingShipment]);\n\n  useEffect(() => {\n    if (existingItems && existingItems.length > 0) {\n      setItems(existingItems);\n    }\n  }, [existingItems]);\n\n  useEffect(() => {\n    if (existingShipping) {\n      setShippingData({\n        commissionRatePercent: existingShipping.commissionRatePercent?.toString() || \"0\",\n        shippingAreaSqm: existingShipping.shippingAreaSqm?.toString() || \"0\",\n        shippingCostPerSqmUsdOriginal:\n          existingShipping.shippingCostPerSqmUsdOriginal?.toString() || \"0\",\n        shippingDate: existingShipping.shippingDate?.toString() || \"\",\n        rmbToEgpRate: existingShipping.rmbToEgpRateAtShipping?.toString() || \"7.0\",\n        usdToRmbRate: existingShipping.usdToRmbRateAtShipping?.toString() || \"7.2\",\n      });\n    }\n  }, [existingShipping]);\n\n  // Save mutation\n  const validateStep = () => {\n    if (!shipmentData.shipmentCode.trim()) {\n      return \"رقم الشحنة مطلوب\";\n    }\n    if (!shipmentData.shipmentName.trim()) {\n      return \"اسم الشحنة مطلوب\";\n    }\n    if (!shipmentData.purchaseDate) {\n      return \"تاريخ الشراء مطلوب\";\n    }\n    if (!items || items.length === 0) {\n      return \"أضف صنفًا واحدًا على الأقل قبل الحفظ\";\n    }\n\n    for (let index = 0; index < items.length; index++) {\n      const item = items[index];\n      if (!item.productName || !item.productName.trim()) {\n        return `اسم الصنف مطلوب (بند #${index + 1})`;\n      }\n      if (!item.cartonsCtn || item.cartonsCtn <= 0) {\n        return `عدد الكراتين مطلوب (بند #${index + 1})`;\n      }\n      if (!item.piecesPerCartonPcs || item.piecesPerCartonPcs <= 0) {\n        return `عدد القطع في الكرتونة مطلوب (بند #${index + 1})`;\n      }\n      if (!item.purchasePricePerPiecePriRmb || Number(item.purchasePricePerPiecePriRmb) <= 0) {\n        return `سعر القطعة بالرممبي مطلوب (بند #${index + 1})`;\n      }\n    }\n    return null;\n  };\n\n  const saveMutation = useMutation({\n    mutationFn: async (data: { step: number }): Promise<{ id?: number } | undefined> => {\n      const validationError = validateStep();\n      if (validationError) {\n        throw new Error(validationError);\n      }\n\n      if (isNew && data.step === 1) {\n        // Create new shipment\n        const response = await apiRequest(\"POST\", \"/api/shipments\", {\n          ...shipmentData,\n          items,\n        });\n        return response.json();\n      } else {\n        // Update existing\n        await apiRequest(\"PATCH\", `/api/shipments/${id}`, {\n          step: data.step,\n          shipmentData,\n          items,\n          shippingData,\n        });\n        return undefined;\n      }\n    },\n    onSuccess: (result, variables) => {\n      toast({ title: \"تم الحفظ بنجاح\" });\n      // Invalidate all related queries to ensure UI is updated\n      // Note: id from useParams is a string, use it consistently\n      queryClient.invalidateQueries({ queryKey: [\"/api/shipments\"] });\n      const shipmentIdStr = isNew ? result?.id?.toString() : id;\n      if (shipmentIdStr) {\n        // Invalidate with string key (matching how useQuery uses id from useParams)\n        queryClient.invalidateQueries({ queryKey: [\"/api/shipments\", shipmentIdStr] });\n        queryClient.invalidateQueries({ queryKey: [\"/api/shipments\", shipmentIdStr, \"items\"] });\n        queryClient.invalidateQueries({ queryKey: [\"/api/shipments\", shipmentIdStr, \"shipping\"] });\n      }\n      queryClient.invalidateQueries({ queryKey: [\"/api/dashboard/stats\"] });\n      if (isNew && result?.id) {\n        navigate(`/shipments/${result.id}/edit`);\n      } else if (variables.step === 4) {\n        navigate(\"/shipments\");\n      }\n    },\n    onError: (error) => {\n      let message = \"حدث خطأ أثناء حفظ بيانات الشحنة\";\n      if (error instanceof Error && error.message) {\n        const [, serverMessage] = error.message.split(\":\");\n        message = (serverMessage || error.message).trim();\n      }\n      toast({ title: message || \"حدث خطأ\", variant: \"destructive\" });\n    },\n  });\n\n  function createEmptyItem(): Partial<ShipmentItem> {\n    return {\n      productName: \"\",\n      productType: \"\",\n      countryOfOrigin: \"الصين\",\n      cartonsCtn: 0,\n      piecesPerCartonPcs: 0,\n      totalPiecesCou: 0,\n      purchasePricePerPiecePriRmb: \"0\",\n      totalPurchaseCostRmb: \"0\",\n    };\n  }\n\n  const addItem = () => {\n    setItems([...items, createEmptyItem()]);\n  };\n\n  const removeItem = (index: number) => {\n    if (items.length > 1) {\n      setItems(items.filter((_, i) => i !== index));\n    }\n  };\n\n  const updateItem = (index: number, field: string, value: string | number) => {\n    const newItems = [...items];\n    (newItems[index] as Record<string, unknown>)[field] = value;\n\n    // Auto-calculate COU and total\n    const item = newItems[index];\n    const ctn = item.cartonsCtn || 0;\n    const pcs = item.piecesPerCartonPcs || 0;\n    const pri = parseFloat(item.purchasePricePerPiecePriRmb?.toString() || \"0\");\n    const cou = ctn * pcs;\n    item.totalPiecesCou = cou;\n    item.totalPurchaseCostRmb = (cou * pri).toFixed(2);\n\n    setItems(newItems);\n  };\n\n  // Calculate totals\n  const totalPurchaseCostRmb = items.reduce(\n    (sum, item) => sum + parseFloat(item.totalPurchaseCostRmb?.toString() || \"0\"),\n    0\n  );\n\n  const commissionRmb =\n    (totalPurchaseCostRmb * parseFloat(shippingData.commissionRatePercent)) / 100;\n\n  const shippingCostUsd =\n    parseFloat(shippingData.shippingAreaSqm) *\n    parseFloat(shippingData.shippingCostPerSqmUsdOriginal);\n\n  const shippingCostRmb = shippingCostUsd * parseFloat(shippingData.usdToRmbRate);\n\n  const rmbToEgp = parseFloat(shippingData.rmbToEgpRate);\n  const purchaseCostEgp = totalPurchaseCostRmb * rmbToEgp;\n  const commissionEgp = commissionRmb * rmbToEgp;\n  const shippingCostEgp = shippingCostRmb * rmbToEgp;\n\n  // Calculate customs totals\n  const totalCustomsCostEgp = items.reduce((sum, item) => {\n    const ctn = item.cartonsCtn || 0;\n    const customsPerCarton = parseFloat(item.customsCostPerCartonEgp?.toString() || \"0\");\n    return sum + ctn * customsPerCarton;\n  }, 0);\n\n  const totalTakhreegCostEgp = items.reduce((sum, item) => {\n    const ctn = item.cartonsCtn || 0;\n    const takhreegPerCarton = parseFloat(item.takhreegCostPerCartonEgp?.toString() || \"0\");\n    return sum + ctn * takhreegPerCarton;\n  }, 0);\n\n  const finalTotalCostEgp =\n    purchaseCostEgp + commissionEgp + shippingCostEgp + totalCustomsCostEgp + totalTakhreegCostEgp;\n\n  const formatCurrency = (value: number) =>\n    new Intl.NumberFormat(\"ar-EG\", {\n      minimumFractionDigits: 2,\n      maximumFractionDigits: 2,\n    }).format(value);\n\n  if (!isNew && loadingShipment) {\n    return <WizardSkeleton />;\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-wrap items-center justify-between gap-4\">\n        <div>\n          <h1 className=\"text-3xl font-semibold\">\n            {isNew ? \"إضافة شحنة جديدة\" : `تعديل الشحنة: ${shipmentData.shipmentName}`}\n          </h1>\n          <p className=\"text-muted-foreground mt-1\">\n            {STEPS[currentStep - 1].description}\n          </p>\n        </div>\n      </div>\n\n      {/* Progress Stepper */}\n      <div className=\"flex items-center justify-center gap-2 overflow-x-auto pb-2\">\n        {STEPS.map((step, index) => {\n          const Icon = step.icon;\n          const isActive = currentStep === step.id;\n          const isCompleted = currentStep > step.id;\n\n          return (\n            <div key={step.id} className=\"flex items-center\">\n              <button\n                onClick={() => setCurrentStep(step.id)}\n                className={`flex items-center gap-2 px-4 py-2 rounded-md transition-colors ${\n                  isActive\n                    ? \"bg-primary text-primary-foreground\"\n                    : isCompleted\n                    ? \"bg-primary/20 text-primary\"\n                    : \"bg-muted text-muted-foreground\"\n                }`}\n                data-testid={`step-${step.id}`}\n              >\n                <Icon className=\"w-5 h-5\" />\n                <span className=\"font-medium whitespace-nowrap\">{step.title}</span>\n              </button>\n              {index < STEPS.length - 1 && (\n                <ArrowLeft className=\"w-5 h-5 mx-2 text-muted-foreground\" />\n              )}\n            </div>\n          );\n        })}\n      </div>\n\n      {/* Step Content */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        <div className=\"lg:col-span-2 space-y-6\">\n          {currentStep === 1 && (\n            <Step1Import\n              shipmentData={shipmentData}\n              setShipmentData={setShipmentData}\n              items={items}\n              updateItem={updateItem}\n              addItem={addItem}\n              removeItem={removeItem}\n              suppliers={suppliers || []}\n              isNew={isNew}\n            />\n          )}\n\n          {currentStep === 2 && (\n            <Step2Shipping\n              shippingData={shippingData}\n              setShippingData={setShippingData}\n              totalPurchaseCostRmb={totalPurchaseCostRmb}\n              commissionRmb={commissionRmb}\n              commissionEgp={commissionEgp}\n              shippingCostUsd={shippingCostUsd}\n              shippingCostRmb={shippingCostRmb}\n              shippingCostEgp={shippingCostEgp}\n            />\n          )}\n\n          {currentStep === 3 && (\n            <Step3Customs\n              items={items}\n              updateItem={updateItem}\n              totalCustomsCostEgp={totalCustomsCostEgp}\n              totalTakhreegCostEgp={totalTakhreegCostEgp}\n            />\n          )}\n\n          {currentStep === 4 && (\n            <Step4Summary\n              shipmentData={shipmentData}\n              items={items}\n              totalPurchaseCostRmb={totalPurchaseCostRmb}\n              purchaseCostEgp={purchaseCostEgp}\n              commissionRmb={commissionRmb}\n              commissionEgp={commissionEgp}\n              shippingCostRmb={shippingCostRmb}\n              shippingCostEgp={shippingCostEgp}\n              totalCustomsCostEgp={totalCustomsCostEgp}\n              totalTakhreegCostEgp={totalTakhreegCostEgp}\n              finalTotalCostEgp={finalTotalCostEgp}\n            />\n          )}\n        </div>\n\n        {/* Cost Summary Sidebar */}\n        <Card className=\"h-fit lg:sticky lg:top-6\">\n          <CardHeader className=\"pb-4\">\n            <CardTitle className=\"text-lg\">ملخص التكاليف</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <SummaryRow\n              label=\"تكلفة الشراء (RMB)\"\n              value={`¥ ${formatCurrency(totalPurchaseCostRmb)}`}\n            />\n            <SummaryRow\n              label=\"تكلفة الشراء (ج.م)\"\n              value={`${formatCurrency(purchaseCostEgp)} ج.م`}\n            />\n            <hr className=\"border-border\" />\n            <SummaryRow\n              label=\"العمولة (RMB)\"\n              value={`¥ ${formatCurrency(commissionRmb)}`}\n            />\n            <SummaryRow\n              label=\"العمولة (ج.م)\"\n              value={`${formatCurrency(commissionEgp)} ج.م`}\n            />\n            <hr className=\"border-border\" />\n            <SummaryRow\n              label=\"الشحن (RMB)\"\n              value={`¥ ${formatCurrency(shippingCostRmb)}`}\n            />\n            <SummaryRow\n              label=\"الشحن (ج.م)\"\n              value={`${formatCurrency(shippingCostEgp)} ج.م`}\n            />\n            <hr className=\"border-border\" />\n            <SummaryRow\n              label=\"الجمارك (ج.م)\"\n              value={`${formatCurrency(totalCustomsCostEgp)} ج.م`}\n            />\n            <SummaryRow\n              label=\"التخريج (ج.م)\"\n              value={`${formatCurrency(totalTakhreegCostEgp)} ج.م`}\n            />\n            <hr className=\"border-border\" />\n            <div className=\"flex justify-between items-center font-bold text-lg\">\n              <span>الإجمالي النهائي</span>\n              <span className=\"text-primary\">{formatCurrency(finalTotalCostEgp)} ج.م</span>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Navigation Buttons */}\n      <div className=\"flex items-center justify-between gap-4 pt-4 border-t\">\n        <Button\n          variant=\"outline\"\n          onClick={() => setCurrentStep(Math.max(1, currentStep - 1))}\n          disabled={currentStep === 1}\n          data-testid=\"button-prev\"\n        >\n          <ArrowRight className=\"w-4 h-4 ml-2\" />\n          السابق\n        </Button>\n        <div className=\"flex gap-2\">\n          <Button\n            variant=\"outline\"\n            onClick={() => saveMutation.mutate({ step: currentStep })}\n            disabled={saveMutation.isPending}\n            data-testid=\"button-save\"\n          >\n            <Save className=\"w-4 h-4 ml-2\" />\n            {saveMutation.isPending ? \"جاري الحفظ...\" : \"حفظ\"}\n          </Button>\n          {currentStep < 4 ? (\n            <Button\n              onClick={() => setCurrentStep(currentStep + 1)}\n              data-testid=\"button-next\"\n            >\n              التالي\n              <ArrowLeft className=\"w-4 h-4 mr-2\" />\n            </Button>\n          ) : (\n            <Button\n              onClick={() => {\n                saveMutation.mutate({ step: 4 });\n              }}\n              data-testid=\"button-finish\"\n            >\n              إنهاء واستلام\n            </Button>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// Step 1: Import Items\nfunction Step1Import({\n  shipmentData,\n  setShipmentData,\n  items,\n  updateItem,\n  addItem,\n  removeItem,\n  suppliers,\n  isNew,\n}: {\n  shipmentData: { shipmentCode: string; shipmentName: string; purchaseDate: string; status: string };\n  setShipmentData: (data: typeof shipmentData) => void;\n  items: Partial<ShipmentItem>[];\n  updateItem: (index: number, field: string, value: string | number) => void;\n  addItem: () => void;\n  removeItem: (index: number) => void;\n  suppliers: Supplier[];\n  isNew: boolean;\n}) {\n  return (\n    <div className=\"space-y-6\">\n      {/* Shipment Info */}\n      <Card>\n        <CardHeader className=\"pb-4\">\n          <CardTitle className=\"text-lg flex items-center gap-2\">\n            <Ship className=\"w-5 h-5\" />\n            بيانات الشحنة\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"shipmentCode\">رقم الشحنة *</Label>\n              <Input\n                id=\"shipmentCode\"\n                value={shipmentData.shipmentCode}\n                onChange={(e) =>\n                  setShipmentData({ ...shipmentData, shipmentCode: e.target.value })\n                }\n                placeholder=\"SHP-001\"\n                data-testid=\"input-shipment-code\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"shipmentName\">اسم الشحنة *</Label>\n              <Input\n                id=\"shipmentName\"\n                value={shipmentData.shipmentName}\n                onChange={(e) =>\n                  setShipmentData({ ...shipmentData, shipmentName: e.target.value })\n                }\n                placeholder=\"شحنة ملابس شتوية\"\n                data-testid=\"input-shipment-name\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"purchaseDate\">تاريخ الشراء *</Label>\n              <Input\n                id=\"purchaseDate\"\n                type=\"date\"\n                value={shipmentData.purchaseDate}\n                onChange={(e) =>\n                  setShipmentData({ ...shipmentData, purchaseDate: e.target.value })\n                }\n                data-testid=\"input-purchase-date\"\n              />\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Items */}\n      <Card>\n        <CardHeader className=\"pb-4 flex flex-row items-center justify-between gap-4\">\n          <CardTitle className=\"text-lg flex items-center gap-2\">\n            <Package className=\"w-5 h-5\" />\n            بنود الشحنة ({items.length})\n          </CardTitle>\n          <Button size=\"sm\" onClick={addItem} data-testid=\"button-add-item\">\n            <Plus className=\"w-4 h-4 ml-2\" />\n            إضافة بند\n          </Button>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          {items.map((item, index) => (\n            <div\n              key={index}\n              className=\"p-4 border rounded-md space-y-4 bg-card\"\n              data-testid={`item-row-${index}`}\n            >\n              <div className=\"flex items-center justify-between\">\n                <span className=\"font-medium\">البند {index + 1}</span>\n                {items.length > 1 && (\n                  <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    onClick={() => removeItem(index)}\n                    className=\"text-destructive\"\n                  >\n                    <Trash2 className=\"w-4 h-4\" />\n                  </Button>\n                )}\n              </div>\n              <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label>المورد</Label>\n                  <Select\n                    value={item.supplierId?.toString() || \"\"}\n                    onValueChange={(value) =>\n                      updateItem(index, \"supplierId\", parseInt(value))\n                    }\n                  >\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"اختر المورد\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {suppliers.map((supplier) => (\n                        <SelectItem key={supplier.id} value={supplier.id.toString()}>\n                          {supplier.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>نوع الصنف (TYP)</Label>\n                  <Input\n                    value={item.productType || \"\"}\n                    onChange={(e) => updateItem(index, \"productType\", e.target.value)}\n                    placeholder=\"ملابس\"\n                  />\n                </div>\n                <div className=\"space-y-2 md:col-span-2\">\n                  <Label>اسم المنتج *</Label>\n                  <Input\n                    value={item.productName || \"\"}\n                    onChange={(e) => updateItem(index, \"productName\", e.target.value)}\n                    placeholder=\"قميص رجالي قطن\"\n                  />\n                </div>\n              </div>\n              <div className=\"grid grid-cols-2 md:grid-cols-5 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label>بلد المنشأ</Label>\n                  <Input\n                    value={item.countryOfOrigin || \"الصين\"}\n                    onChange={(e) => updateItem(index, \"countryOfOrigin\", e.target.value)}\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>عدد الكراتين (CTN)</Label>\n                  <Input\n                    type=\"number\"\n                    value={item.cartonsCtn || 0}\n                    onChange={(e) =>\n                      updateItem(index, \"cartonsCtn\", parseInt(e.target.value) || 0)\n                    }\n                    min=\"0\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>قطع/كرتونة (PCS)</Label>\n                  <Input\n                    type=\"number\"\n                    value={item.piecesPerCartonPcs || 0}\n                    onChange={(e) =>\n                      updateItem(index, \"piecesPerCartonPcs\", parseInt(e.target.value) || 0)\n                    }\n                    min=\"0\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>إجمالي القطع (COU)</Label>\n                  <Input\n                    value={item.totalPiecesCou || 0}\n                    readOnly\n                    className=\"bg-muted\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>سعر القطعة (RMB)</Label>\n                  <Input\n                    type=\"number\"\n                    step=\"0.01\"\n                    value={item.purchasePricePerPiecePriRmb || \"0\"}\n                    onChange={(e) =>\n                      updateItem(index, \"purchasePricePerPiecePriRmb\", e.target.value)\n                    }\n                    min=\"0\"\n                  />\n                </div>\n              </div>\n              <div className=\"flex justify-end\">\n                <div className=\"bg-primary/10 px-4 py-2 rounded-md\">\n                  <span className=\"text-sm text-muted-foreground ml-2\">\n                    إجمالي البند:\n                  </span>\n                  <span className=\"font-bold text-primary\">\n                    ¥ {new Intl.NumberFormat(\"ar-EG\").format(parseFloat(item.totalPurchaseCostRmb?.toString() || \"0\"))}\n                  </span>\n                </div>\n              </div>\n            </div>\n          ))}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\n// Step 2: Shipping\nfunction Step2Shipping({\n  shippingData,\n  setShippingData,\n  totalPurchaseCostRmb,\n  commissionRmb,\n  commissionEgp,\n  shippingCostUsd,\n  shippingCostRmb,\n  shippingCostEgp,\n}: {\n  shippingData: {\n    commissionRatePercent: string;\n    shippingAreaSqm: string;\n    shippingCostPerSqmUsdOriginal: string;\n    shippingDate: string;\n    rmbToEgpRate: string;\n    usdToRmbRate: string;\n  };\n  setShippingData: (data: typeof shippingData) => void;\n  totalPurchaseCostRmb: number;\n  commissionRmb: number;\n  commissionEgp: number;\n  shippingCostUsd: number;\n  shippingCostRmb: number;\n  shippingCostEgp: number;\n}) {\n  const formatCurrency = (value: number) =>\n    new Intl.NumberFormat(\"ar-EG\", {\n      minimumFractionDigits: 2,\n      maximumFractionDigits: 2,\n    }).format(value);\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Read-only Total */}\n      <Card className=\"bg-primary/5 border-primary/20\">\n        <CardContent className=\"p-4\">\n          <div className=\"flex items-center justify-between\">\n            <span className=\"font-medium\">إجمالي تكلفة الشراء (RMB)</span>\n            <span className=\"text-2xl font-bold text-primary\">\n              ¥ {formatCurrency(totalPurchaseCostRmb)}\n            </span>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Commission */}\n      <Card>\n        <CardHeader className=\"pb-4\">\n          <CardTitle className=\"text-lg\">العمولة</CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n            <div className=\"space-y-2\">\n              <Label>نسبة العمولة %</Label>\n              <Input\n                type=\"number\"\n                step=\"0.1\"\n                value={shippingData.commissionRatePercent}\n                onChange={(e) =>\n                  setShippingData({\n                    ...shippingData,\n                    commissionRatePercent: e.target.value,\n                  })\n                }\n                min=\"0\"\n                data-testid=\"input-commission-rate\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>قيمة العمولة (RMB)</Label>\n              <Input\n                value={`¥ ${formatCurrency(commissionRmb)}`}\n                readOnly\n                className=\"bg-muted\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>قيمة العمولة (ج.م)</Label>\n              <Input\n                value={`${formatCurrency(commissionEgp)} ج.م`}\n                readOnly\n                className=\"bg-muted font-bold text-primary\"\n              />\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Shipping Cost */}\n      <Card>\n        <CardHeader className=\"pb-4\">\n          <CardTitle className=\"text-lg\">تكلفة الشحن</CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n            <div className=\"space-y-2\">\n              <Label>مساحة الشحن (م²)</Label>\n              <Input\n                type=\"number\"\n                step=\"0.01\"\n                value={shippingData.shippingAreaSqm}\n                onChange={(e) =>\n                  setShippingData({ ...shippingData, shippingAreaSqm: e.target.value })\n                }\n                min=\"0\"\n                data-testid=\"input-shipping-area\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>سعر الشحن/م² (USD)</Label>\n              <Input\n                type=\"number\"\n                step=\"0.01\"\n                value={shippingData.shippingCostPerSqmUsdOriginal}\n                onChange={(e) =>\n                  setShippingData({\n                    ...shippingData,\n                    shippingCostPerSqmUsdOriginal: e.target.value,\n                  })\n                }\n                min=\"0\"\n                data-testid=\"input-shipping-cost-usd\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>تاريخ الشحن</Label>\n              <Input\n                type=\"date\"\n                value={shippingData.shippingDate}\n                onChange={(e) =>\n                  setShippingData({ ...shippingData, shippingDate: e.target.value })\n                }\n                data-testid=\"input-shipping-date\"\n              />\n            </div>\n          </div>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div className=\"space-y-2\">\n              <Label>سعر صرف USD → RMB</Label>\n              <Input\n                type=\"number\"\n                step=\"0.0001\"\n                value={shippingData.usdToRmbRate}\n                onChange={(e) =>\n                  setShippingData({ ...shippingData, usdToRmbRate: e.target.value })\n                }\n                min=\"0\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>سعر صرف RMB → EGP</Label>\n              <Input\n                type=\"number\"\n                step=\"0.0001\"\n                value={shippingData.rmbToEgpRate}\n                onChange={(e) =>\n                  setShippingData({ ...shippingData, rmbToEgpRate: e.target.value })\n                }\n                min=\"0\"\n              />\n            </div>\n          </div>\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 pt-4 border-t\">\n            <div className=\"bg-muted/50 p-3 rounded-md\">\n              <p className=\"text-sm text-muted-foreground\">إجمالي الشحن (USD)</p>\n              <p className=\"text-lg font-bold\">$ {formatCurrency(shippingCostUsd)}</p>\n            </div>\n            <div className=\"bg-muted/50 p-3 rounded-md\">\n              <p className=\"text-sm text-muted-foreground\">إجمالي الشحن (RMB)</p>\n              <p className=\"text-lg font-bold\">¥ {formatCurrency(shippingCostRmb)}</p>\n            </div>\n            <div className=\"bg-primary/10 p-3 rounded-md\">\n              <p className=\"text-sm text-muted-foreground\">إجمالي الشحن (ج.م)</p>\n              <p className=\"text-lg font-bold text-primary\">\n                {formatCurrency(shippingCostEgp)} ج.م\n              </p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\n// Step 3: Customs\nfunction Step3Customs({\n  items,\n  updateItem,\n  totalCustomsCostEgp,\n  totalTakhreegCostEgp,\n}: {\n  items: Partial<ShipmentItem>[];\n  updateItem: (index: number, field: string, value: string | number) => void;\n  totalCustomsCostEgp: number;\n  totalTakhreegCostEgp: number;\n}) {\n  const formatCurrency = (value: number) =>\n    new Intl.NumberFormat(\"ar-EG\", {\n      minimumFractionDigits: 2,\n      maximumFractionDigits: 2,\n    }).format(value);\n\n  return (\n    <div className=\"space-y-6\">\n      <Card>\n        <CardHeader className=\"pb-4\">\n          <CardTitle className=\"text-lg flex items-center gap-2\">\n            <FileCheck className=\"w-5 h-5\" />\n            الجمارك والتخريج\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          {items.map((item, index) => {\n            const ctn = item.cartonsCtn || 0;\n            const customsPerCarton = parseFloat(\n              item.customsCostPerCartonEgp?.toString() || \"0\"\n            );\n            const takhreegPerCarton = parseFloat(\n              item.takhreegCostPerCartonEgp?.toString() || \"0\"\n            );\n            const totalCustoms = ctn * customsPerCarton;\n            const totalTakhreeg = ctn * takhreegPerCarton;\n\n            return (\n              <div\n                key={index}\n                className=\"p-4 border rounded-md bg-card\"\n                data-testid={`customs-item-${index}`}\n              >\n                <div className=\"flex items-center justify-between mb-4\">\n                  <div>\n                    <span className=\"font-medium\">{item.productName || `البند ${index + 1}`}</span>\n                    <span className=\"text-sm text-muted-foreground mr-2\">\n                      ({ctn} كرتونة)\n                    </span>\n                  </div>\n                </div>\n                <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label>جمرك/كرتونة (ج.م)</Label>\n                    <Input\n                      type=\"number\"\n                      step=\"0.01\"\n                      value={item.customsCostPerCartonEgp || \"\"}\n                      onChange={(e) =>\n                        updateItem(index, \"customsCostPerCartonEgp\", e.target.value)\n                      }\n                      min=\"0\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label>إجمالي الجمرك (ج.م)</Label>\n                    <Input\n                      value={formatCurrency(totalCustoms)}\n                      readOnly\n                      className=\"bg-muted\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label>تخريج/كرتونة (ج.م)</Label>\n                    <Input\n                      type=\"number\"\n                      step=\"0.01\"\n                      value={item.takhreegCostPerCartonEgp || \"\"}\n                      onChange={(e) =>\n                        updateItem(index, \"takhreegCostPerCartonEgp\", e.target.value)\n                      }\n                      min=\"0\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label>إجمالي التخريج (ج.م)</Label>\n                    <Input\n                      value={formatCurrency(totalTakhreeg)}\n                      readOnly\n                      className=\"bg-muted\"\n                    />\n                  </div>\n                </div>\n              </div>\n            );\n          })}\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t\">\n            <div className=\"bg-amber-100 dark:bg-amber-900/30 p-4 rounded-md\">\n              <p className=\"text-sm text-amber-800 dark:text-amber-300\">\n                إجمالي الجمارك للشحنة\n              </p>\n              <p className=\"text-2xl font-bold text-amber-900 dark:text-amber-200\">\n                {formatCurrency(totalCustomsCostEgp)} ج.م\n              </p>\n            </div>\n            <div className=\"bg-blue-100 dark:bg-blue-900/30 p-4 rounded-md\">\n              <p className=\"text-sm text-blue-800 dark:text-blue-300\">\n                إجمالي التخريج للشحنة\n              </p>\n              <p className=\"text-2xl font-bold text-blue-900 dark:text-blue-200\">\n                {formatCurrency(totalTakhreegCostEgp)} ج.م\n              </p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\n// Step 4: Summary\nfunction Step4Summary({\n  shipmentData,\n  items,\n  totalPurchaseCostRmb,\n  purchaseCostEgp,\n  commissionRmb,\n  commissionEgp,\n  shippingCostRmb,\n  shippingCostEgp,\n  totalCustomsCostEgp,\n  totalTakhreegCostEgp,\n  finalTotalCostEgp,\n}: {\n  shipmentData: { shipmentCode: string; shipmentName: string; purchaseDate: string; status: string };\n  items: Partial<ShipmentItem>[];\n  totalPurchaseCostRmb: number;\n  purchaseCostEgp: number;\n  commissionRmb: number;\n  commissionEgp: number;\n  shippingCostRmb: number;\n  shippingCostEgp: number;\n  totalCustomsCostEgp: number;\n  totalTakhreegCostEgp: number;\n  finalTotalCostEgp: number;\n}) {\n  const formatCurrency = (value: number) =>\n    new Intl.NumberFormat(\"ar-EG\", {\n      minimumFractionDigits: 2,\n      maximumFractionDigits: 2,\n    }).format(value);\n\n  const totalCartons = items.reduce((sum, item) => sum + (item.cartonsCtn || 0), 0);\n  const totalPieces = items.reduce((sum, item) => sum + (item.totalPiecesCou || 0), 0);\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Shipment Info */}\n      <Card>\n        <CardHeader className=\"pb-4\">\n          <CardTitle className=\"text-lg flex items-center gap-2\">\n            <ClipboardCheck className=\"w-5 h-5\" />\n            ملخص الشحنة\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n            <div>\n              <p className=\"text-sm text-muted-foreground\">رقم الشحنة</p>\n              <p className=\"font-medium\">{shipmentData.shipmentCode}</p>\n            </div>\n            <div>\n              <p className=\"text-sm text-muted-foreground\">اسم الشحنة</p>\n              <p className=\"font-medium\">{shipmentData.shipmentName}</p>\n            </div>\n            <div>\n              <p className=\"text-sm text-muted-foreground\">تاريخ الشراء</p>\n              <p className=\"font-medium\">\n                {new Date(shipmentData.purchaseDate).toLocaleDateString(\"ar-EG\")}\n              </p>\n            </div>\n            <div>\n              <p className=\"text-sm text-muted-foreground\">الحالة</p>\n              <p className=\"font-medium\">{shipmentData.status}</p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Items Summary */}\n      <Card>\n        <CardHeader className=\"pb-4\">\n          <CardTitle className=\"text-lg\">ملخص البنود</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-3 gap-4 text-center\">\n            <div className=\"bg-muted/50 p-4 rounded-md\">\n              <p className=\"text-2xl font-bold\">{items.length}</p>\n              <p className=\"text-sm text-muted-foreground\">عدد الأصناف</p>\n            </div>\n            <div className=\"bg-muted/50 p-4 rounded-md\">\n              <p className=\"text-2xl font-bold\">{totalCartons}</p>\n              <p className=\"text-sm text-muted-foreground\">إجمالي الكراتين</p>\n            </div>\n            <div className=\"bg-muted/50 p-4 rounded-md\">\n              <p className=\"text-2xl font-bold\">{totalPieces}</p>\n              <p className=\"text-sm text-muted-foreground\">إجمالي القطع</p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Cost Breakdown */}\n      <Card>\n        <CardHeader className=\"pb-4\">\n          <CardTitle className=\"text-lg\">تفصيل التكاليف</CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-3\">\n          <CostRow\n            label=\"تكلفة الشراء\"\n            rmbValue={`¥ ${formatCurrency(totalPurchaseCostRmb)}`}\n            egpValue={`${formatCurrency(purchaseCostEgp)} ج.م`}\n          />\n          <CostRow\n            label=\"العمولة\"\n            rmbValue={`¥ ${formatCurrency(commissionRmb)}`}\n            egpValue={`${formatCurrency(commissionEgp)} ج.م`}\n          />\n          <CostRow\n            label=\"الشحن\"\n            rmbValue={`¥ ${formatCurrency(shippingCostRmb)}`}\n            egpValue={`${formatCurrency(shippingCostEgp)} ج.م`}\n          />\n          <CostRow\n            label=\"الجمارك\"\n            rmbValue=\"-\"\n            egpValue={`${formatCurrency(totalCustomsCostEgp)} ج.م`}\n          />\n          <CostRow\n            label=\"التخريج\"\n            rmbValue=\"-\"\n            egpValue={`${formatCurrency(totalTakhreegCostEgp)} ج.م`}\n          />\n          <hr className=\"border-border my-4\" />\n          <div className=\"flex items-center justify-between p-4 bg-primary/10 rounded-md\">\n            <span className=\"text-xl font-bold\">إجمالي تكلفة الشحنة</span>\n            <span className=\"text-2xl font-bold text-primary\">\n              {formatCurrency(finalTotalCostEgp)} ج.م\n            </span>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\nfunction CostRow({\n  label,\n  rmbValue,\n  egpValue,\n}: {\n  label: string;\n  rmbValue: string;\n  egpValue: string;\n}) {\n  return (\n    <div className=\"flex items-center justify-between py-2 border-b border-border last:border-0\">\n      <span className=\"font-medium\">{label}</span>\n      <div className=\"flex gap-8\">\n        <span className=\"text-muted-foreground w-32 text-left\">{rmbValue}</span>\n        <span className=\"font-medium w-32 text-left\">{egpValue}</span>\n      </div>\n    </div>\n  );\n}\n\nfunction SummaryRow({ label, value }: { label: string; value: string }) {\n  return (\n    <div className=\"flex justify-between items-center\">\n      <span className=\"text-sm text-muted-foreground\">{label}</span>\n      <span className=\"font-medium\">{value}</span>\n    </div>\n  );\n}\n\nfunction WizardSkeleton() {\n  return (\n    <div className=\"p-6 space-y-6\">\n      <Skeleton className=\"h-10 w-64\" />\n      <div className=\"flex gap-2 justify-center\">\n        {[1, 2, 3, 4].map((i) => (\n          <Skeleton key={i} className=\"h-10 w-32\" />\n        ))}\n      </div>\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        <div className=\"lg:col-span-2 space-y-4\">\n          <Skeleton className=\"h-48 w-full\" />\n          <Skeleton className=\"h-64 w-full\" />\n        </div>\n        <Skeleton className=\"h-96 w-full\" />\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":42195,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":791,"size_tokens":null},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"Cairo\", \"Tajawal\", \"var(--font-sans)\", \"sans-serif\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","path":null,"size_bytes":4084,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1251,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","path":null,"size_bytes":166,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8605,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","path":null,"size_bytes":157,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3021,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":844,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":711,"size_tokens":null},"server/db.ts":{"content":"import { drizzle } from \"drizzle-orm/node-postgres\";\nimport pg from \"pg\";\nimport * as schema from \"@shared/schema\";\n\nconst { Pool } = pg;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle(pool, { schema });\n","path":null,"size_bytes":395,"size_tokens":null},"test/authorization.test.ts":{"content":"import assert from \"node:assert/strict\";\nimport test from \"node:test\";\nimport { requireRole } from \"../server/auth\";\n\ntype MockRequest = {\n  isAuthenticated: () => boolean;\n  user?: Express.User;\n};\n\ntype MockResponse = {\n  statusCode: number;\n  payload: any;\n  status: (code: number) => MockResponse;\n  json: (body: any) => MockResponse;\n};\n\ntype NextFn = () => void;\n\nfunction createResponse(): MockResponse {\n  return {\n    statusCode: 200,\n    payload: undefined,\n    status(code: number) {\n      this.statusCode = code;\n      return this;\n    },\n    json(body: any) {\n      this.payload = body;\n      return this;\n    },\n  };\n}\n\ntest(\"returns 401 when unauthenticated\", async () => {\n  const middleware = requireRole([\"مدير\", \"محاسب\"]);\n  const req: MockRequest = {\n    isAuthenticated: () => false,\n  } as any;\n  const res = createResponse();\n  let nextCalled = false;\n\n  await middleware(req as any, res as any, (() => {\n    nextCalled = true;\n  }) as NextFn);\n\n  assert.equal(res.statusCode, 401);\n  assert.equal(res.payload?.message, \"يجب تسجيل الدخول أولاً\");\n  assert.equal(nextCalled, false);\n});\n\ntest(\"blocks roles outside the allowed list with 403\", async () => {\n  const middleware = requireRole([\"مدير\", \"محاسب\"]);\n  const req: MockRequest = {\n    isAuthenticated: () => true,\n    user: { id: \"1\", username: \"viewer\", firstName: null, lastName: null, role: \"مشاهد\" },\n  } as any;\n  const res = createResponse();\n  let nextCalled = false;\n\n  await middleware(req as any, res as any, (() => {\n    nextCalled = true;\n  }) as NextFn);\n\n  assert.equal(res.statusCode, 403);\n  assert.equal(res.payload?.message, \"لا تملك صلاحية لتنفيذ هذا الإجراء\");\n  assert.equal(nextCalled, false);\n});\n\ntest(\"allows permitted roles to continue\", async () => {\n  const middleware = requireRole([\"مدير\", \"محاسب\"]);\n  const req: MockRequest = {\n    isAuthenticated: () => true,\n    user: { id: \"1\", username: \"admin\", firstName: null, lastName: null, role: \"مدير\" },\n  } as any;\n  const res = createResponse();\n  let nextCalled = false;\n\n  await middleware(req as any, res as any, (() => {\n    nextCalled = true;\n  }) as NextFn);\n\n  assert.equal(res.statusCode, 200);\n  assert.equal(res.payload, undefined);\n  assert.equal(nextCalled, true);\n});\n","path":null,"size_bytes":2324,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10481,"size_tokens":null},"client/src/pages/suppliers.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport {\n  Users,\n  Plus,\n  Search,\n  Edit,\n  Trash2,\n  Phone,\n  Mail,\n  MapPin,\n  Building,\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Switch } from \"@/components/ui/switch\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport type { Supplier, InsertSupplier } from \"@shared/schema\";\n\nexport default function Suppliers() {\n  const [search, setSearch] = useState(\"\");\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingSupplier, setEditingSupplier] = useState<Supplier | null>(null);\n  const { toast } = useToast();\n\n  const { data: suppliers, isLoading } = useQuery<Supplier[]>({\n    queryKey: [\"/api/suppliers\"],\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: InsertSupplier) => {\n      return apiRequest(\"POST\", \"/api/suppliers\", data);\n    },\n    onSuccess: () => {\n      toast({ title: \"تم إضافة المورد بنجاح\" });\n      queryClient.invalidateQueries({ queryKey: [\"/api/suppliers\"] });\n      setIsDialogOpen(false);\n      setEditingSupplier(null);\n    },\n    onError: () => {\n      toast({ title: \"حدث خطأ\", variant: \"destructive\" });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: number; data: Partial<InsertSupplier> }) => {\n      return apiRequest(\"PATCH\", `/api/suppliers/${id}`, data);\n    },\n    onSuccess: () => {\n      toast({ title: \"تم تحديث المورد بنجاح\" });\n      queryClient.invalidateQueries({ queryKey: [\"/api/suppliers\"] });\n      setIsDialogOpen(false);\n      setEditingSupplier(null);\n    },\n    onError: () => {\n      toast({ title: \"حدث خطأ\", variant: \"destructive\" });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: number) => {\n      return apiRequest(\"DELETE\", `/api/suppliers/${id}`);\n    },\n    onSuccess: () => {\n      toast({ title: \"تم حذف المورد بنجاح\" });\n      queryClient.invalidateQueries({ queryKey: [\"/api/suppliers\"] });\n    },\n    onError: () => {\n      toast({ title: \"حدث خطأ\", variant: \"destructive\" });\n    },\n  });\n\n  const filteredSuppliers = suppliers?.filter(\n    (supplier) =>\n      !search ||\n      supplier.name.toLowerCase().includes(search.toLowerCase()) ||\n      supplier.country?.toLowerCase().includes(search.toLowerCase())\n  );\n\n  const handleSubmit = (e: React.FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n    const formData = new FormData(e.currentTarget);\n    const data: InsertSupplier = {\n      name: formData.get(\"name\") as string,\n      description: (formData.get(\"description\") as string) || null,\n      country: (formData.get(\"country\") as string) || \"الصين\",\n      phone: (formData.get(\"phone\") as string) || null,\n      email: (formData.get(\"email\") as string) || null,\n      address: (formData.get(\"address\") as string) || null,\n      isActive: formData.get(\"isActive\") === \"on\",\n    };\n\n    if (editingSupplier) {\n      updateMutation.mutate({ id: editingSupplier.id, data });\n    } else {\n      createMutation.mutate(data);\n    }\n  };\n\n  const openEditDialog = (supplier: Supplier) => {\n    setEditingSupplier(supplier);\n    setIsDialogOpen(true);\n  };\n\n  const openNewDialog = () => {\n    setEditingSupplier(null);\n    setIsDialogOpen(true);\n  };\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-wrap items-center justify-between gap-4\">\n        <div>\n          <h1 className=\"text-3xl font-semibold\">الموردون</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            إضافة وتعديل بيانات الموردين المرتبطين بكل صنف\n          </p>\n        </div>\n        <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n          <DialogTrigger asChild>\n            <Button onClick={openNewDialog} data-testid=\"button-add-supplier\">\n              <Plus className=\"w-4 h-4 ml-2\" />\n              إضافة مورد جديد\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-md\">\n            <DialogHeader>\n              <DialogTitle>\n                {editingSupplier ? \"تعديل المورد\" : \"إضافة مورد جديد\"}\n              </DialogTitle>\n            </DialogHeader>\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"name\">اسم المورد *</Label>\n                <Input\n                  id=\"name\"\n                  name=\"name\"\n                  defaultValue={editingSupplier?.name || \"\"}\n                  required\n                  data-testid=\"input-supplier-name\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"country\">البلد</Label>\n                <Input\n                  id=\"country\"\n                  name=\"country\"\n                  defaultValue={editingSupplier?.country || \"الصين\"}\n                  data-testid=\"input-supplier-country\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"phone\">الهاتف</Label>\n                <Input\n                  id=\"phone\"\n                  name=\"phone\"\n                  defaultValue={editingSupplier?.phone || \"\"}\n                  data-testid=\"input-supplier-phone\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"email\">البريد الإلكتروني</Label>\n                <Input\n                  id=\"email\"\n                  name=\"email\"\n                  type=\"email\"\n                  defaultValue={editingSupplier?.email || \"\"}\n                  data-testid=\"input-supplier-email\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"address\">العنوان</Label>\n                <Textarea\n                  id=\"address\"\n                  name=\"address\"\n                  defaultValue={editingSupplier?.address || \"\"}\n                  rows={2}\n                  data-testid=\"input-supplier-address\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"description\">الوصف</Label>\n                <Textarea\n                  id=\"description\"\n                  name=\"description\"\n                  defaultValue={editingSupplier?.description || \"\"}\n                  rows={2}\n                  data-testid=\"input-supplier-description\"\n                />\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Switch\n                  id=\"isActive\"\n                  name=\"isActive\"\n                  defaultChecked={editingSupplier?.isActive ?? true}\n                />\n                <Label htmlFor=\"isActive\">نشط</Label>\n              </div>\n              <div className=\"flex gap-2 pt-4\">\n                <Button\n                  type=\"submit\"\n                  className=\"flex-1\"\n                  disabled={createMutation.isPending || updateMutation.isPending}\n                  data-testid=\"button-save-supplier\"\n                >\n                  {createMutation.isPending || updateMutation.isPending\n                    ? \"جاري الحفظ...\"\n                    : \"حفظ\"}\n                </Button>\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setIsDialogOpen(false)}\n                >\n                  إلغاء\n                </Button>\n              </div>\n            </form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Search */}\n      <Card>\n        <CardContent className=\"p-4\">\n          <div className=\"relative max-w-md\">\n            <Search className=\"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\n            <Input\n              placeholder=\"بحث بالاسم أو البلد...\"\n              value={search}\n              onChange={(e) => setSearch(e.target.value)}\n              className=\"pr-10\"\n              data-testid=\"input-search-suppliers\"\n            />\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Suppliers Grid */}\n      {isLoading ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          {[1, 2, 3, 4, 5, 6].map((i) => (\n            <Skeleton key={i} className=\"h-48\" />\n          ))}\n        </div>\n      ) : filteredSuppliers && filteredSuppliers.length > 0 ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          {filteredSuppliers.map((supplier) => (\n            <Card\n              key={supplier.id}\n              className=\"hover-elevate\"\n              data-testid={`card-supplier-${supplier.id}`}\n            >\n              <CardHeader className=\"pb-3\">\n                <div className=\"flex items-start justify-between gap-2\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"w-10 h-10 rounded-md bg-primary/10 flex items-center justify-center\">\n                      <Building className=\"w-5 h-5 text-primary\" />\n                    </div>\n                    <div>\n                      <CardTitle className=\"text-lg\">{supplier.name}</CardTitle>\n                      <div className=\"flex items-center gap-2 mt-1\">\n                        <MapPin className=\"w-3 h-3 text-muted-foreground\" />\n                        <span className=\"text-sm text-muted-foreground\">\n                          {supplier.country || \"الصين\"}\n                        </span>\n                      </div>\n                    </div>\n                  </div>\n                  <Badge\n                    variant={supplier.isActive ? \"default\" : \"secondary\"}\n                    className={\n                      supplier.isActive\n                        ? \"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400\"\n                        : \"\"\n                    }\n                  >\n                    {supplier.isActive ? \"نشط\" : \"غير نشط\"}\n                  </Badge>\n                </div>\n              </CardHeader>\n              <CardContent className=\"space-y-3\">\n                {supplier.description && (\n                  <p className=\"text-sm text-muted-foreground line-clamp-2\">\n                    {supplier.description}\n                  </p>\n                )}\n                <div className=\"flex flex-wrap gap-2 text-sm text-muted-foreground\">\n                  {supplier.phone && (\n                    <div className=\"flex items-center gap-1\">\n                      <Phone className=\"w-3 h-3\" />\n                      <span>{supplier.phone}</span>\n                    </div>\n                  )}\n                  {supplier.email && (\n                    <div className=\"flex items-center gap-1\">\n                      <Mail className=\"w-3 h-3\" />\n                      <span>{supplier.email}</span>\n                    </div>\n                  )}\n                </div>\n                <div className=\"flex gap-2 pt-2 border-t\">\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    className=\"flex-1\"\n                    onClick={() => openEditDialog(supplier)}\n                    data-testid={`button-edit-supplier-${supplier.id}`}\n                  >\n                    <Edit className=\"w-4 h-4 ml-1\" />\n                    تعديل\n                  </Button>\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    className=\"text-destructive\"\n                    onClick={() => deleteMutation.mutate(supplier.id)}\n                    disabled={deleteMutation.isPending}\n                    data-testid={`button-delete-supplier-${supplier.id}`}\n                  >\n                    <Trash2 className=\"w-4 h-4\" />\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      ) : (\n        <Card>\n          <CardContent className=\"py-16\">\n            <div className=\"flex flex-col items-center justify-center text-center\">\n              <div className=\"w-20 h-20 rounded-full bg-muted flex items-center justify-center mb-6\">\n                <Users className=\"w-10 h-10 text-muted-foreground\" />\n              </div>\n              <h3 className=\"text-xl font-medium mb-2\">لا يوجد موردون</h3>\n              <p className=\"text-muted-foreground mb-6\">\n                ابدأ بإضافة موردك الأول لربطه بالأصناف\n              </p>\n              <Button onClick={openNewDialog}>\n                <Plus className=\"w-4 h-4 ml-2\" />\n                إضافة مورد جديد\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":13521,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1527,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1056,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1584,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7609,"size_tokens":null},"server/payments.test.ts":{"content":"import assert from \"node:assert/strict\";\nimport { describe, it, mock } from \"node:test\";\n\nimport type { Shipment, ShipmentPayment } from \"@shared/schema\";\nimport { getPaymentsWithShipments } from \"./payments\";\n\nconst baseShipment: Shipment = {\n  id: 10,\n  shipmentCode: \"SH-10\",\n  shipmentName: \"Test Shipment\",\n  purchaseDate: new Date(\"2024-01-01\"),\n  status: \"جديدة\",\n  invoiceCustomsDate: null,\n  createdByUserId: null,\n  purchaseCostRmb: \"0\",\n  purchaseCostEgp: \"0\",\n  commissionCostRmb: \"0\",\n  commissionCostEgp: \"0\",\n  shippingCostRmb: \"0\",\n  shippingCostEgp: \"0\",\n  customsCostEgp: \"0\",\n  takhreegCostEgp: \"0\",\n  finalTotalCostEgp: \"0\",\n  totalPaidEgp: \"0\",\n  balanceEgp: \"0\",\n  lastPaymentDate: null,\n  createdAt: new Date(\"2024-01-02\"),\n  updatedAt: new Date(\"2024-01-02\"),\n};\n\nconst createPayment = (overrides: Partial<ShipmentPayment>): ShipmentPayment => ({\n  id: 1,\n  shipmentId: baseShipment.id,\n  paymentDate: new Date(\"2024-02-01\"),\n  paymentCurrency: \"EGP\",\n  amountOriginal: \"100.00\",\n  exchangeRateToEgp: null,\n  amountEgp: \"100.00\",\n  paymentMethod: \"نقدي\",\n  cashReceiverName: \"Ali\",\n  referenceNumber: null,\n  note: null,\n  createdByUserId: null,\n  createdAt: new Date(\"2024-02-02\"),\n  updatedAt: new Date(\"2024-02-02\"),\n  ...overrides,\n});\n\ndescribe(\"getPaymentsWithShipments\", () => {\n  it(\"fetches shipments once for multiple payments and combines the results\", async () => {\n    const payments = [\n      createPayment({ id: 1 }),\n      createPayment({ id: 2, shipmentId: baseShipment.id }),\n    ];\n\n    const storage = {\n      getAllPayments: mock.fn(async () => payments),\n      getShipmentsByIds: mock.fn(async (_ids: number[]) => [baseShipment]),\n    };\n\n    const result = await getPaymentsWithShipments(storage);\n\n    assert.equal(storage.getShipmentsByIds.mock.calls.length, 1);\n    assert.equal(result.length, payments.length);\n    assert.ok(result.every((payment) => payment.shipment?.id === baseShipment.id));\n  });\n\n  it(\"skips shipment lookup when there are no payments\", async () => {\n    const storage = {\n      getAllPayments: mock.fn(async () => [] as ShipmentPayment[]),\n      getShipmentsByIds: mock.fn(async () => [] as Shipment[]),\n    };\n\n    const result = await getPaymentsWithShipments(storage);\n\n    assert.equal(storage.getShipmentsByIds.mock.calls.length, 0);\n    assert.deepEqual(result, []);\n  });\n});\n","path":null,"size_bytes":2366,"size_tokens":null},"client/src/pages/dashboard.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Ship, CreditCard, TrendingUp, TrendingDown, Package, AlertCircle } from \"lucide-react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Link } from \"wouter\";\nimport type { Shipment } from \"@shared/schema\";\n\ninterface DashboardStats {\n  totalShipments: number;\n  totalCostEgp: string;\n  totalPaidEgp: string;\n  totalBalanceEgp: string;\n  totalOverpaidEgp: string;\n  recentShipments: Shipment[];\n  pendingShipments: number;\n  completedShipments: number;\n}\n\nexport default function Dashboard() {\n  const { data: stats, isLoading } = useQuery<DashboardStats>({\n    queryKey: [\"/api/dashboard/stats\"],\n  });\n\n  if (isLoading) {\n    return <DashboardSkeleton />;\n  }\n\n  const formatCurrency = (value: string | number) => {\n    const num = typeof value === \"string\" ? parseFloat(value) : value;\n    return new Intl.NumberFormat(\"ar-EG\", {\n      minimumFractionDigits: 2,\n      maximumFractionDigits: 2,\n    }).format(num || 0);\n  };\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      {/* Page Header */}\n      <div className=\"flex flex-wrap items-center justify-between gap-4\">\n        <div>\n          <h1 className=\"text-3xl font-semibold\">لوحة التحكم</h1>\n          <p className=\"text-muted-foreground mt-1\">نظرة عامة على الشحنات والمدفوعات</p>\n        </div>\n        <Button asChild data-testid=\"button-new-shipment\">\n          <Link href=\"/shipments/new\">\n            <Ship className=\"w-4 h-4 ml-2\" />\n            إضافة شحنة جديدة\n          </Link>\n        </Button>\n      </div>\n\n      {/* Stats Cards */}\n      <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4\">\n        <StatCard\n          title=\"إجمالي الشحنات\"\n          value={stats?.totalShipments?.toString() || \"0\"}\n          icon={Ship}\n          subtitle={`${stats?.pendingShipments || 0} قيد المعالجة`}\n        />\n        <StatCard\n          title=\"إجمالي التكلفة\"\n          value={`${formatCurrency(stats?.totalCostEgp || 0)} ج.م`}\n          icon={Package}\n          subtitle=\"جنيه مصري\"\n        />\n        <StatCard\n          title=\"إجمالي المدفوع\"\n          value={`${formatCurrency(stats?.totalPaidEgp || 0)} ج.م`}\n          icon={CreditCard}\n          subtitle=\"جنيه مصري\"\n          trend=\"up\"\n        />\n        <StatCard\n          title=\"المتبقي\"\n          value={`${formatCurrency(stats?.totalBalanceEgp || 0)} ج.م`}\n          icon={parseFloat(stats?.totalBalanceEgp || \"0\") > 0 ? TrendingDown : TrendingUp}\n          subtitle={\n            parseFloat(stats?.totalOverpaidEgp || \"0\") > 0\n              ? `مدفوع زيادة: ${formatCurrency(stats?.totalOverpaidEgp || 0)} ج.م`\n              : \"المبلغ المستحق\"\n          }\n          trend={parseFloat(stats?.totalBalanceEgp || \"0\") > 0 ? \"down\" : \"up\"}\n        />\n      </div>\n\n      {/* Recent Shipments & Quick Actions */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        {/* Recent Shipments */}\n        <Card className=\"lg:col-span-2\">\n          <CardHeader className=\"flex flex-row items-center justify-between gap-4 pb-4\">\n            <CardTitle className=\"text-lg font-semibold\">أحدث الشحنات</CardTitle>\n            <Button variant=\"outline\" size=\"sm\" asChild>\n              <Link href=\"/shipments\">عرض الكل</Link>\n            </Button>\n          </CardHeader>\n          <CardContent>\n            {stats?.recentShipments && stats.recentShipments.length > 0 ? (\n              <div className=\"space-y-4\">\n                {stats.recentShipments.map((shipment) => (\n                  <div\n                    key={shipment.id}\n                    className=\"flex items-center justify-between gap-4 p-4 rounded-md border bg-card hover-elevate\"\n                    data-testid={`shipment-row-${shipment.id}`}\n                  >\n                    <div className=\"flex items-center gap-4\">\n                      <div className=\"w-10 h-10 rounded-md bg-primary/10 flex items-center justify-center\">\n                        <Ship className=\"w-5 h-5 text-primary\" />\n                      </div>\n                      <div>\n                        <p className=\"font-medium\">{shipment.shipmentName}</p>\n                        <p className=\"text-sm text-muted-foreground\">\n                          {shipment.shipmentCode}\n                        </p>\n                      </div>\n                    </div>\n                    <div className=\"flex items-center gap-4\">\n                      <StatusBadge status={shipment.status} />\n                      <div className=\"text-left\">\n                        <p className=\"font-medium\">\n                          {formatCurrency(shipment.finalTotalCostEgp || 0)} ج.م\n                        </p>\n                        <p className=\"text-sm text-muted-foreground\">\n                          {(() => {\n                            const cost = parseFloat(shipment.finalTotalCostEgp || \"0\");\n                            const paid = parseFloat(shipment.totalPaidEgp || \"0\");\n                            const remaining = Math.max(0, cost - paid);\n                            const overpaid = Math.max(0, paid - cost);\n\n                            if (overpaid > 0) {\n                              return `مبلغ زيادة: ${formatCurrency(overpaid)}`;\n                            }\n                            if (remaining > 0) {\n                              return `متبقي: ${formatCurrency(remaining)}`;\n                            }\n                            return \"مسددة\";\n                          })()}\n                        </p>\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            ) : (\n              <EmptyState\n                icon={Ship}\n                title=\"لا توجد شحنات\"\n                description=\"ابدأ بإضافة شحنتك الأولى\"\n              />\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Quick Actions */}\n        <Card>\n          <CardHeader className=\"pb-4\">\n            <CardTitle className=\"text-lg font-semibold\">إجراءات سريعة</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            <Button variant=\"outline\" className=\"w-full justify-start gap-3\" asChild>\n              <Link href=\"/shipments/new\">\n                <Ship className=\"w-4 h-4\" />\n                إضافة شحنة جديدة\n              </Link>\n            </Button>\n            <Button variant=\"outline\" className=\"w-full justify-start gap-3\" asChild>\n              <Link href=\"/suppliers\">\n                <Package className=\"w-4 h-4\" />\n                إدارة الموردين\n              </Link>\n            </Button>\n            <Button variant=\"outline\" className=\"w-full justify-start gap-3\" asChild>\n              <Link href=\"/payments\">\n                <CreditCard className=\"w-4 h-4\" />\n                سداد الشحنات\n              </Link>\n            </Button>\n            <Button variant=\"outline\" className=\"w-full justify-start gap-3\" asChild>\n              <Link href=\"/exchange-rates\">\n                <TrendingUp className=\"w-4 h-4\" />\n                أسعار الصرف\n              </Link>\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n\nfunction StatCard({\n  title,\n  value,\n  icon: Icon,\n  subtitle,\n  trend,\n}: {\n  title: string;\n  value: string;\n  icon: typeof Ship;\n  subtitle: string;\n  trend?: \"up\" | \"down\";\n}) {\n  return (\n    <Card>\n      <CardContent className=\"p-6\">\n        <div className=\"flex items-start justify-between gap-4\">\n          <div className=\"flex flex-col gap-2\">\n            <p className=\"text-sm text-muted-foreground\">{title}</p>\n            <p className=\"text-2xl font-bold\" data-testid={`stat-${title}`}>\n              {value}\n            </p>\n            <p\n              className={`text-xs ${\n                trend === \"up\"\n                  ? \"text-green-600 dark:text-green-400\"\n                  : trend === \"down\"\n                  ? \"text-red-600 dark:text-red-400\"\n                  : \"text-muted-foreground\"\n              }`}\n            >\n              {subtitle}\n            </p>\n          </div>\n          <div\n            className={`w-12 h-12 rounded-md flex items-center justify-center ${\n              trend === \"up\"\n                ? \"bg-green-100 dark:bg-green-900/30\"\n                : trend === \"down\"\n                ? \"bg-red-100 dark:bg-red-900/30\"\n                : \"bg-primary/10\"\n            }`}\n          >\n            <Icon\n              className={`w-6 h-6 ${\n                trend === \"up\"\n                  ? \"text-green-600 dark:text-green-400\"\n                  : trend === \"down\"\n                  ? \"text-red-600 dark:text-red-400\"\n                  : \"text-primary\"\n              }`}\n            />\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n\nfunction StatusBadge({ status }: { status: string }) {\n  const variants: Record<string, \"default\" | \"secondary\" | \"destructive\" | \"outline\"> = {\n    جديدة: \"outline\",\n    \"في انتظار الشحن\": \"secondary\",\n    \"جاهزة للاستلام\": \"default\",\n    \"مستلمة بنجاح\": \"default\",\n  };\n\n  const colors: Record<string, string> = {\n    جديدة: \"\",\n    \"في انتظار الشحن\": \"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-400 border-amber-200 dark:border-amber-800\",\n    \"جاهزة للاستلام\": \"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400 border-blue-200 dark:border-blue-800\",\n    \"مستلمة بنجاح\": \"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400 border-green-200 dark:border-green-800\",\n  };\n\n  return (\n    <Badge\n      variant={variants[status] || \"outline\"}\n      className={colors[status] || \"\"}\n    >\n      {status}\n    </Badge>\n  );\n}\n\nfunction EmptyState({\n  icon: Icon,\n  title,\n  description,\n}: {\n  icon: typeof AlertCircle;\n  title: string;\n  description: string;\n}) {\n  return (\n    <div className=\"flex flex-col items-center justify-center py-12 text-center\">\n      <div className=\"w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4\">\n        <Icon className=\"w-8 h-8 text-muted-foreground\" />\n      </div>\n      <h3 className=\"font-medium text-lg mb-1\">{title}</h3>\n      <p className=\"text-sm text-muted-foreground\">{description}</p>\n    </div>\n  );\n}\n\nfunction DashboardSkeleton() {\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <Skeleton className=\"h-8 w-32 mb-2\" />\n          <Skeleton className=\"h-4 w-48\" />\n        </div>\n        <Skeleton className=\"h-10 w-40\" />\n      </div>\n      <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4\">\n        {[1, 2, 3, 4].map((i) => (\n          <Card key={i}>\n            <CardContent className=\"p-6\">\n              <Skeleton className=\"h-4 w-20 mb-2\" />\n              <Skeleton className=\"h-8 w-32 mb-2\" />\n              <Skeleton className=\"h-3 w-24\" />\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        <Card className=\"lg:col-span-2\">\n          <CardHeader>\n            <Skeleton className=\"h-6 w-32\" />\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {[1, 2, 3].map((i) => (\n              <Skeleton key={i} className=\"h-20 w-full\" />\n            ))}\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader>\n            <Skeleton className=\"h-6 w-28\" />\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            {[1, 2, 3, 4].map((i) => (\n              <Skeleton key={i} className=\"h-10 w-full\" />\n            ))}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":12206,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","path":null,"size_bytes":1280,"size_tokens":null},"client/src/components/app-sidebar.tsx":{"content":"import { Link, useLocation } from \"wouter\";\nimport {\n  Ship,\n  Users,\n  DollarSign,\n  Package,\n  CreditCard,\n  Shield,\n  LayoutDashboard,\n} from \"lucide-react\";\nimport {\n  Sidebar,\n  SidebarContent,\n  SidebarGroup,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarMenu,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarHeader,\n  SidebarFooter,\n} from \"@/components/ui/sidebar\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { Button } from \"@/components/ui/button\";\nimport { LogOut } from \"lucide-react\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\nconst menuItems = [\n  {\n    title: \"لوحة التحكم\",\n    url: \"/\",\n    icon: LayoutDashboard,\n    tooltip: \"نظرة عامة على جميع الشحنات والمدفوعات\",\n  },\n  {\n    title: \"الشحنات\",\n    url: \"/shipments\",\n    icon: Ship,\n    tooltip: \"إدارة جميع الشحنات من لحظة الشراء حتى الاستلام\",\n  },\n  {\n    title: \"الموردون\",\n    url: \"/suppliers\",\n    icon: Users,\n    tooltip: \"إضافة وتعديل بيانات الموردين المرتبطين بكل صنف\",\n  },\n  {\n    title: \"أسعار الصرف\",\n    url: \"/exchange-rates\",\n    icon: DollarSign,\n    tooltip: \"إدارة أسعار تحويل العملات بين الرممبي والجنيه وباقي العملات\",\n  },\n  {\n    title: \"المخزون\",\n    url: \"/inventory\",\n    icon: Package,\n    tooltip: \"متابعة الأصناف المستلمة وتكلفتها في المخزون\",\n  },\n  {\n    title: \"سداد الشحنات\",\n    url: \"/payments\",\n    icon: CreditCard,\n    tooltip: \"متابعة إجمالي ما تم دفعه وما هو متبقي على جميع الشحنات\",\n  },\n];\n\nconst adminItems = [\n  {\n    title: \"المستخدمون والصلاحيات\",\n    url: \"/users\",\n    icon: Shield,\n    tooltip: \"إدارة حسابات المستخدمين والصلاحيات\",\n  },\n];\n\nexport function AppSidebar() {\n  const [location] = useLocation();\n  const { user } = useAuth();\n\n  const isAdmin = user?.role === \"مدير\";\n\n  return (\n    <Sidebar side=\"right\" collapsible=\"icon\">\n      <SidebarHeader className=\"p-4 border-b border-sidebar-border\">\n        <div className=\"flex items-center gap-3\">\n          <div className=\"w-10 h-10 rounded-md bg-primary flex items-center justify-center\">\n            <Ship className=\"w-6 h-6 text-primary-foreground\" />\n          </div>\n          <div className=\"flex flex-col group-data-[collapsible=icon]:hidden\">\n            <span className=\"font-semibold text-lg\">Repit.AI</span>\n            <span className=\"text-xs text-muted-foreground\">إدارة الشحنات</span>\n          </div>\n        </div>\n      </SidebarHeader>\n\n      <SidebarContent>\n        <SidebarGroup>\n          <SidebarGroupLabel>القائمة الرئيسية</SidebarGroupLabel>\n          <SidebarGroupContent>\n            <SidebarMenu>\n              {menuItems.map((item) => (\n                <SidebarMenuItem key={item.title}>\n                  <Tooltip>\n                    <TooltipTrigger asChild>\n                      <SidebarMenuButton\n                        asChild\n                        isActive={location === item.url}\n                        data-testid={`nav-${item.url.replace(\"/\", \"\") || \"dashboard\"}`}\n                      >\n                        <Link href={item.url}>\n                          <item.icon className=\"w-5 h-5\" />\n                          <span>{item.title}</span>\n                        </Link>\n                      </SidebarMenuButton>\n                    </TooltipTrigger>\n                    <TooltipContent side=\"left\" className=\"max-w-xs\">\n                      {item.tooltip}\n                    </TooltipContent>\n                  </Tooltip>\n                </SidebarMenuItem>\n              ))}\n            </SidebarMenu>\n          </SidebarGroupContent>\n        </SidebarGroup>\n\n        {isAdmin && (\n          <SidebarGroup>\n            <SidebarGroupLabel>الإدارة</SidebarGroupLabel>\n            <SidebarGroupContent>\n              <SidebarMenu>\n                {adminItems.map((item) => (\n                  <SidebarMenuItem key={item.title}>\n                    <Tooltip>\n                      <TooltipTrigger asChild>\n                        <SidebarMenuButton\n                          asChild\n                          isActive={location === item.url}\n                          data-testid={`nav-${item.url.replace(\"/\", \"\")}`}\n                        >\n                          <Link href={item.url}>\n                            <item.icon className=\"w-5 h-5\" />\n                            <span>{item.title}</span>\n                          </Link>\n                        </SidebarMenuButton>\n                      </TooltipTrigger>\n                      <TooltipContent side=\"left\" className=\"max-w-xs\">\n                        {item.tooltip}\n                      </TooltipContent>\n                    </Tooltip>\n                  </SidebarMenuItem>\n                ))}\n              </SidebarMenu>\n            </SidebarGroupContent>\n          </SidebarGroup>\n        )}\n      </SidebarContent>\n\n      <SidebarFooter className=\"p-4 border-t border-sidebar-border\">\n        <SidebarUserFooter />\n      </SidebarFooter>\n    </Sidebar>\n  );\n}\n\nfunction SidebarUserFooter() {\n  const { user } = useAuth();\n  const queryClient = useQueryClient();\n\n  const logoutMutation = useMutation({\n    mutationFn: async () => {\n      await apiRequest(\"POST\", \"/api/logout\");\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n      window.location.href = \"/\";\n    },\n  });\n\n  const handleLogout = () => {\n    logoutMutation.mutate();\n  };\n\n  return (\n    <div className=\"flex items-center gap-3\">\n      <Avatar className=\"w-10 h-10\">\n        <AvatarFallback className=\"bg-primary/10 text-primary font-medium\">\n          {user?.firstName?.[0] || (user as any)?.username?.[0]?.toUpperCase() || \"م\"}\n        </AvatarFallback>\n      </Avatar>\n      <div className=\"flex-1 flex flex-col group-data-[collapsible=icon]:hidden\">\n        <span className=\"font-medium text-sm\">\n          {user?.firstName && user?.lastName\n            ? `${user.firstName} ${user.lastName}`\n            : (user as any)?.username || \"مستخدم\"}\n        </span>\n        <span className=\"text-xs text-muted-foreground\">{user?.role || \"مشاهد\"}</span>\n      </div>\n      <Tooltip>\n        <TooltipTrigger asChild>\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={handleLogout}\n            className=\"group-data-[collapsible=icon]:hidden\"\n            data-testid=\"button-logout\"\n            disabled={logoutMutation.isPending}\n          >\n            <LogOut className=\"w-4 h-4\" />\n          </Button>\n        </TooltipTrigger>\n        <TooltipContent side=\"left\">تسجيل الخروج</TooltipContent>\n      </Tooltip>\n    </div>\n  );\n}\n","path":null,"size_bytes":7158,"size_tokens":null},"server/auth.ts":{"content":"import passport from \"passport\";\nimport { Strategy as LocalStrategy } from \"passport-local\";\nimport session from \"express-session\";\nimport type { Express, RequestHandler } from \"express\";\nimport connectPg from \"connect-pg-simple\";\nimport { storage } from \"./storage\";\nimport bcrypt from \"bcryptjs\";\n\ndeclare global {\n  namespace Express {\n    interface User {\n      id: string;\n      username: string;\n      firstName: string | null;\n      lastName: string | null;\n      role: string;\n    }\n  }\n}\n\nexport function getSession() {\n  const sessionTtl = 7 * 24 * 60 * 60 * 1000; // 1 week\n  const pgStore = connectPg(session);\n  const sessionStore = new pgStore({\n    conString: process.env.DATABASE_URL,\n    createTableIfMissing: false,\n    ttl: sessionTtl,\n    tableName: \"sessions\",\n  });\n  \n  const sessionSecret = process.env.SESSION_SECRET || \"fallback-secret-change-in-production\";\n  \n  return session({\n    secret: sessionSecret,\n    store: sessionStore,\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      httpOnly: true,\n      secure: process.env.NODE_ENV === \"production\",\n      maxAge: sessionTtl,\n    },\n  });\n}\n\nexport async function setupAuth(app: Express) {\n  app.set(\"trust proxy\", 1);\n  app.use(getSession());\n  app.use(passport.initialize());\n  app.use(passport.session());\n\n  passport.use(\n    new LocalStrategy(async (username, password, done) => {\n      try {\n        const user = await storage.getUserByUsername(username);\n        if (!user) {\n          return done(null, false, { message: \"اسم المستخدم غير صحيح\" });\n        }\n\n        const isValid = await bcrypt.compare(password, user.password);\n        if (!isValid) {\n          return done(null, false, { message: \"كلمة المرور غير صحيحة\" });\n        }\n\n        return done(null, {\n          id: user.id,\n          username: user.username,\n          firstName: user.firstName,\n          lastName: user.lastName,\n          role: user.role,\n        });\n      } catch (error) {\n        return done(error);\n      }\n    })\n  );\n\n  passport.serializeUser((user, done) => {\n    done(null, user.id);\n  });\n\n  passport.deserializeUser(async (id: string, done) => {\n    try {\n      const user = await storage.getUser(id);\n      if (user) {\n        done(null, {\n          id: user.id,\n          username: user.username,\n          firstName: user.firstName,\n          lastName: user.lastName,\n          role: user.role,\n        });\n      } else {\n        done(null, false);\n      }\n    } catch (error) {\n      done(error);\n    }\n  });\n\n  app.post(\"/api/login\", (req, res, next) => {\n    passport.authenticate(\"local\", (err: any, user: Express.User | false, info: any) => {\n      if (err) {\n        return res.status(500).json({ message: \"خطأ في الخادم\" });\n      }\n      if (!user) {\n        return res.status(401).json({ message: info?.message || \"بيانات غير صحيحة\" });\n      }\n      req.logIn(user, (err) => {\n        if (err) {\n          return res.status(500).json({ message: \"خطأ في تسجيل الدخول\" });\n        }\n        return res.json(user);\n      });\n    })(req, res, next);\n  });\n\n  app.post(\"/api/logout\", (req, res) => {\n    req.logout((err) => {\n      if (err) {\n        return res.status(500).json({ message: \"خطأ في تسجيل الخروج\" });\n      }\n      res.json({ success: true });\n    });\n  });\n\n  await initializeRootUser();\n}\n\nasync function initializeRootUser() {\n  try {\n    const existingRoot = await storage.getUserByUsername(\"root\");\n    if (!existingRoot) {\n      const hashedPassword = await bcrypt.hash(\"123123123\", 10);\n      await storage.createUser({\n        username: \"root\",\n        password: hashedPassword,\n        firstName: \"المدير\",\n        lastName: \"الرئيسي\",\n        role: \"مدير\",\n      });\n      console.log(\"Root user created with username: root\");\n    }\n  } catch (error) {\n    console.error(\"Error initializing root user:\", error);\n  }\n}\n\nexport const isAuthenticated: RequestHandler = async (req, res, next) => {\n  if (!req.isAuthenticated()) {\n    return res.status(401).json({ message: \"Unauthorized\" });\n  }\n  return next();\n};\n\nexport function requireRole(allowedRoles: string[]): RequestHandler {\n  return (req, res, next) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"يجب تسجيل الدخول أولاً\" });\n    }\n\n    if (!req.user || !allowedRoles.includes(req.user.role)) {\n      return res.status(403).json({ message: \"لا تملك صلاحية لتنفيذ هذا الإجراء\" });\n    }\n\n    return next();\n  };\n}\n\nexport const isAdmin: RequestHandler = requireRole([\"مدير\"]);\n","path":null,"size_bytes":4667,"size_tokens":null},"client/src/hooks/useTheme.ts":{"content":"import { useState, useEffect } from \"react\";\n\ntype Theme = \"light\" | \"dark\";\n\nexport function useTheme() {\n  const [theme, setTheme] = useState<Theme>(() => {\n    if (typeof window !== \"undefined\") {\n      const stored = localStorage.getItem(\"theme\") as Theme;\n      if (stored) return stored;\n      return window.matchMedia(\"(prefers-color-scheme: dark)\").matches ? \"dark\" : \"light\";\n    }\n    return \"light\";\n  });\n\n  useEffect(() => {\n    const root = document.documentElement;\n    root.classList.remove(\"light\", \"dark\");\n    root.classList.add(theme);\n    localStorage.setItem(\"theme\", theme);\n  }, [theme]);\n\n  return { theme, setTheme };\n}\n","path":null,"size_bytes":646,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1467,"size_tokens":null},"client/src/hooks/useAuth.ts":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport type { User } from \"@shared/schema\";\n\nexport function useAuth() {\n  const { data: user, isLoading } = useQuery<User>({\n    queryKey: [\"/api/auth/user\"],\n    retry: false,\n  });\n\n  return {\n    user,\n    isLoading,\n    isAuthenticated: !!user,\n  };\n}\n","path":null,"size_bytes":307,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":1977,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1077,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4120,"size_tokens":null},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* LIGHT MODE */\n:root {\n  --button-outline: rgba(0,0,0, .10);\n  --badge-outline: rgba(0,0,0, .05);\n  --opaque-button-border-intensity: -8;\n  --elevate-1: rgba(0,0,0, .03);\n  --elevate-2: rgba(0,0,0, .08);\n  --background: 210 5% 98%;\n  --foreground: 210 6% 12%;\n  --border: 210 5% 92%;\n  --card: 210 5% 96%;\n  --card-foreground: 210 6% 12%;\n  --card-border: 210 5% 94%;\n  --sidebar: 210 5% 94%;\n  --sidebar-foreground: 210 6% 12%;\n  --sidebar-border: 210 5% 90%;\n  --sidebar-primary: 210 85% 45%;\n  --sidebar-primary-foreground: 210 85% 98%;\n  --sidebar-accent: 210 6% 88%;\n  --sidebar-accent-foreground: 210 6% 12%;\n  --sidebar-ring: 210 85% 45%;\n  --popover: 210 5% 92%;\n  --popover-foreground: 210 6% 12%;\n  --popover-border: 210 5% 88%;\n  --primary: 210 85% 45%;\n  --primary-foreground: 210 85% 98%;\n  --secondary: 210 6% 88%;\n  --secondary-foreground: 210 6% 12%;\n  --muted: 210 6% 90%;\n  --muted-foreground: 210 6% 30%;\n  --accent: 210 8% 92%;\n  --accent-foreground: 210 6% 12%;\n  --destructive: 0 75% 42%;\n  --destructive-foreground: 0 75% 98%;\n  --input: 210 5% 75%;\n  --ring: 210 85% 45%;\n  --chart-1: 210 85% 38%;\n  --chart-2: 180 75% 35%;\n  --chart-3: 30 75% 40%;\n  --chart-4: 280 70% 42%;\n  --chart-5: 150 65% 35%;\n  --font-sans: Open Sans, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: Menlo, monospace;\n  --radius: .5rem;\n  --shadow-2xs: 0px 2px 0px 0px hsl(210 5% 12% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(210 5% 12% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(210 5% 12% / 0.00), 0px 1px 2px -1px hsl(210 5% 12% / 0.00);\n  --shadow: 0px 2px 0px 0px hsl(210 5% 12% / 0.00), 0px 1px 2px -1px hsl(210 5% 12% / 0.00);\n  --shadow-md: 0px 2px 0px 0px hsl(210 5% 12% / 0.00), 0px 2px 4px -1px hsl(210 5% 12% / 0.00);\n  --shadow-lg: 0px 2px 0px 0px hsl(210 5% 12% / 0.00), 0px 4px 6px -1px hsl(210 5% 12% / 0.00);\n  --shadow-xl: 0px 2px 0px 0px hsl(210 5% 12% / 0.00), 0px 8px 10px -1px hsl(210 5% 12% / 0.00);\n  --shadow-2xl: 0px 2px 0px 0px hsl(210 5% 12% / 0.00);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n.dark {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n  --opaque-button-border-intensity: 9;\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .09);\n  --background: 210 6% 8%;\n  --foreground: 210 5% 95%;\n  --border: 210 6% 18%;\n  --card: 210 6% 10%;\n  --card-foreground: 210 5% 95%;\n  --card-border: 210 6% 13%;\n  --sidebar: 210 6% 12%;\n  --sidebar-foreground: 210 5% 95%;\n  --sidebar-border: 210 6% 16%;\n  --sidebar-primary: 210 85% 50%;\n  --sidebar-primary-foreground: 210 85% 98%;\n  --sidebar-accent: 210 6% 16%;\n  --sidebar-accent-foreground: 210 5% 95%;\n  --sidebar-ring: 210 85% 50%;\n  --popover: 210 6% 14%;\n  --popover-foreground: 210 5% 95%;\n  --popover-border: 210 6% 18%;\n  --primary: 210 85% 50%;\n  --primary-foreground: 210 85% 98%;\n  --secondary: 210 6% 18%;\n  --secondary-foreground: 210 5% 95%;\n  --muted: 210 6% 16%;\n  --muted-foreground: 210 5% 70%;\n  --accent: 210 8% 15%;\n  --accent-foreground: 210 5% 95%;\n  --destructive: 0 75% 45%;\n  --destructive-foreground: 0 75% 98%;\n  --input: 210 6% 30%;\n  --ring: 210 85% 50%;\n  --chart-1: 210 85% 65%;\n  --chart-2: 180 75% 70%;\n  --chart-3: 30 75% 68%;\n  --chart-4: 280 70% 72%;\n  --chart-5: 150 65% 70%;\n  --shadow-2xs: 0px 2px 0px 0px hsl(210 6% 8% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(210 6% 8% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(210 6% 8% / 0.00), 0px 1px 2px -1px hsl(210 6% 8% / 0.00);\n  --shadow: 0px 2px 0px 0px hsl(210 6% 8% / 0.00), 0px 1px 2px -1px hsl(210 6% 8% / 0.00);\n  --shadow-md: 0px 2px 0px 0px hsl(210 6% 8% / 0.00), 0px 2px 4px -1px hsl(210 6% 8% / 0.00);\n  --shadow-lg: 0px 2px 0px 0px hsl(210 6% 8% / 0.00), 0px 4px 6px -1px hsl(210 6% 8% / 0.00);\n  --shadow-xl: 0px 2px 0px 0px hsl(210 6% 8% / 0.00), 0px 8px 10px -1px hsl(210 6% 8% / 0.00);\n  --shadow-2xl: 0px 2px 0px 0px hsl(210 6% 8% / 0.00);\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/**\n * Using the elevate system.\n * Automatic contrast adjustment.\n *\n * <element className=\"hover-elevate\" />\n * <element className=\"active-elevate-2\" />\n *\n * // Using the tailwind utility when a data attribute is \"on\"\n * <element className=\"toggle-elevate data-[state=on]:toggle-elevated\" />\n * // Or manually controlling the toggle state\n * <element className=\"toggle-elevate toggle-elevated\" />\n *\n * Elevation systems have to handle many states.\n * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)\n * - toggled or not\n * - focused or not (this is not handled with these utilities)\n *\n * Even without handling focused or not, this is six possible combinations that\n * need to be distinguished from eachother visually.\n */\n@layer utilities {\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of\n   * buttons/badges can remove the automatic brightness adjustment on interactions\n   * and program their own. */\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n\n  /**\n   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.\n   * This way they can stack/compound. Both will overlap the parent's borders!\n   * So borders will be automatically adjusted both on toggle, and hover/active,\n   * and they will be compounded.\n   */\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: -1;\n    /* sits behind content but above backdrop */\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  /* Does not work on elements with overflow:hidden! */\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: 999;\n    /* sits in front of content */\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n}\n","path":null,"size_bytes":10695,"size_tokens":null},"client/src/pages/payments.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Link } from \"wouter\";\nimport {\n  CreditCard,\n  Plus,\n  Search,\n  Ship,\n  DollarSign,\n  TrendingUp,\n  TrendingDown,\n  Calendar,\n  FileText,\n  User,\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport type { Shipment, ShipmentPayment, InsertShipmentPayment } from \"@shared/schema\";\n\nconst PAYMENT_METHODS = [\n  { value: \"نقدي\", label: \"نقدي\" },\n  { value: \"فودافون كاش\", label: \"فودافون كاش\" },\n  { value: \"إنستاباي\", label: \"إنستاباي\" },\n  { value: \"تحويل بنكي\", label: \"تحويل بنكي\" },\n  { value: \"أخرى\", label: \"أخرى\" },\n];\n\ninterface PaymentsStats {\n  totalCostEgp: string;\n  totalPaidEgp: string;\n  totalBalanceEgp: string;\n  totalOverpaidEgp: string;\n  lastPayment: ShipmentPayment | null;\n}\n\nexport default function Payments() {\n  const [search, setSearch] = useState(\"\");\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [selectedShipmentId, setSelectedShipmentId] = useState<number | null>(null);\n  const [paymentCurrency, setPaymentCurrency] = useState(\"EGP\");\n  const [paymentMethod, setPaymentMethod] = useState(\"\");\n  const { toast } = useToast();\n\n  const { data: stats, isLoading: loadingStats } = useQuery<PaymentsStats>({\n    queryKey: [\"/api/payments/stats\"],\n  });\n\n  const { data: shipments, isLoading: loadingShipments } = useQuery<Shipment[]>({\n    queryKey: [\"/api/shipments\"],\n  });\n\n  const { data: payments, isLoading: loadingPayments } = useQuery<\n    (ShipmentPayment & { shipment?: Shipment })[]\n  >({\n    queryKey: [\"/api/payments\"],\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: InsertShipmentPayment) => {\n      return apiRequest(\"POST\", \"/api/payments\", data);\n    },\n    onSuccess: () => {\n      toast({ title: \"تم تسجيل الدفعة بنجاح\" });\n      queryClient.invalidateQueries({ queryKey: [\"/api/payments\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/shipments\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/payments/stats\"] });\n      setIsDialogOpen(false);\n      resetForm();\n    },\n    onError: () => {\n      toast({ title: \"حدث خطأ\", variant: \"destructive\" });\n    },\n  });\n\n  const resetForm = () => {\n    setSelectedShipmentId(null);\n    setPaymentCurrency(\"EGP\");\n    setPaymentMethod(\"\");\n  };\n\n  const handleSubmit = (e: React.FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n    const formData = new FormData(e.currentTarget);\n\n    if (!selectedShipmentId) {\n      toast({ title: \"يرجى اختيار الشحنة\", variant: \"destructive\" });\n      return;\n    }\n\n    const amountOriginal = formData.get(\"amountOriginal\") as string;\n    const exchangeRate = formData.get(\"exchangeRateToEgp\") as string;\n    const amountEgp =\n      paymentCurrency === \"EGP\"\n        ? amountOriginal\n        : (parseFloat(amountOriginal) * parseFloat(exchangeRate || \"1\")).toFixed(2);\n\n    const data: InsertShipmentPayment = {\n      shipmentId: selectedShipmentId,\n      paymentDate: new Date(formData.get(\"paymentDate\") as string),\n      paymentCurrency,\n      amountOriginal,\n      exchangeRateToEgp: paymentCurrency === \"RMB\" ? exchangeRate : null,\n      amountEgp,\n      paymentMethod,\n      cashReceiverName: (formData.get(\"cashReceiverName\") as string) || null,\n      referenceNumber: (formData.get(\"referenceNumber\") as string) || null,\n      note: (formData.get(\"note\") as string) || null,\n    };\n\n    createMutation.mutate(data);\n  };\n\n  const formatCurrency = (value: string | number | null) => {\n    const num = typeof value === \"string\" ? parseFloat(value) : value;\n    return new Intl.NumberFormat(\"ar-EG\", {\n      minimumFractionDigits: 2,\n      maximumFractionDigits: 2,\n    }).format(num || 0);\n  };\n\n  const formatDate = (date: string | Date | null) => {\n    if (!date) return \"-\";\n    return new Date(date).toLocaleDateString(\"ar-EG\");\n  };\n\n  const filteredShipments = shipments?.filter(\n    (s) =>\n      !search ||\n      s.shipmentName.toLowerCase().includes(search.toLowerCase()) ||\n      s.shipmentCode.toLowerCase().includes(search.toLowerCase())\n  );\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-wrap items-center justify-between gap-4\">\n        <div>\n          <h1 className=\"text-3xl font-semibold\">سداد الشحنات</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            متابعة إجمالي ما تم دفعه وما هو متبقي على جميع الشحنات\n          </p>\n        </div>\n        <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n          <DialogTrigger asChild>\n            <Button data-testid=\"button-add-payment\">\n              <Plus className=\"w-4 h-4 ml-2\" />\n              إضافة دفعة جديدة\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-lg\">\n            <DialogHeader>\n              <DialogTitle>تسجيل دفعة جديدة</DialogTitle>\n            </DialogHeader>\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label>اختر الشحنة *</Label>\n                <Select\n                  value={selectedShipmentId?.toString() || \"\"}\n                  onValueChange={(v) => setSelectedShipmentId(parseInt(v))}\n                >\n                  <SelectTrigger data-testid=\"select-shipment\">\n                    <SelectValue placeholder=\"اختر الشحنة\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {shipments?.map((s) => (\n                      <SelectItem key={s.id} value={s.id.toString()}>\n                        {s.shipmentCode} - {s.shipmentName}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"paymentDate\">تاريخ الدفع *</Label>\n                  <Input\n                    id=\"paymentDate\"\n                    name=\"paymentDate\"\n                    type=\"date\"\n                    defaultValue={new Date().toISOString().split(\"T\")[0]}\n                    required\n                    data-testid=\"input-payment-date\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>عملة الدفع *</Label>\n                  <Select value={paymentCurrency} onValueChange={setPaymentCurrency}>\n                    <SelectTrigger data-testid=\"select-currency\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"EGP\">جنيه مصري (ج.م)</SelectItem>\n                      <SelectItem value=\"RMB\">رممبي صيني (¥)</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"amountOriginal\">المبلغ *</Label>\n                  <Input\n                    id=\"amountOriginal\"\n                    name=\"amountOriginal\"\n                    type=\"number\"\n                    step=\"0.01\"\n                    required\n                    placeholder=\"0.00\"\n                    data-testid=\"input-amount\"\n                  />\n                </div>\n                {paymentCurrency === \"RMB\" && (\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"exchangeRateToEgp\">سعر الصرف (RMB→EGP) *</Label>\n                    <Input\n                      id=\"exchangeRateToEgp\"\n                      name=\"exchangeRateToEgp\"\n                      type=\"number\"\n                      step=\"0.0001\"\n                      required\n                      placeholder=\"7.00\"\n                      data-testid=\"input-exchange-rate\"\n                    />\n                  </div>\n                )}\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label>طريقة الدفع *</Label>\n                <Select value={paymentMethod} onValueChange={setPaymentMethod}>\n                  <SelectTrigger data-testid=\"select-payment-method\">\n                    <SelectValue placeholder=\"اختر طريقة الدفع\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {PAYMENT_METHODS.map((m) => (\n                      <SelectItem key={m.value} value={m.value}>\n                        {m.label}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n\n              {paymentMethod === \"نقدي\" && (\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"cashReceiverName\">اسم مستلم الكاش *</Label>\n                  <Input\n                    id=\"cashReceiverName\"\n                    name=\"cashReceiverName\"\n                    required\n                    data-testid=\"input-cash-receiver\"\n                  />\n                </div>\n              )}\n\n              {paymentMethod && paymentMethod !== \"نقدي\" && (\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"referenceNumber\">الرقم المرجعي</Label>\n                  <Input\n                    id=\"referenceNumber\"\n                    name=\"referenceNumber\"\n                    data-testid=\"input-reference\"\n                  />\n                </div>\n              )}\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"note\">ملاحظات</Label>\n                <Textarea\n                  id=\"note\"\n                  name=\"note\"\n                  rows={2}\n                  data-testid=\"input-note\"\n                />\n              </div>\n\n              <div className=\"flex gap-2 pt-4\">\n                <Button\n                  type=\"submit\"\n                  className=\"flex-1\"\n                  disabled={createMutation.isPending}\n                  data-testid=\"button-save-payment\"\n                >\n                  {createMutation.isPending ? \"جاري الحفظ...\" : \"حفظ الدفعة\"}\n                </Button>\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => {\n                    setIsDialogOpen(false);\n                    resetForm();\n                  }}\n                >\n                  إلغاء\n                </Button>\n              </div>\n            </form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Stats Cards */}\n      {loadingStats ? (\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4\">\n          {[1, 2, 3, 4].map((i) => (\n            <Skeleton key={i} className=\"h-28\" />\n          ))}\n        </div>\n      ) : (\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4\">\n          <StatCard\n            title=\"إجمالي تكلفة الشحنات\"\n            value={`${formatCurrency(stats?.totalCostEgp || 0)} ج.م`}\n            icon={Ship}\n          />\n          <StatCard\n            title=\"إجمالي المدفوع\"\n            value={`${formatCurrency(stats?.totalPaidEgp || 0)} ج.م`}\n            icon={CreditCard}\n            trend=\"up\"\n          />\n          <StatCard\n            title=\"إجمالي المتبقي\"\n            value={`${formatCurrency(stats?.totalBalanceEgp || 0)} ج.م`}\n            icon={TrendingDown}\n            trend={parseFloat(stats?.totalBalanceEgp || \"0\") > 0 ? \"down\" : undefined}\n          />\n          <StatCard\n            title=\"المدفوع زيادة\"\n            value={`${formatCurrency(stats?.totalOverpaidEgp || 0)} ج.م`}\n            icon={TrendingUp}\n            trend={parseFloat(stats?.totalOverpaidEgp || \"0\") > 0 ? \"up\" : undefined}\n          />\n        </div>\n      )}\n\n      {/* Tabs */}\n      <Tabs defaultValue=\"shipments\" className=\"space-y-4\">\n        <TabsList>\n          <TabsTrigger value=\"shipments\" data-testid=\"tab-shipments\">\n            الشحنات والأرصدة\n          </TabsTrigger>\n          <TabsTrigger value=\"ledger\" data-testid=\"tab-ledger\">\n            كشف حركة السداد\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"shipments\" className=\"space-y-4\">\n          {/* Search */}\n          <Card>\n            <CardContent className=\"p-4\">\n              <div className=\"relative max-w-md\">\n                <Search className=\"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\n                <Input\n                  placeholder=\"بحث بالشحنة...\"\n                  value={search}\n                  onChange={(e) => setSearch(e.target.value)}\n                  className=\"pr-10\"\n                  data-testid=\"input-search-payments\"\n                />\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Shipments Payment Table */}\n          <Card>\n            <CardHeader className=\"pb-4\">\n              <CardTitle className=\"text-lg flex items-center gap-2\">\n                <Ship className=\"w-5 h-5\" />\n                أرصدة الشحنات\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              {loadingShipments ? (\n                <TableSkeleton />\n              ) : filteredShipments && filteredShipments.length > 0 ? (\n                <div className=\"overflow-x-auto\">\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead className=\"text-right\">رقم الشحنة</TableHead>\n                        <TableHead className=\"text-right\">اسم الشحنة</TableHead>\n                        <TableHead className=\"text-right\">الحالة</TableHead>\n                        <TableHead className=\"text-right\">التكلفة (ج.م)</TableHead>\n                        <TableHead className=\"text-right\">المدفوع (ج.م)</TableHead>\n                        <TableHead className=\"text-right\">الرصيد</TableHead>\n                        <TableHead className=\"text-right\">آخر سداد</TableHead>\n                        <TableHead className=\"text-right\">إجراءات</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {filteredShipments.map((shipment) => (\n                        <TableRow\n                          key={shipment.id}\n                          data-testid={`row-payment-${shipment.id}`}\n                        >\n                          <TableCell className=\"font-medium\">\n                            {shipment.shipmentCode}\n                          </TableCell>\n                          <TableCell>{shipment.shipmentName}</TableCell>\n                          <TableCell>\n                            <Badge variant=\"outline\">{shipment.status}</Badge>\n                          </TableCell>\n                          <TableCell>\n                            {formatCurrency(shipment.finalTotalCostEgp)}\n                          </TableCell>\n                          <TableCell>\n                            {formatCurrency(shipment.totalPaidEgp)}\n                          </TableCell>\n                          <TableCell>\n                            <BalanceBadge\n                              cost={shipment.finalTotalCostEgp}\n                              paid={shipment.totalPaidEgp}\n                            />\n                          </TableCell>\n                          <TableCell>\n                            {formatDate(shipment.lastPaymentDate)}\n                          </TableCell>\n                          <TableCell>\n                            <Button\n                              variant=\"outline\"\n                              size=\"sm\"\n                              onClick={() => {\n                                setSelectedShipmentId(shipment.id);\n                                setIsDialogOpen(true);\n                              }}\n                            >\n                              <Plus className=\"w-4 h-4 ml-1\" />\n                              دفعة\n                            </Button>\n                          </TableCell>\n                        </TableRow>\n                      ))}\n                    </TableBody>\n                  </Table>\n                </div>\n              ) : (\n                <EmptyState\n                  icon={Ship}\n                  title=\"لا توجد شحنات\"\n                  description=\"أضف شحنات لبدء تتبع المدفوعات\"\n                />\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"ledger\" className=\"space-y-4\">\n          <Card>\n            <CardHeader className=\"pb-4\">\n              <CardTitle className=\"text-lg flex items-center gap-2\">\n                <FileText className=\"w-5 h-5\" />\n                كشف حركة السداد\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              {loadingPayments ? (\n                <TableSkeleton />\n              ) : payments && payments.length > 0 ? (\n                <div className=\"overflow-x-auto\">\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead className=\"text-right\">التاريخ</TableHead>\n                        <TableHead className=\"text-right\">الشحنة</TableHead>\n                        <TableHead className=\"text-right\">المبلغ الأصلي</TableHead>\n                        <TableHead className=\"text-right\">المبلغ (ج.م)</TableHead>\n                        <TableHead className=\"text-right\">طريقة الدفع</TableHead>\n                        <TableHead className=\"text-right\">المستلم/المرجع</TableHead>\n                        <TableHead className=\"text-right\">ملاحظات</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {payments.map((payment) => (\n                        <TableRow\n                          key={payment.id}\n                          data-testid={`row-ledger-${payment.id}`}\n                        >\n                          <TableCell>\n                            <div className=\"flex items-center gap-2\">\n                              <Calendar className=\"w-4 h-4 text-muted-foreground\" />\n                              {formatDate(payment.paymentDate)}\n                            </div>\n                          </TableCell>\n                          <TableCell>\n                            {payment.shipment?.shipmentCode || \"-\"}\n                          </TableCell>\n                          <TableCell>\n                            <span className=\"font-mono\">\n                              {payment.paymentCurrency === \"RMB\" ? \"¥\" : \"ج.م\"}{\" \"}\n                              {formatCurrency(payment.amountOriginal)}\n                            </span>\n                          </TableCell>\n                          <TableCell className=\"font-bold\">\n                            {formatCurrency(payment.amountEgp)} ج.م\n                          </TableCell>\n                          <TableCell>\n                            <Badge variant=\"outline\">{payment.paymentMethod}</Badge>\n                          </TableCell>\n                          <TableCell>\n                            {payment.paymentMethod === \"نقدي\" ? (\n                              <div className=\"flex items-center gap-1\">\n                                <User className=\"w-3 h-3\" />\n                                {payment.cashReceiverName}\n                              </div>\n                            ) : (\n                              payment.referenceNumber || \"-\"\n                            )}\n                          </TableCell>\n                          <TableCell className=\"max-w-[200px] truncate\">\n                            {payment.note || \"-\"}\n                          </TableCell>\n                        </TableRow>\n                      ))}\n                    </TableBody>\n                  </Table>\n                </div>\n              ) : (\n                <EmptyState\n                  icon={CreditCard}\n                  title=\"لا توجد مدفوعات\"\n                  description=\"سجل أول دفعة لبدء التتبع\"\n                />\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n\nfunction StatCard({\n  title,\n  value,\n  icon: Icon,\n  trend,\n}: {\n  title: string;\n  value: string;\n  icon: typeof Ship;\n  trend?: \"up\" | \"down\";\n}) {\n  return (\n    <Card>\n      <CardContent className=\"p-6\">\n        <div className=\"flex items-start justify-between gap-4\">\n          <div className=\"flex flex-col gap-2\">\n            <p className=\"text-sm text-muted-foreground\">{title}</p>\n            <p className=\"text-2xl font-bold\">{value}</p>\n          </div>\n          <div\n            className={`w-12 h-12 rounded-md flex items-center justify-center ${\n              trend === \"up\"\n                ? \"bg-green-100 dark:bg-green-900/30\"\n                : trend === \"down\"\n                ? \"bg-red-100 dark:bg-red-900/30\"\n                : \"bg-primary/10\"\n            }`}\n          >\n            <Icon\n              className={`w-6 h-6 ${\n                trend === \"up\"\n                  ? \"text-green-600 dark:text-green-400\"\n                  : trend === \"down\"\n                  ? \"text-red-600 dark:text-red-400\"\n                  : \"text-primary\"\n              }`}\n            />\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n\nfunction BalanceBadge({\n  cost,\n  paid,\n}: {\n  cost: string | number | null;\n  paid: string | number | null;\n}) {\n  const costValue = typeof cost === \"string\" ? parseFloat(cost) : cost || 0;\n  const paidValue = typeof paid === \"string\" ? parseFloat(paid) : paid || 0;\n  const remaining = Math.max(0, costValue - paidValue);\n  const overpaid = Math.max(0, paidValue - costValue);\n\n  const formatCurrency = (num: number) =>\n    new Intl.NumberFormat(\"ar-EG\", {\n      minimumFractionDigits: 2,\n      maximumFractionDigits: 2,\n    }).format(num);\n\n  if (remaining === 0 && overpaid === 0) {\n    return (\n      <Badge\n        variant=\"outline\"\n        className=\"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400\"\n      >\n        مسددة\n      </Badge>\n    );\n  }\n\n  if (overpaid > 0) {\n    return (\n      <Badge\n        variant=\"outline\"\n        className=\"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400\"\n      >\n        مبلغ زيادة: {formatCurrency(overpaid)} ج.م\n      </Badge>\n    );\n  }\n\n  return (\n    <Badge\n      variant=\"outline\"\n      className=\"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400\"\n    >\n      متبقي: {formatCurrency(remaining)} ج.م\n    </Badge>\n  );\n}\n\nfunction EmptyState({\n  icon: Icon,\n  title,\n  description,\n}: {\n  icon: typeof Ship;\n  title: string;\n  description: string;\n}) {\n  return (\n    <div className=\"flex flex-col items-center justify-center py-16 text-center\">\n      <div className=\"w-20 h-20 rounded-full bg-muted flex items-center justify-center mb-6\">\n        <Icon className=\"w-10 h-10 text-muted-foreground\" />\n      </div>\n      <h3 className=\"text-xl font-medium mb-2\">{title}</h3>\n      <p className=\"text-muted-foreground\">{description}</p>\n    </div>\n  );\n}\n\nfunction TableSkeleton() {\n  return (\n    <div className=\"space-y-4\">\n      {[1, 2, 3, 4, 5].map((i) => (\n        <Skeleton key={i} className=\"h-12 w-full\" />\n      ))}\n    </div>\n  );\n}\n","path":null,"size_bytes":24876,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1209,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7428,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":21846,"size_tokens":null},"server/storage.ts":{"content":"import { eq, desc, and, sql, inArray } from \"drizzle-orm\";\nimport { db } from \"./db\";\nimport {\n  users,\n  suppliers,\n  products,\n  shipments,\n  shipmentItems,\n  shipmentShippingDetails,\n  shipmentCustomsDetails,\n  exchangeRates,\n  shipmentPayments,\n  inventoryMovements,\n  auditLogs,\n  type User,\n  type UpsertUser,\n  type Supplier,\n  type InsertSupplier,\n  type Product,\n  type InsertProduct,\n  type Shipment,\n  type InsertShipment,\n  type ShipmentItem,\n  type InsertShipmentItem,\n  type ShipmentShippingDetails,\n  type InsertShipmentShippingDetails,\n  type ShipmentCustomsDetails,\n  type InsertShipmentCustomsDetails,\n  type ExchangeRate,\n  type InsertExchangeRate,\n  type ShipmentPayment,\n  type InsertShipmentPayment,\n  type InventoryMovement,\n  type InsertInventoryMovement,\n  type AuditLog,\n  type InsertAuditLog,\n} from \"@shared/schema\";\n\nexport interface IStorage {\n  // Users\n  getUser(id: string): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  createUser(user: UpsertUser): Promise<User>;\n  updateUser(id: string, data: Partial<UpsertUser>): Promise<User | undefined>;\n  deleteUser(id: string): Promise<boolean>;\n  getAllUsers(): Promise<User[]>;\n  updateUserRole(id: string, role: string): Promise<User | undefined>;\n\n  // Suppliers\n  getAllSuppliers(): Promise<Supplier[]>;\n  getSupplier(id: number): Promise<Supplier | undefined>;\n  createSupplier(data: InsertSupplier): Promise<Supplier>;\n  updateSupplier(id: number, data: Partial<InsertSupplier>): Promise<Supplier | undefined>;\n  deleteSupplier(id: number): Promise<boolean>;\n\n  // Products\n  getAllProducts(): Promise<Product[]>;\n  getProduct(id: number): Promise<Product | undefined>;\n  createProduct(data: InsertProduct): Promise<Product>;\n  updateProduct(id: number, data: Partial<InsertProduct>): Promise<Product | undefined>;\n\n  // Shipments\n  getAllShipments(): Promise<Shipment[]>;\n  getShipment(id: number): Promise<Shipment | undefined>;\n  getShipmentsByIds(ids: number[]): Promise<Shipment[]>;\n  createShipment(data: InsertShipment): Promise<Shipment>;\n  updateShipment(id: number, data: Partial<InsertShipment>): Promise<Shipment | undefined>;\n  deleteShipment(id: number): Promise<boolean>;\n\n  // Shipment Items\n  getShipmentItems(shipmentId: number): Promise<ShipmentItem[]>;\n  createShipmentItem(data: InsertShipmentItem): Promise<ShipmentItem>;\n  updateShipmentItem(id: number, data: Partial<InsertShipmentItem>): Promise<ShipmentItem | undefined>;\n  deleteShipmentItem(id: number): Promise<boolean>;\n  deleteShipmentItems(shipmentId: number): Promise<boolean>;\n\n  // Shipping Details\n  getShippingDetails(shipmentId: number): Promise<ShipmentShippingDetails | undefined>;\n  upsertShippingDetails(data: InsertShipmentShippingDetails): Promise<ShipmentShippingDetails>;\n\n  // Customs Details\n  getCustomsDetails(shipmentId: number): Promise<ShipmentCustomsDetails | undefined>;\n  upsertCustomsDetails(data: InsertShipmentCustomsDetails): Promise<ShipmentCustomsDetails>;\n\n  // Exchange Rates\n  getAllExchangeRates(): Promise<ExchangeRate[]>;\n  getLatestRate(from: string, to: string): Promise<ExchangeRate | undefined>;\n  createExchangeRate(data: InsertExchangeRate): Promise<ExchangeRate>;\n\n  // Payments\n  getAllPayments(): Promise<ShipmentPayment[]>;\n  getShipmentPayments(shipmentId: number): Promise<ShipmentPayment[]>;\n  createPayment(data: InsertShipmentPayment): Promise<ShipmentPayment>;\n\n  // Inventory\n  getAllInventoryMovements(): Promise<InventoryMovement[]>;\n  createInventoryMovement(data: InsertInventoryMovement): Promise<InventoryMovement>;\n\n  // Audit\n  createAuditLog(data: InsertAuditLog): Promise<AuditLog>;\n\n  // Dashboard Stats\n  getDashboardStats(): Promise<{\n    totalShipments: number;\n    totalCostEgp: string;\n    totalPaidEgp: string;\n    totalBalanceEgp: string;\n    totalOverpaidEgp: string;\n    recentShipments: Shipment[];\n    pendingShipments: number;\n    completedShipments: number;\n  }>;\n\n  // Payment Stats\n  getPaymentStats(): Promise<{\n    totalCostEgp: string;\n    totalPaidEgp: string;\n    totalBalanceEgp: string;\n    totalOverpaidEgp: string;\n    lastPayment: ShipmentPayment | null;\n  }>;\n\n  // Inventory Stats\n  getInventoryStats(): Promise<{\n    totalPieces: number;\n    totalCostEgp: string;\n    totalItems: number;\n    avgUnitCostEgp: string;\n  }>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  // Users\n  async getUser(id: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user;\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.username, username));\n    return user;\n  }\n\n  async createUser(userData: UpsertUser): Promise<User> {\n    const [user] = await db.insert(users).values(userData).returning();\n    return user;\n  }\n\n  async updateUser(id: string, data: Partial<UpsertUser>): Promise<User | undefined> {\n    const [user] = await db\n      .update(users)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(users.id, id))\n      .returning();\n    return user;\n  }\n\n  async deleteUser(id: string): Promise<boolean> {\n    const result = await db.delete(users).where(eq(users.id, id));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  async getAllUsers(): Promise<User[]> {\n    return db.select().from(users).orderBy(desc(users.createdAt));\n  }\n\n  async updateUserRole(id: string, role: string): Promise<User | undefined> {\n    const [user] = await db\n      .update(users)\n      .set({ role, updatedAt: new Date() })\n      .where(eq(users.id, id))\n      .returning();\n    return user;\n  }\n\n  // Suppliers\n  async getAllSuppliers(): Promise<Supplier[]> {\n    return db.select().from(suppliers).orderBy(desc(suppliers.createdAt));\n  }\n\n  async getSupplier(id: number): Promise<Supplier | undefined> {\n    const [supplier] = await db.select().from(suppliers).where(eq(suppliers.id, id));\n    return supplier;\n  }\n\n  async createSupplier(data: InsertSupplier): Promise<Supplier> {\n    const [supplier] = await db.insert(suppliers).values(data).returning();\n    return supplier;\n  }\n\n  async updateSupplier(id: number, data: Partial<InsertSupplier>): Promise<Supplier | undefined> {\n    const [supplier] = await db\n      .update(suppliers)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(suppliers.id, id))\n      .returning();\n    return supplier;\n  }\n\n  async deleteSupplier(id: number): Promise<boolean> {\n    const result = await db.delete(suppliers).where(eq(suppliers.id, id));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  // Products\n  async getAllProducts(): Promise<Product[]> {\n    return db.select().from(products).orderBy(desc(products.createdAt));\n  }\n\n  async getProduct(id: number): Promise<Product | undefined> {\n    const [product] = await db.select().from(products).where(eq(products.id, id));\n    return product;\n  }\n\n  async createProduct(data: InsertProduct): Promise<Product> {\n    const [product] = await db.insert(products).values(data).returning();\n    return product;\n  }\n\n  async updateProduct(id: number, data: Partial<InsertProduct>): Promise<Product | undefined> {\n    const [product] = await db\n      .update(products)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(products.id, id))\n      .returning();\n    return product;\n  }\n\n  // Shipments\n  async getAllShipments(): Promise<Shipment[]> {\n    return db.select().from(shipments).orderBy(desc(shipments.createdAt));\n  }\n\n  async getShipment(id: number): Promise<Shipment | undefined> {\n    const [shipment] = await db.select().from(shipments).where(eq(shipments.id, id));\n    return shipment;\n  }\n\n  async getShipmentsByIds(ids: number[]): Promise<Shipment[]> {\n    if (ids.length === 0) return [];\n    return db.select().from(shipments).where(inArray(shipments.id, ids));\n  }\n\n  async createShipment(data: InsertShipment): Promise<Shipment> {\n    const [shipment] = await db.insert(shipments).values(data).returning();\n    return shipment;\n  }\n\n  async updateShipment(id: number, data: Partial<InsertShipment>): Promise<Shipment | undefined> {\n    const [shipment] = await db\n      .update(shipments)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(shipments.id, id))\n      .returning();\n    return shipment;\n  }\n\n  async deleteShipment(id: number): Promise<boolean> {\n    const result = await db.delete(shipments).where(eq(shipments.id, id));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  // Shipment Items\n  async getShipmentItems(shipmentId: number): Promise<ShipmentItem[]> {\n    return db.select().from(shipmentItems).where(eq(shipmentItems.shipmentId, shipmentId));\n  }\n\n  async createShipmentItem(data: InsertShipmentItem): Promise<ShipmentItem> {\n    const [item] = await db.insert(shipmentItems).values(data).returning();\n    return item;\n  }\n\n  async updateShipmentItem(id: number, data: Partial<InsertShipmentItem>): Promise<ShipmentItem | undefined> {\n    const [item] = await db\n      .update(shipmentItems)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(shipmentItems.id, id))\n      .returning();\n    return item;\n  }\n\n  async deleteShipmentItem(id: number): Promise<boolean> {\n    const result = await db.delete(shipmentItems).where(eq(shipmentItems.id, id));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  async deleteShipmentItems(shipmentId: number): Promise<boolean> {\n    await db.delete(shipmentItems).where(eq(shipmentItems.shipmentId, shipmentId));\n    return true;\n  }\n\n  // Shipping Details\n  async getShippingDetails(shipmentId: number): Promise<ShipmentShippingDetails | undefined> {\n    const [details] = await db\n      .select()\n      .from(shipmentShippingDetails)\n      .where(eq(shipmentShippingDetails.shipmentId, shipmentId));\n    return details;\n  }\n\n  async upsertShippingDetails(data: InsertShipmentShippingDetails): Promise<ShipmentShippingDetails> {\n    // Ensure date fields are properly handled (can be null, string, or Date)\n    const cleanedData = {\n      ...data,\n      shippingDate: data.shippingDate || null,\n    };\n    const [details] = await db\n      .insert(shipmentShippingDetails)\n      .values(cleanedData)\n      .onConflictDoUpdate({\n        target: shipmentShippingDetails.shipmentId,\n        set: { ...cleanedData, updatedAt: new Date() },\n      })\n      .returning();\n    return details;\n  }\n\n  // Customs Details\n  async getCustomsDetails(shipmentId: number): Promise<ShipmentCustomsDetails | undefined> {\n    const [details] = await db\n      .select()\n      .from(shipmentCustomsDetails)\n      .where(eq(shipmentCustomsDetails.shipmentId, shipmentId));\n    return details;\n  }\n\n  async upsertCustomsDetails(data: InsertShipmentCustomsDetails): Promise<ShipmentCustomsDetails> {\n    // Ensure date fields are properly handled (can be null, string, or Date)\n    const cleanedData = {\n      ...data,\n      customsInvoiceDate: data.customsInvoiceDate || null,\n    };\n    const [details] = await db\n      .insert(shipmentCustomsDetails)\n      .values(cleanedData)\n      .onConflictDoUpdate({\n        target: shipmentCustomsDetails.shipmentId,\n        set: { ...cleanedData, updatedAt: new Date() },\n      })\n      .returning();\n    return details;\n  }\n\n  // Exchange Rates\n  async getAllExchangeRates(): Promise<ExchangeRate[]> {\n    return db.select().from(exchangeRates).orderBy(desc(exchangeRates.rateDate));\n  }\n\n  async getLatestRate(from: string, to: string): Promise<ExchangeRate | undefined> {\n    const [rate] = await db\n      .select()\n      .from(exchangeRates)\n      .where(\n        and(eq(exchangeRates.fromCurrency, from), eq(exchangeRates.toCurrency, to))\n      )\n      .orderBy(desc(exchangeRates.rateDate))\n      .limit(1);\n    return rate;\n  }\n\n  async createExchangeRate(data: InsertExchangeRate): Promise<ExchangeRate> {\n    const [rate] = await db.insert(exchangeRates).values(data).returning();\n    return rate;\n  }\n\n  // Payments\n  async getAllPayments(): Promise<ShipmentPayment[]> {\n    return db.select().from(shipmentPayments).orderBy(desc(shipmentPayments.paymentDate));\n  }\n\n  async getShipmentPayments(shipmentId: number): Promise<ShipmentPayment[]> {\n    return db\n      .select()\n      .from(shipmentPayments)\n      .where(eq(shipmentPayments.shipmentId, shipmentId))\n      .orderBy(desc(shipmentPayments.paymentDate));\n  }\n\n  async createPayment(data: InsertShipmentPayment): Promise<ShipmentPayment> {\n    const [payment] = await db.insert(shipmentPayments).values(data).returning();\n\n    // Update shipment totals\n    const allPayments = await this.getShipmentPayments(data.shipmentId);\n    const totalPaid = allPayments.reduce(\n      (sum, p) => sum + parseFloat(p.amountEgp),\n      0\n    );\n\n    // Ensure we persist the actual latest payment date (not the server time)\n    const latestPaymentDate =\n      allPayments.reduce<Date | null>((latest, payment) => {\n        const candidate = payment.paymentDate || payment.createdAt || null;\n        if (!candidate) return latest;\n        if (!latest || candidate.getTime() > latest.getTime()) {\n          return candidate;\n        }\n        return latest;\n      }, null) || data.paymentDate || new Date();\n\n    const shipment = await this.getShipment(data.shipmentId);\n    if (shipment) {\n      const finalCost = parseFloat(shipment.finalTotalCostEgp || \"0\");\n      // remaining should never be negative; keep overpaid separately (derived on the client)\n      const remaining = Math.max(0, finalCost - totalPaid);\n\n      await this.updateShipment(data.shipmentId, {\n        totalPaidEgp: totalPaid.toFixed(2),\n        balanceEgp: remaining.toFixed(2),\n        lastPaymentDate: latestPaymentDate,\n      });\n    }\n\n    return payment;\n  }\n\n  // Inventory\n  async getAllInventoryMovements(): Promise<InventoryMovement[]> {\n    return db.select().from(inventoryMovements).orderBy(desc(inventoryMovements.movementDate));\n  }\n\n  async createInventoryMovement(data: InsertInventoryMovement): Promise<InventoryMovement> {\n    const [movement] = await db.insert(inventoryMovements).values(data).returning();\n    return movement;\n  }\n\n  // Audit\n  async createAuditLog(data: InsertAuditLog): Promise<AuditLog> {\n    const [log] = await db.insert(auditLogs).values(data).returning();\n    return log;\n  }\n\n  // Dashboard Stats\n  async getDashboardStats() {\n    const allShipments = await this.getAllShipments();\n\n    const totalCostEgp = allShipments.reduce(\n      (sum, s) => sum + parseFloat(s.finalTotalCostEgp || \"0\"),\n      0\n    );\n\n    const totalPaidEgp = allShipments.reduce(\n      (sum, s) => sum + parseFloat(s.totalPaidEgp || \"0\"),\n      0\n    );\n\n    // Calculate remaining and overpaid correctly\n    // remaining = max(0, cost - paid) per shipment\n    // overpaid = max(0, paid - cost) per shipment\n    let totalBalanceEgp = 0;\n    let totalOverpaidEgp = 0;\n\n    allShipments.forEach((s) => {\n      const cost = parseFloat(s.finalTotalCostEgp || \"0\");\n      const paid = parseFloat(s.totalPaidEgp || \"0\");\n      const remaining = Math.max(0, cost - paid);\n      const overpaid = Math.max(0, paid - cost);\n      totalBalanceEgp += remaining;\n      totalOverpaidEgp += overpaid;\n    });\n\n    const pendingShipments = allShipments.filter(\n      (s) => s.status !== \"مستلمة بنجاح\"\n    ).length;\n\n    const completedShipments = allShipments.filter(\n      (s) => s.status === \"مستلمة بنجاح\"\n    ).length;\n\n    const recentShipments = allShipments.slice(0, 5);\n\n    return {\n      totalShipments: allShipments.length,\n      totalCostEgp: totalCostEgp.toFixed(2),\n      totalPaidEgp: totalPaidEgp.toFixed(2),\n      totalBalanceEgp: totalBalanceEgp.toFixed(2),\n      totalOverpaidEgp: totalOverpaidEgp.toFixed(2),\n      recentShipments,\n      pendingShipments,\n      completedShipments,\n    };\n  }\n\n  // Payment Stats\n  async getPaymentStats() {\n    const allShipments = await this.getAllShipments();\n    const allPayments = await this.getAllPayments();\n\n    const totalCostEgp = allShipments.reduce(\n      (sum, s) => sum + parseFloat(s.finalTotalCostEgp || \"0\"),\n      0\n    );\n\n    const totalPaidEgp = allShipments.reduce(\n      (sum, s) => sum + parseFloat(s.totalPaidEgp || \"0\"),\n      0\n    );\n\n    // Calculate remaining and overpaid correctly\n    // remaining = max(0, cost - paid) per shipment\n    // overpaid = max(0, paid - cost) per shipment\n    let totalBalanceEgp = 0;\n    let totalOverpaidEgp = 0;\n\n    allShipments.forEach((s) => {\n      const cost = parseFloat(s.finalTotalCostEgp || \"0\");\n      const paid = parseFloat(s.totalPaidEgp || \"0\");\n      const remaining = Math.max(0, cost - paid);\n      const overpaid = Math.max(0, paid - cost);\n      totalBalanceEgp += remaining;\n      totalOverpaidEgp += overpaid;\n    });\n\n    const lastPayment = allPayments.length > 0 ? allPayments[0] : null;\n\n    return {\n      totalCostEgp: totalCostEgp.toFixed(2),\n      totalPaidEgp: totalPaidEgp.toFixed(2),\n      totalBalanceEgp: totalBalanceEgp.toFixed(2),\n      totalOverpaidEgp: totalOverpaidEgp.toFixed(2),\n      lastPayment,\n    };\n  }\n\n  // Inventory Stats\n  async getInventoryStats() {\n    const movements = await this.getAllInventoryMovements();\n\n    const totalPieces = movements.reduce(\n      (sum, m) => sum + (m.totalPiecesIn || 0),\n      0\n    );\n\n    const totalCostEgp = movements.reduce(\n      (sum, m) => sum + parseFloat(m.totalCostEgp || \"0\"),\n      0\n    );\n\n    const avgUnitCostEgp = totalPieces > 0 ? totalCostEgp / totalPieces : 0;\n\n    return {\n      totalPieces,\n      totalCostEgp: totalCostEgp.toFixed(2),\n      totalItems: movements.length,\n      avgUnitCostEgp: avgUnitCostEgp.toFixed(4),\n    };\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","path":null,"size_bytes":17646,"size_tokens":null},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { SidebarProvider, SidebarTrigger } from \"@/components/ui/sidebar\";\nimport { AppSidebar } from \"@/components/app-sidebar\";\nimport { ThemeToggle } from \"@/components/theme-toggle\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport NotFound from \"@/pages/not-found\";\nimport Landing from \"@/pages/landing\";\nimport Dashboard from \"@/pages/dashboard\";\nimport Shipments from \"@/pages/shipments\";\nimport ShipmentWizard from \"@/pages/shipment-wizard\";\nimport Suppliers from \"@/pages/suppliers\";\nimport ExchangeRates from \"@/pages/exchange-rates\";\nimport Payments from \"@/pages/payments\";\nimport Inventory from \"@/pages/inventory\";\nimport UsersPage from \"@/pages/users\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\n\nfunction AuthenticatedRouter() {\n  return (\n    <Switch>\n      <Route path=\"/\" component={Dashboard} />\n      <Route path=\"/shipments\" component={Shipments} />\n      <Route path=\"/shipments/new\" component={ShipmentWizard} />\n      <Route path=\"/shipments/:id\" component={ShipmentWizard} />\n      <Route path=\"/shipments/:id/edit\" component={ShipmentWizard} />\n      <Route path=\"/suppliers\" component={Suppliers} />\n      <Route path=\"/exchange-rates\" component={ExchangeRates} />\n      <Route path=\"/payments\" component={Payments} />\n      <Route path=\"/inventory\" component={Inventory} />\n      <Route path=\"/users\" component={UsersPage} />\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction AuthenticatedLayout() {\n  const style = {\n    \"--sidebar-width\": \"18rem\",\n    \"--sidebar-width-icon\": \"4rem\",\n  };\n\n  return (\n    <SidebarProvider style={style as React.CSSProperties}>\n      <div className=\"flex h-screen w-full\">\n        <AppSidebar />\n        <div className=\"flex flex-col flex-1 min-w-0\">\n          <header className=\"sticky top-0 z-50 flex items-center justify-between gap-4 p-3 border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60\">\n            <SidebarTrigger data-testid=\"button-sidebar-toggle\" />\n            <ThemeToggle />\n          </header>\n          <main className=\"flex-1 overflow-auto\">\n            <AuthenticatedRouter />\n          </main>\n        </div>\n      </div>\n    </SidebarProvider>\n  );\n}\n\nfunction LoadingScreen() {\n  return (\n    <div className=\"min-h-screen bg-background flex items-center justify-center\">\n      <div className=\"space-y-4 text-center\">\n        <div className=\"w-16 h-16 rounded-lg bg-primary/10 flex items-center justify-center mx-auto\">\n          <Skeleton className=\"w-10 h-10 rounded\" />\n        </div>\n        <Skeleton className=\"h-6 w-32 mx-auto\" />\n        <Skeleton className=\"h-4 w-48 mx-auto\" />\n      </div>\n    </div>\n  );\n}\n\nfunction AppContent() {\n  const { isAuthenticated, isLoading } = useAuth();\n\n  if (isLoading) {\n    return <LoadingScreen />;\n  }\n\n  if (!isAuthenticated) {\n    return <Landing />;\n  }\n\n  return <AuthenticatedLayout />;\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <TooltipProvider>\n        <AppContent />\n        <Toaster />\n      </TooltipProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":3371,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":1080,"size_tokens":null},"client/src/lib/authUtils.ts":{"content":"export function isUnauthorizedError(error: Error): boolean {\n  return /^401: .*Unauthorized/.test(error.message);\n}\n","path":null,"size_bytes":116,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null}},"version":2}